<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Bloomer (tezos-stdlib.Tezos_stdlib.Bloomer)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-stdlib</a> &#x00BB; <a href="../index.html">Tezos_stdlib</a> &#x00BB; Bloomer</nav><h1>Module <code>Tezos_stdlib.Bloomer</code></h1></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>'a t</span></code></dt><dd><p>A probabilistic set implementation in a fixed memory buffer, with an optional best-effort cleanup mechanism. The bigger the memory buffer, the less false positive outcomes of <code>mem</code>.</p><p>In a standard bloom filter, element membership is encoded as bits being equal to 1 at indices obtained by hashing said element. In this implementation, elements are associated not to bits but to counters.</p><p>The <code>countdown</code> function decrements the counter associated to an element. Hence, each counter corresponds to the number of calls to the <code>countdown</code> function before they are removed from the filter, assuming no collision occurs.</p><p>To the best of our knowledge, the variant of bloom filters implemented in this module is new. In particular, this implementation does not correspond to counting bloom filters as described eg here: https://en.wikipedia.org/wiki/Counting_Bloom_filter</p><p>In order to emphasize the use of counters as a time-based garbage collection mechanism, we call this implementation a generational bloom filter.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>hash:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bytes)</span></span> <span>&#45;&gt;</span> <span>hashes:int</span> <span>&#45;&gt;</span> <span>index_bits:int</span> <span>&#45;&gt;</span> <span>countdown_bits:int</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>create ~hash ~hashes ~index_bits ~countdown_bits</code> creates an initially empty generational bloom filter. The number of generations is <code>2^countdown_bits</code>. The filter is an array of <code>2^index_bits</code> countdown cells, each of size <code>countdown_bits</code>. The resulting filter takes <code>2^index_bits * countdown_bits</code> bits in memory. The hash function must return enough bytes to represent <code>hashes</code> indexes of <code>index_bits</code> bits.</p><p>When a value is <code>add</code>ed, its <code>hash</code> is split into <code>hashes</code> chunks of <code>index_bits</code>, that are used as indexes in the filter's countdown array. These countdown cells are then set to their maximum value, that is <code>2^countdown_bits-1</code>.</p><p>The value will remain a <code>mem</code>ber for as long as all these cells are above zero, which in the most optimistic case (where no collision occur) is until <code>countdown</code> has been called <code>2^countdown_bits-1</code> times. An exception is if <code>clear</code> is called, in which case it is certain to disappear, as all other values.</p><p>Arguments to <code>create</code> are subject to the following constraints:</p><ul><li><code>0 &lt; index_bits &lt;= 24</code></li><li><code>0 &lt; countdown_bits &lt;= 24</code></li></ul></dd></dl><dl><dt class="spec value" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span class="keyword">val</span> mem : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool</code></dt><dd><p>Check if the value is still considered in the set (see <a href="index.html#val-create"><code>create</code></a>).</p></dd></dl><dl><dt class="spec value" id="val-add"><a href="#val-add" class="anchor"></a><code><span class="keyword">val</span> add : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Add a member to the set (see <a href="index.html#val-create"><code>create</code></a>).</p></dd></dl><dl><dt class="spec value" id="val-rem"><a href="#val-rem" class="anchor"></a><code><span class="keyword">val</span> rem : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Force removing an element, which may remove others in case of collisions. Use with care.</p></dd></dl><dl><dt class="spec value" id="val-countdown"><a href="#val-countdown" class="anchor"></a><code><span class="keyword">val</span> countdown : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Decrement all the countdowns cells of the set (see <a href="index.html#val-create"><code>create</code></a>).</p></dd></dl><dl><dt class="spec value" id="val-clear"><a href="#val-clear" class="anchor"></a><code><span class="keyword">val</span> clear : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Clear the entire set.</p></dd></dl><dl><dt class="spec value" id="val-fill_percentage"><a href="#val-fill_percentage" class="anchor"></a><code><span class="keyword">val</span> fill_percentage : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> float</code></dt><dd><p>Percentage (in the <code>0;1</code> interval) of cells which are nonzero.</p></dd></dl><dl><dt class="spec value" id="val-life_expectancy_histogram"><a href="#val-life_expectancy_histogram" class="anchor"></a><code><span class="keyword">val</span> life_expectancy_histogram : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>int array</span></code></dt><dd><p>Histogram of life expectancies (measured in number of countdowns to 0).</p></dd></dl><dl><dt class="spec value" id="val-approx_count"><a href="#val-approx_count" class="anchor"></a><code><span class="keyword">val</span> approx_count : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> int</code></dt><dd><p>Over-approximation of the number of elements added in the filter that have not expired.</p><p>This is exact if rem is never used and over approximated otherwise (rem are not decounted) .</p></dd></dl></div></body></html>