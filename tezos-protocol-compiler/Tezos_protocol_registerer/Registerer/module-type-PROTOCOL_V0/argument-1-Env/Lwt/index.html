<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt (tezos-protocol-compiler.Tezos_protocol_registerer.Registerer.PROTOCOL_V0.1-Env.Lwt)</title><link rel="stylesheet" href="../../../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">tezos-protocol-compiler</a> &#x00BB; <a href="../../../../index.html">Tezos_protocol_registerer</a> &#x00BB; <a href="../../../index.html">Registerer</a> &#x00BB; <a href="../../index.html">PROTOCOL_V0</a> &#x00BB; <a href="../index.html">1-Env</a> &#x00BB; Lwt</nav><header class="odoc-preamble"><h1>Module <code><span>1-Env.Lwt</span></code></h1><p>Module <code>Lwt</code>: cooperative light-weight threads.</p></header><nav class="odoc-toc"><ul><li><a href="#definitions-and-basics">Definitions and basics</a><ul><li><a href="#pre-allocated-threads">Pre-allocated threads</a></li></ul></li><li><a href="#multi-threads-composition">Multi-threads composition</a></li></ul></nav><div class="odoc-content"><p>This module defines <em>cooperative light-weight threads</em> with their primitives. A <em>light-weight thread</em> represent a computation that may be not terminated, for example because it is waiting for some event to happen.</p><p>Lwt threads are cooperative in the sense that switching to another thread is always explicit (with <code>wakeup</code> or <code>wakeup_exn</code>). When a thread is running, it executes as much as possible, and then returns (a value or an error) or sleeps.</p><p>Note that inside a Lwt thread, exceptions must be raised with <code>fail</code> instead of <code>raise</code>. Also the <code>try ... with ...</code> construction will not catch Lwt errors. You must use <code>catch</code> instead. You can also use <code>wrap</code> for functions that may raise normal exception.</p><p>Lwt also provides the syntax extension <code>Pa_lwt</code> to make code using Lwt more readable.</p><h3 id="definitions-and-basics"><a href="#definitions-and-basics" class="anchor"></a>Definitions and basics</h3><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>+'a t</span></span></code></div><div class="spec-doc"><p>The type of threads returning a result of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-return" class="anchored"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return e</code> is a thread whose return value is the value of the expression <code>e</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bind" class="anchored"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind t f</code> is a thread which first waits for the thread <code>t</code> to terminate and then, if the thread succeeds, behaves as the application of function <code>f</code> to the return value of <code>t</code>. If the thread <code>t</code> fails, <code>bind t f</code> also fails, with the same exception.</p><p>The expression <code>bind t (fun x -&gt; t')</code> can intuitively be read as <code>let x = t in t'</code>, and if you use the <em>lwt.syntax</em> syntax extension, you can write a bind operation like that: <code>lwt x = t in t'</code>.</p><p>Note that <code>bind</code> is also often used just for synchronization purpose: <code>t'</code> will not execute before <code>t</code> is terminated.</p><p>The result of a thread can be bound several time.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(&gt;&gt;=)" class="anchored"><a href="#val-(&gt;&gt;=)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;&gt;=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>t &gt;&gt;= f</code> is an alternative notation for <code>bind t f</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(=&lt;&lt;)" class="anchored"><a href="#val-(=&lt;&lt;)" class="anchor"></a><code><span><span class="keyword">val</span> (=&lt;&lt;) : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>f =&lt;&lt; t</code> is <code>t &gt;&gt;= f</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-map" class="anchored"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f m</code> map the result of a thread. This is the same as <code>bind
    m (fun x -&gt; return (f x))</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-(&gt;|=)" class="anchored"><a href="#val-(&gt;|=)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;|=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>m &gt;|= f</code> is <code>map f m</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-(=|&lt;)" class="anchored"><a href="#val-(=|&lt;)" class="anchor"></a><code><span><span class="keyword">val</span> (=|&lt;) : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>f =|&lt; m</code> is <code>map f m</code></p></div></div><h4 id="pre-allocated-threads"><a href="#pre-allocated-threads" class="anchor"></a>Pre-allocated threads</h4><div class="odoc-spec"><div class="spec value" id="val-return_unit" class="anchored"><a href="#val-return_unit" class="anchor"></a><code><span><span class="keyword">val</span> return_unit : <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return_unit = return ()</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-return_none" class="anchored"><a href="#val-return_none" class="anchor"></a><code><span><span class="keyword">val</span> return_none : <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return_none = return None</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-return_nil" class="anchored"><a href="#val-return_nil" class="anchor"></a><code><span><span class="keyword">val</span> return_nil : <span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return_nil = return []</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-return_true" class="anchored"><a href="#val-return_true" class="anchor"></a><code><span><span class="keyword">val</span> return_true : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return_true = return true</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-return_false" class="anchored"><a href="#val-return_false" class="anchor"></a><code><span><span class="keyword">val</span> return_false : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return_false = return false</code></p></div></div><h3 id="multi-threads-composition"><a href="#multi-threads-composition" class="anchor"></a>Multi-threads composition</h3><div class="odoc-spec"><div class="spec value" id="val-join" class="anchored"><a href="#val-join" class="anchor"></a><code><span><span class="keyword">val</span> join : <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>join l</code> waits for all threads in <code>l</code> to terminate. If one of the threads fails, then <code>join l</code> will fails with the same exception as the first one to terminate.</p><p>Note: <a href="#val-join"><code>join</code></a> leaves the local values of the current thread unchanged.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(&lt;&amp;&gt;)" class="anchored"><a href="#val-(&lt;&amp;&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;&amp;&gt;) : <span><span>unit <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>t &lt;&amp;&gt; t'</code> is the same as <code>join [t; t']</code></p></div></div></div></body></html>