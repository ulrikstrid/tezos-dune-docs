<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Context (tezos-context.Tezos_context.Context)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tezos-context</a> &#x00BB; <a href="../index.html">Tezos_context</a> &#x00BB; Context</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_context.Context</span></code></h1><p>Tezos - Versioned, block indexed (key x value) store</p></header><nav class="odoc-toc"><ul><li><a href="#generic-interface">Generic interface</a></li><li><a href="#accessing-and-updating-versions">Accessing and Updating Versions</a></li><li><a href="#predefined-fields">Predefined Fields</a></li><li><a href="#context-dumping">Context dumping</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension"><code><span><span class="keyword">type</span> <span class="xref-unresolved">Tezos_base__TzPervasives.error</span> += </span></code><table><tr id="extension-Cannot_create_file" class="anchored"><td class="def extension"><a href="#extension-Cannot_create_file" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_create_file</span> <span class="keyword">of</span> string</span></code></td></tr><tr id="extension-Cannot_open_file" class="anchored"><td class="def extension"><a href="#extension-Cannot_open_file" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_open_file</span> <span class="keyword">of</span> string</span></code></td></tr><tr id="extension-Cannot_find_protocol" class="anchored"><td class="def extension"><a href="#extension-Cannot_find_protocol" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_find_protocol</span></span></code></td></tr><tr id="extension-Suspicious_file" class="anchored"><td class="def extension"><a href="#extension-Suspicious_file" class="anchor"></a><code><span>| </span><span><span class="extension">Suspicious_file</span> <span class="keyword">of</span> int</span></code></td></tr></table></div></div><h3 id="generic-interface"><a href="#generic-interface" class="anchor"></a>Generic interface</h3><div class="odoc-spec"><div class="spec module-type" id="module-type-S" class="anchored"><a href="#module-type-S" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-S/index.html">S</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="module-type-S/index.html">S</a></span></code></summary><div class="odoc-include"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../Tezos_context_sigs/Context/module-type-VIEW/index.html">Tezos_context_sigs.Context.VIEW</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_context_sigs/Context/module-type-VIEW/index.html#type-key">key</a> = <span>string list</span></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_context_sigs/Context/module-type-VIEW/index.html#type-value">value</a> = bytes</span></span></code></summary><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for context views.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> key</span><span> = <span>string list</span></span></code></div><div class="spec-doc"><p>The type for context keys.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-value" class="anchored"><a href="#type-value" class="anchor"></a><code><span><span class="keyword">type</span> value</span><span> = bytes</span></code></div><div class="spec-doc"><p>The type for context values.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-tree" class="anchored"><a href="#type-tree" class="anchor"></a><code><span><span class="keyword">type</span> tree</span></code></div><div class="spec-doc"><p>The type for context trees.</p></div></div><h3 id="getters"><a href="#getters" class="anchor"></a>Getters</h3><div class="odoc-spec"><div class="spec value" id="val-mem" class="anchored"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mem t k</code> is an Lwt promise that resolves to <code>true</code> iff <code>k</code> is bound to a value in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mem_tree" class="anchored"><a href="#val-mem_tree" class="anchor"></a><code><span><span class="keyword">val</span> mem_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mem_tree t k</code> is like <a href="#val-mem"><code>mem</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-value">value</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find t k</code> is an Lwt promise that resolves to <code>Some v</code> if <code>k</code> is bound to the value <code>v</code> in <code>t</code> and <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_tree" class="anchored"><a href="#val-find_tree" class="anchor"></a><code><span><span class="keyword">val</span> find_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find_tree t k</code> is like <a href="#val-find"><code>find</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-list" class="anchored"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>?offset:int <span class="arrow">&#45;&gt;</span></span> <span>?length:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(string * <a href="#type-tree">tree</a>)</span> list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>list t key</code> is the list of files and sub-nodes stored under <code>k</code> in <code>t</code>. The result order is not specified but is stable.</p><p><code>offset</code> and <code>length</code> are used for pagination.</p></div></div><h3 id="setters"><a href="#setters" class="anchor"></a>Setters</h3><div class="odoc-spec"><div class="spec value" id="val-add" class="anchored"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>add t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>If <code>k</code> was already bound in <code>t</code> to a value that is physically equal to <code>v</code>, the result of the function is a promise that resolves to <code>t</code>. Otherwise, the previous binding of <code>k</code> in <code>t</code> disappears.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-add_tree" class="anchored"><a href="#val-add_tree" class="anchor"></a><code><span><span class="keyword">val</span> add_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>add_tree</code> is like <a href="#val-add"><code>add</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove" class="anchored"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>remove t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></div></div><h3 id="folding"><a href="#folding" class="anchor"></a>Folding</h3><div class="odoc-spec"><div class="spec value" id="val-fold" class="anchored"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : <span>?depth:<span>[ <span>`Eq of int</span> <span><span>| `Le</span> of int</span> <span><span>| `Lt</span> of int</span> <span><span>| `Ge</span> of int</span> <span><span>| `Gt</span> of int</span> ]</span>
<span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span>init:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>f:<span>(<span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>fold ?depth t root ~init ~f</code> recursively folds over the trees and values of <code>t</code>. The <code>f</code> callbacks are called with a key relative to <code>root</code>. <code>f</code> is never called with an empty key for values; i.e., folding over a value is a no-op.</p><p>Elements are traversed in lexical order of keys.</p><p>The depth is 0-indexed. If <code>depth</code> is set (by default it is not), then <code>f</code> is only called when the conditions described by the parameter is true:</p><ul><li><code>Eq d</code> folds over nodes and contents of depth exactly <code>d</code>.</li><li><code>Lt d</code> folds over nodes and contents of depth strictly less than <code>d</code>.</li><li><code>Le d</code> folds over nodes and contents of depth less than or equal to <code>d</code>.</li><li><code>Gt d</code> folds over nodes and contents of depth strictly more than <code>d</code>.</li><li><code>Ge d</code> folds over nodes and contents of depth more than or equal to <code>d</code>.</li></ul></div></div></details></div><div class="odoc-spec"><div class="spec module" id="module-Tree" class="anchored"><a href="#module-Tree" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Tree/index.html">Tree</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></details></div><div class="odoc-spec"><div class="spec type" id="type-context" class="anchored"><a href="#type-context" class="anchor"></a><code><span><span class="keyword">type</span> context</span><span> = <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-index" class="anchored"><a href="#type-index" class="anchor"></a><code><span><span class="keyword">type</span> index</span></code></div><div class="spec-doc"><p>A block-indexed (key x value) store directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>?patch_context:<span>(<span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-context">context</a>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>?readonly:bool <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-index">index</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Open or initialize a versioned store at a given path.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Close the index. Does not fail when the context is already closed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sync" class="anchored"><a href="#val-sync" class="anchor"></a><code><span><span class="keyword">val</span> sync : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Sync the context with disk. Only useful for read-only instances. Does not fail when the context is not in read-only mode.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-compute_testchain_chain_id" class="anchored"><a href="#val-compute_testchain_chain_id" class="anchor"></a><code><span><span class="keyword">val</span> compute_testchain_chain_id : <span><a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-compute_testchain_genesis" class="anchored"><a href="#val-compute_testchain_genesis" class="anchor"></a><code><span><span class="keyword">val</span> compute_testchain_genesis : <span><a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-commit_genesis" class="anchored"><a href="#val-commit_genesis" class="anchor"></a><code><span><span class="keyword">val</span> commit_genesis : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span>chain_id:<a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>time:<a href="../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span>protocol:<a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-commit_test_chain_genesis" class="anchored"><a href="#val-commit_test_chain_genesis" class="anchor"></a><code><span><span class="keyword">val</span> commit_test_chain_genesis : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-merkle_tree" class="anchored"><a href="#val-merkle_tree" class="anchor"></a><code><span><span class="keyword">val</span> merkle_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-shell-services/Tezos_shell_services/Block_services/index.html#type-merkle_leaf_kind">Tezos_shell_services.Block_services.merkle_leaf_kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-shell-services/Tezos_shell_services/Block_services/index.html#type-merkle_tree">Tezos_shell_services.Block_services.merkle_tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>merkle_tree t leaf_kind key</code> returns a Merkle proof for <code>key</code> (i.e. whose hashes reach <code>key</code>). If <code>leaf_kind</code> is <code>Block_services.Hole</code>, the value at <code>key</code> is a hash. If <code>leaf_kind</code> is <code>Block_services.Raw_context</code>, the value at <code>key</code> is a <code>Block_services.raw_context</code>. Values higher in the returned tree are hashes of the siblings on the path to reach <code>key</code>.</p></div></div><h3 id="accessing-and-updating-versions"><a href="#accessing-and-updating-versions" class="anchor"></a>Accessing and Updating Versions</h3><div class="odoc-spec"><div class="spec value" id="val-restore_integrity" class="anchored"><a href="#val-restore_integrity" class="anchor"></a><code><span><span class="keyword">val</span> restore_integrity : <span>?ppf:<span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
<span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int option</span>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>restore_integrity ppf index</code> attempts to restore the context integrity of <code>index</code>. Returns <code>None</code> when nothing needs to be fixed and <code>Some n</code> with <code>n</code> the number of entries fixed. If needs be, the progress might be printed via <code>ppf</code> If the context integrity cannot be restored, <code>Failure msg</code> is thrown.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exists" class="anchored"><a href="#val-exists" class="anchor"></a><code><span><span class="keyword">val</span> exists : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-checkout" class="anchored"><a href="#val-checkout" class="anchor"></a><code><span><span class="keyword">val</span> checkout : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-context">context</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-checkout_exn" class="anchored"><a href="#val-checkout_exn" class="anchor"></a><code><span><span class="keyword">val</span> checkout_exn : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-hash" class="anchored"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span>time:<a href="../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?message:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-commit" class="anchored"><a href="#val-commit" class="anchor"></a><code><span><span class="keyword">val</span> commit : <span>time:<a href="../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?message:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-set_head" class="anchored"><a href="#val-set_head" class="anchor"></a><code><span><span class="keyword">val</span> set_head : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-set_master" class="anchored"><a href="#val-set_master" class="anchor"></a><code><span><span class="keyword">val</span> set_master : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><h3 id="predefined-fields"><a href="#predefined-fields" class="anchor"></a>Predefined Fields</h3><div class="odoc-spec"><div class="spec value" id="val-get_protocol" class="anchored"><a href="#val-get_protocol" class="anchor"></a><code><span><span class="keyword">val</span> get_protocol : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-add_protocol" class="anchored"><a href="#val-add_protocol" class="anchor"></a><code><span><span class="keyword">val</span> add_protocol : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-get_test_chain" class="anchored"><a href="#val-get_test_chain" class="anchor"></a><code><span><span class="keyword">val</span> get_test_chain : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base.Test_chain_status.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-add_test_chain" class="anchored"><a href="#val-add_test_chain" class="anchor"></a><code><span><span class="keyword">val</span> add_test_chain : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base.Test_chain_status.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-remove_test_chain" class="anchored"><a href="#val-remove_test_chain" class="anchor"></a><code><span><span class="keyword">val</span> remove_test_chain : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fork_test_chain" class="anchored"><a href="#val-fork_test_chain" class="anchor"></a><code><span><span class="keyword">val</span> fork_test_chain : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>protocol:<a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>expiration:<a href="../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-clear_test_chain" class="anchored"><a href="#val-clear_test_chain" class="anchor"></a><code><span><span class="keyword">val</span> clear_test_chain : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-find_predecessor_block_metadata_hash" class="anchored"><a href="#val-find_predecessor_block_metadata_hash" class="anchor"></a><code><span><span class="keyword">val</span> find_predecessor_block_metadata_hash : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-add_predecessor_block_metadata_hash" class="anchored"><a href="#val-add_predecessor_block_metadata_hash" class="anchor"></a><code><span><span class="keyword">val</span> add_predecessor_block_metadata_hash : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-find_predecessor_ops_metadata_hash" class="anchored"><a href="#val-find_predecessor_ops_metadata_hash" class="anchor"></a><code><span><span class="keyword">val</span> find_predecessor_ops_metadata_hash : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-add_predecessor_ops_metadata_hash" class="anchored"><a href="#val-add_predecessor_ops_metadata_hash" class="anchor"></a><code><span><span class="keyword">val</span> add_predecessor_ops_metadata_hash : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><h3 id="context-dumping"><a href="#context-dumping" class="anchor"></a>Context dumping</h3><div class="odoc-spec"><div class="spec module" id="module-Protocol_data_legacy" class="anchored"><a href="#module-Protocol_data_legacy" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Protocol_data_legacy/index.html">Protocol_data_legacy</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Block_data_legacy" class="anchored"><a href="#module-Block_data_legacy" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Block_data_legacy/index.html">Block_data_legacy</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Pruned_block_legacy" class="anchored"><a href="#module-Pruned_block_legacy" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Pruned_block_legacy/index.html">Pruned_block_legacy</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-dump_context" class="anchored"><a href="#val-dump_context" class="anchor"></a><code><span><span class="keyword">val</span> dump_context : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>fd:<span class="xref-unresolved">Lwt_unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><span><span>(int, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-restore_context" class="anchored"><a href="#val-restore_context" class="anchor"></a><code><span><span class="keyword">val</span> restore_context : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span>expected_context_hash:<a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>nb_context_elements:int <span class="arrow">&#45;&gt;</span></span>
<span>fd:<span class="xref-unresolved">Lwt_unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-legacy_restore_context" class="anchored"><a href="#val-legacy_restore_context" class="anchor"></a><code><span><span class="keyword">val</span> legacy_restore_context : <span>?expected_block:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span>snapshot_file:string <span class="arrow">&#45;&gt;</span></span>
<span>handle_block:<span>(<span><a href="../../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> * <a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
<span>handle_protocol_data:<span>(<span><a href="Protocol_data_legacy/index.html#type-t">Protocol_data_legacy.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
<span>block_validation:<span>(<span><span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
<span><span><span>(<a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> * <a href="Block_data_legacy/index.html#type-t">Block_data_legacy.t</a> * <span><a href="../../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> * <span><span><span><a href="../../../tezos-crypto/Tezos_crypto/Operation_metadata_hash/index.html#type-t">Tezos_crypto.Operation_metadata_hash.t</a> list</span> list</span> option</span> * <span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> option</span> * <a href="../../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-legacy_read_metadata" class="anchored"><a href="#val-legacy_read_metadata" class="anchor"></a><code><span><span class="keyword">val</span> legacy_read_metadata : <span>snapshot_file:string <span class="arrow">&#45;&gt;</span></span>
<span><span><span>(string * <a href="../../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-legacy_restore_contexts" class="anchored"><a href="#val-legacy_restore_contexts" class="anchor"></a><code><span><span class="keyword">val</span> legacy_restore_contexts : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span>filename:string <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span><span><span>(<a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> * <a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> * <a href="Block_data_legacy/index.html#type-t">Block_data_legacy.t</a> * <span><a href="../../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> * <span><span><span><a href="../../../tezos-crypto/Tezos_crypto/Operation_metadata_hash/index.html#type-t">Tezos_crypto.Operation_metadata_hash.t</a> list</span> list</span> option</span> * <a href="../../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a> * <span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> option</span> * <span><a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> list</span> * <span><a href="Protocol_data_legacy/index.html#type-t">Protocol_data_legacy.t</a> list</span>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-retrieve_commit_info" class="anchored"><a href="#val-retrieve_commit_info" class="anchor"></a><code><span><span class="keyword">val</span> retrieve_commit_info : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> * string * string * <a href="../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a> * <a href="../../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base.Test_chain_status.t</a> * <a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> * <span><a href="../../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> * <span><a href="../../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> option</span> * <span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> list</span>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-check_protocol_commit_consistency" class="anchored"><a href="#val-check_protocol_commit_consistency" class="anchor"></a><code><span><span class="keyword">val</span> check_protocol_commit_consistency : <span><a href="#type-index">index</a> <span class="arrow">&#45;&gt;</span></span> <span>expected_context_hash:<a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>given_protocol_hash:<a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>author:string <span class="arrow">&#45;&gt;</span></span> <span>message:string <span class="arrow">&#45;&gt;</span></span> <span>timestamp:<a href="../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>test_chain_status:<a href="../../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base.Test_chain_status.t</a> <span class="arrow">&#45;&gt;</span></span> <span>predecessor_block_metadata_hash:<span><a href="../../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
<span>predecessor_ops_metadata_hash:<span><a href="../../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span>data_merkle_root:<a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>parents_contexts:<span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div></div></body></html>