<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tezos_context__Context (tezos-context.Tezos_context__Context)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">tezos-context</a> &#x00BB; Tezos_context__Context</nav><h1>Module <code>Tezos_context__Context</code></h1><p>Tezos - Versioned, block indexed (key x value) store</p><nav class="toc"><ul><li><a href="#generic-interface">Generic interface</a></li><li><a href="#accessing-and-updating-versions">Accessing and Updating Versions</a></li><li><a href="#predefined-fields">Predefined Fields</a></li><li><a href="#context-dumping">Context dumping</a></li></ul></nav></header><dl><dt class="spec extension"><code><span class="keyword">type</span> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-error">Tezos_base__TzPervasives.error</a> += </code><code><span class="extension">Cannot_create_file</span> <span class="keyword">of</span> string</code><code> | </code><code><span class="extension">Cannot_open_file</span> <span class="keyword">of</span> string</code><code> | </code><code><span class="extension">Cannot_find_protocol</span></code><code> | </code><code><span class="extension">Suspicious_file</span> <span class="keyword">of</span> int</code></dt></dl><section><header><h3 id="generic-interface"><a href="#generic-interface" class="anchor"></a>Generic interface</h3></header><div class="spec module-type" id="module-type-S"><a href="#module-type-S" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="index.html#module-type-S">S</a></code></span></summary><div><div class="spec include"><div class="doc"><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../Tezos_context_sigs/Context/index.html#module-type-VIEW">Tezos_context_sigs.Context.VIEW</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Tezos_context_sigs/Context/module-type-VIEW/index.html#type-key">key</a> = <span>string list</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../Tezos_context_sigs/Context/module-type-VIEW/index.html#type-value">value</a> = bytes</code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type for context views.</p></dd></dl><dl><dt class="spec type" id="type-key"><a href="#type-key" class="anchor"></a><code><span class="keyword">type</span> key</code><code> = <span>string list</span></code></dt><dd><p>The type for context keys.</p></dd></dl><dl><dt class="spec type" id="type-value"><a href="#type-value" class="anchor"></a><code><span class="keyword">type</span> value</code><code> = bytes</code></dt><dd><p>The type for context values.</p></dd></dl><dl><dt class="spec type" id="type-tree"><a href="#type-tree" class="anchor"></a><code><span class="keyword">type</span> tree</code></dt><dd><p>The type for context trees.</p></dd></dl><section><header><h3 id="getters"><a href="#getters" class="anchor"></a>Getters</h3></header><dl><dt class="spec value" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span class="keyword">val</span> mem : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>mem t k</code> is an Lwt promise that resolves to <code>true</code> iff <code>k</code> is bound to a value in <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-mem_tree"><a href="#val-mem_tree" class="anchor"></a><code><span class="keyword">val</span> mem_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>mem_tree t k</code> is like <a href="index.html#val-mem"><code>mem</code></a> but for trees.</p></dd></dl><dl><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-value">value</a> option</span> Lwt.t</span></code></dt><dd><p><code>find t k</code> is an Lwt promise that resolves to <code>Some v</code> if <code>k</code> is bound to the value <code>v</code> in <code>t</code> and <code>None</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-find_tree"><a href="#val-find_tree" class="anchor"></a><code><span class="keyword">val</span> find_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-tree">tree</a> option</span> Lwt.t</span></code></dt><dd><p><code>find_tree t k</code> is like <a href="index.html#val-find"><code>find</code></a> but for trees.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>?&#8288;offset:int</span> <span>&#45;&gt;</span> <span>?&#8288;length:int</span> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><span>(string * <a href="index.html#type-tree">tree</a>)</span> list</span> Lwt.t</span></code></dt><dd><p><code>list t key</code> is the list of files and sub-nodes stored under <code>k</code> in <code>t</code>. The result order is not specified but is stable.</p><p><code>offset</code> and <code>length</code> are used for pagination.</p></dd></dl></section><section><header><h3 id="setters"><a href="#setters" class="anchor"></a>Setters</h3></header><dl><dt class="spec value" id="val-add"><a href="#val-add" class="anchor"></a><code><span class="keyword">val</span> add : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-value">value</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>add t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>If <code>k</code> was already bound in <code>t</code> to a value that is physically equal to <code>v</code>, the result of the function is a promise that resolves to <code>t</code>. Otherwise, the previous binding of <code>k</code> in <code>t</code> disappears.</p></dd></dl><dl><dt class="spec value" id="val-add_tree"><a href="#val-add_tree" class="anchor"></a><code><span class="keyword">val</span> add_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>add_tree</code> is like <a href="index.html#val-add"><code>add</code></a> but for trees.</p></dd></dl><dl><dt class="spec value" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span class="keyword">val</span> remove : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>remove t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></dd></dl></section><section><header><h3 id="folding"><a href="#folding" class="anchor"></a>Folding</h3></header><dl><dt class="spec value" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span class="keyword">val</span> fold : <span>?&#8288;depth:<span>[ <span>`Eq of int</span> <span><span>| `Le</span> of int</span> <span><span>| `Lt</span> of int</span> <span><span>| `Ge</span> of int</span> <span><span>| `Gt</span> of int</span> ]</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>init:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>f:<span>(<a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt><dd><p><code>fold ?depth t root ~init ~f</code> recursively folds over the trees and values of <code>t</code>. The <code>f</code> callbacks are called with a key relative to <code>root</code>. <code>f</code> is never called with an empty key for values; i.e., folding over a value is a no-op.</p><p>Elements are traversed in lexical order of keys.</p><p>The depth is 0-indexed. If <code>depth</code> is set (by default it is not), then <code>f</code> is only called when the conditions described by the parameter is true:</p><ul><li><code>Eq d</code> folds over nodes and contents of depth exactly <code>d</code>.</li><li><code>Lt d</code> folds over nodes and contents of depth strictly less than <code>d</code>.</li><li><code>Le d</code> folds over nodes and contents of depth less than or equal to <code>d</code>.</li><li><code>Gt d</code> folds over nodes and contents of depth strictly more than <code>d</code>.</li><li><code>Ge d</code> folds over nodes and contents of depth more than or equal to <code>d</code>.</li></ul></dd></dl></section></details></div></div></div><div class="spec module" id="module-Tree"><a href="#module-Tree" class="anchor"></a><code><span class="keyword">module</span> <a href="Tree/index.html">Tree</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></div></div></details></div></div></div><dl><dt class="spec type" id="type-context"><a href="#type-context" class="anchor"></a><code><span class="keyword">type</span> context</code><code> = <a href="index.html#type-t">t</a></code></dt><dt class="spec type" id="type-index"><a href="#type-index" class="anchor"></a><code><span class="keyword">type</span> index</code></dt><dd><p>A block-indexed (key x value) store directory.</p></dd></dl><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : <span>?&#8288;patch_context:<span>(<a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-context">context</a> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;readonly:bool</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="index.html#type-index">index</a> Lwt.t</span></code></dt><dd><p>Open or initialize a versioned store at a given path.</p></dd></dl><dl><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Close the index. Does not fail when the context is already closed.</p></dd></dl><dl><dt class="spec value" id="val-sync"><a href="#val-sync" class="anchor"></a><code><span class="keyword">val</span> sync : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Sync the context with disk. Only useful for read-only instances. Does not fail when the context is not in read-only mode.</p></dd></dl><dl><dt class="spec value" id="val-compute_testchain_chain_id"><a href="#val-compute_testchain_chain_id" class="anchor"></a><code><span class="keyword">val</span> compute_testchain_chain_id : <a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></code></dt><dt class="spec value" id="val-compute_testchain_genesis"><a href="#val-compute_testchain_genesis" class="anchor"></a><code><span class="keyword">val</span> compute_testchain_genesis : <a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></code></dt><dt class="spec value" id="val-commit_genesis"><a href="#val-commit_genesis" class="anchor"></a><code><span class="keyword">val</span> commit_genesis : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span>chain_id:<a href="../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></span> <span>&#45;&gt;</span> <span>time:<a href="../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a></span> <span>&#45;&gt;</span> <span>protocol:<a href="../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a></span> <span>&#45;&gt;</span> <span><span><a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-commit_test_chain_genesis"><a href="#val-commit_test_chain_genesis" class="anchor"></a><code><span class="keyword">val</span> commit_test_chain_genesis : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span><a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> Lwt.t</span></code></dt><dt class="spec value" id="val-merkle_tree"><a href="#val-merkle_tree" class="anchor"></a><code><span class="keyword">val</span> merkle_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../tezos-shell-services/Tezos_shell_services/Block_services/index.html#type-merkle_leaf_kind">Tezos_shell_services.Block_services.merkle_leaf_kind</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="../../tezos-shell-services/Tezos_shell_services/Block_services/index.html#type-merkle_tree">Tezos_shell_services.Block_services.merkle_tree</a> Lwt.t</span></code></dt><dd><p><code>merkle_tree t leaf_kind key</code> returns a Merkle proof for <code>key</code> (i.e. whose hashes reach <code>key</code>). If <code>leaf_kind</code> is <code>Block_services.Hole</code>, the value at <code>key</code> is a hash. If <code>leaf_kind</code> is <code>Block_services.Raw_context</code>, the value at <code>key</code> is a <code>Block_services.raw_context</code>. Values higher in the returned tree are hashes of the siblings on the path to reach <code>key</code>.</p></dd></dl></section><section><header><h3 id="accessing-and-updating-versions"><a href="#accessing-and-updating-versions" class="anchor"></a>Accessing and Updating Versions</h3></header><dl><dt class="spec value" id="val-restore_integrity"><a href="#val-restore_integrity" class="anchor"></a><code><span class="keyword">val</span> restore_integrity : <span>?&#8288;ppf:Stdlib.Format.formatter</span> <span>&#45;&gt;</span> <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span><span>int option</span> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span></code></dt><dd><p><code>restore_integrity ppf index</code> attempts to restore the context integrity of <code>index</code>. Returns <code>None</code> when nothing needs to be fixed and <code>Some n</code> with <code>n</code> the number of entries fixed. If needs be, the progress might be printed via <code>ppf</code> If the context integrity cannot be restored, <code>Failure msg</code> is thrown.</p></dd></dl><dl><dt class="spec value" id="val-exists"><a href="#val-exists" class="anchor"></a><code><span class="keyword">val</span> exists : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dt class="spec value" id="val-checkout"><a href="#val-checkout" class="anchor"></a><code><span class="keyword">val</span> checkout : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-context">context</a> option</span> Lwt.t</span></code></dt><dt class="spec value" id="val-checkout_exn"><a href="#val-checkout_exn" class="anchor"></a><code><span class="keyword">val</span> checkout_exn : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-context">context</a> Lwt.t</span></code></dt><dt class="spec value" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span class="keyword">val</span> hash : <span>time:<a href="../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;message:string</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a></code></dt><dt class="spec value" id="val-commit"><a href="#val-commit" class="anchor"></a><code><span class="keyword">val</span> commit : <span>time:<a href="../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;message:string</span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> Lwt.t</span></code></dt><dt class="spec value" id="val-set_head"><a href="#val-set_head" class="anchor"></a><code><span class="keyword">val</span> set_head : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-set_master"><a href="#val-set_master" class="anchor"></a><code><span class="keyword">val</span> set_master : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt></dl></section><section><header><h3 id="predefined-fields"><a href="#predefined-fields" class="anchor"></a>Predefined Fields</h3></header><dl><dt class="spec value" id="val-get_protocol"><a href="#val-get_protocol" class="anchor"></a><code><span class="keyword">val</span> get_protocol : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> Lwt.t</span></code></dt><dt class="spec value" id="val-add_protocol"><a href="#val-add_protocol" class="anchor"></a><code><span class="keyword">val</span> add_protocol : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-context">context</a> Lwt.t</span></code></dt><dt class="spec value" id="val-get_test_chain"><a href="#val-get_test_chain" class="anchor"></a><code><span class="keyword">val</span> get_test_chain : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base__TzPervasives.Test_chain_status.t</a> Lwt.t</span></code></dt><dt class="spec value" id="val-add_test_chain"><a href="#val-add_test_chain" class="anchor"></a><code><span class="keyword">val</span> add_test_chain : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base__TzPervasives.Test_chain_status.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-context">context</a> Lwt.t</span></code></dt><dt class="spec value" id="val-remove_test_chain"><a href="#val-remove_test_chain" class="anchor"></a><code><span class="keyword">val</span> remove_test_chain : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="index.html#type-context">context</a> Lwt.t</span></code></dt><dt class="spec value" id="val-fork_test_chain"><a href="#val-fork_test_chain" class="anchor"></a><code><span class="keyword">val</span> fork_test_chain : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span>protocol:<a href="../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a></span> <span>&#45;&gt;</span> <span>expiration:<a href="../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a></span> <span>&#45;&gt;</span> <span><a href="index.html#type-context">context</a> Lwt.t</span></code></dt><dt class="spec value" id="val-clear_test_chain"><a href="#val-clear_test_chain" class="anchor"></a><code><span class="keyword">val</span> clear_test_chain : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-find_predecessor_block_metadata_hash"><a href="#val-find_predecessor_block_metadata_hash" class="anchor"></a><code><span class="keyword">val</span> find_predecessor_block_metadata_hash : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><span><a href="../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> Lwt.t</span></code></dt><dt class="spec value" id="val-add_predecessor_block_metadata_hash"><a href="#val-add_predecessor_block_metadata_hash" class="anchor"></a><code><span class="keyword">val</span> add_predecessor_block_metadata_hash : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-context">context</a> Lwt.t</span></code></dt><dt class="spec value" id="val-find_predecessor_ops_metadata_hash"><a href="#val-find_predecessor_ops_metadata_hash" class="anchor"></a><code><span class="keyword">val</span> find_predecessor_ops_metadata_hash : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><span><a href="../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> option</span> Lwt.t</span></code></dt><dt class="spec value" id="val-add_predecessor_ops_metadata_hash"><a href="#val-add_predecessor_ops_metadata_hash" class="anchor"></a><code><span class="keyword">val</span> add_predecessor_ops_metadata_hash : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-context">context</a> Lwt.t</span></code></dt></dl></section><section><header><h3 id="context-dumping"><a href="#context-dumping" class="anchor"></a>Context dumping</h3></header><div class="spec module" id="module-Protocol_data_legacy"><a href="#module-Protocol_data_legacy" class="anchor"></a><code><span class="keyword">module</span> <a href="Protocol_data_legacy/index.html">Protocol_data_legacy</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Block_data_legacy"><a href="#module-Block_data_legacy" class="anchor"></a><code><span class="keyword">module</span> <a href="Block_data_legacy/index.html">Block_data_legacy</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Pruned_block_legacy"><a href="#module-Pruned_block_legacy" class="anchor"></a><code><span class="keyword">module</span> <a href="Pruned_block_legacy/index.html">Pruned_block_legacy</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-dump_context"><a href="#val-dump_context" class="anchor"></a><code><span class="keyword">val</span> dump_context : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <span>&#45;&gt;</span> <span>fd:Lwt_unix.file_descr</span> <span>&#45;&gt;</span> <span><span>int <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-restore_context"><a href="#val-restore_context" class="anchor"></a><code><span class="keyword">val</span> restore_context : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span>expected_context_hash:<a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a></span> <span>&#45;&gt;</span> <span>nb_context_elements:int</span> <span>&#45;&gt;</span> <span>fd:Lwt_unix.file_descr</span> <span>&#45;&gt;</span> <span><span>unit <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-legacy_restore_context"><a href="#val-legacy_restore_context" class="anchor"></a><code><span class="keyword">val</span> legacy_restore_context : <span>?&#8288;expected_block:string</span> <span>&#45;&gt;</span> <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span>snapshot_file:string</span> <span>&#45;&gt;</span> <span>handle_block:<span>(<a href="../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a> <span>&#45;&gt;</span> <span>(<a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> * <a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a>)</span> <span>&#45;&gt;</span> <span><span>unit <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span>handle_protocol_data:<span>(<a href="Protocol_data_legacy/index.html#type-t">Protocol_data_legacy.t</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span>block_validation:<span>(<span><a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> option</span> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span>&#45;&gt;</span> <a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span><span><span>(<a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> * <a href="Block_data_legacy/index.html#type-t">Block_data_legacy.t</a> * <span><a href="../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> * <span><span><span><a href="../../tezos-crypto/Tezos_crypto/Operation_metadata_hash/index.html#type-t">Tezos_crypto.Operation_metadata_hash.t</a> list</span> list</span> option</span> * <span><a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> option</span> * <a href="../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a>)</span> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-legacy_read_metadata"><a href="#val-legacy_read_metadata" class="anchor"></a><code><span class="keyword">val</span> legacy_read_metadata : <span>snapshot_file:string</span> <span>&#45;&gt;</span> <span><span><span>(string * <a href="../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a>)</span> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-legacy_restore_contexts"><a href="#val-legacy_restore_contexts" class="anchor"></a><code><span class="keyword">val</span> legacy_restore_contexts : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span>filename:string</span> <span>&#45;&gt;</span> <span>(<span><span>(<a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> * <a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a>)</span> list</span> <span>&#45;&gt;</span> <span><span>unit <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span>(<span><a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> option</span> <span>&#45;&gt;</span> <a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span>&#45;&gt;</span> <a href="Pruned_block_legacy/index.html#type-t">Pruned_block_legacy.t</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span><span>(<a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> * <a href="Block_data_legacy/index.html#type-t">Block_data_legacy.t</a> * <span><a href="../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> * <span><span><span><a href="../../tezos-crypto/Tezos_crypto/Operation_metadata_hash/index.html#type-t">Tezos_crypto.Operation_metadata_hash.t</a> list</span> list</span> option</span> * <a href="../../tezos-shell-services/Tezos_shell_services/History_mode/Legacy/index.html#type-t">Tezos_shell_services.History_mode.Legacy.t</a> * <span><a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> option</span> * <span><a href="../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> list</span> * <span><a href="Protocol_data_legacy/index.html#type-t">Protocol_data_legacy.t</a> list</span>)</span> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-retrieve_commit_info"><a href="#val-retrieve_commit_info" class="anchor"></a><code><span class="keyword">val</span> retrieve_commit_info : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <a href="../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span><span><span>(<a href="../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> * string * string * <a href="../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a> * <a href="../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base__TzPervasives.Test_chain_status.t</a> * <a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> * <span><a href="../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span> * <span><a href="../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> option</span> * <span><a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> list</span>)</span> <a href="../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-check_protocol_commit_consistency"><a href="#val-check_protocol_commit_consistency" class="anchor"></a><code><span class="keyword">val</span> check_protocol_commit_consistency : <a href="index.html#type-index">index</a> <span>&#45;&gt;</span> <span>expected_context_hash:<a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a></span> <span>&#45;&gt;</span> <span>given_protocol_hash:<a href="../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a></span> <span>&#45;&gt;</span> <span>author:string</span> <span>&#45;&gt;</span> <span>message:string</span> <span>&#45;&gt;</span> <span>timestamp:<a href="../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a></span> <span>&#45;&gt;</span> <span>test_chain_status:<a href="../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base__TzPervasives.Test_chain_status.t</a></span> <span>&#45;&gt;</span> <span>predecessor_block_metadata_hash:<span><a href="../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span></span> <span>&#45;&gt;</span> <span>predecessor_ops_metadata_hash:<span><a href="../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> option</span></span> <span>&#45;&gt;</span> <span>data_merkle_root:<a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a></span> <span>&#45;&gt;</span> <span>parents_contexts:<span><a href="../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> list</span></span> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt></dl></section></div></body></html>