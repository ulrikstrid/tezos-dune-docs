<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sapling_storage (tezos-protocol-functor-008-PtEdo2Zk.Tezos_protocol_008_PtEdo2Zk_functor.Functor.Make.Sapling_storage)</title><link rel="stylesheet" href="../../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../../index.html">tezos-protocol-functor-008-PtEdo2Zk</a> &#x00BB; <a href="../../../index.html">Tezos_protocol_008_PtEdo2Zk_functor</a> &#x00BB; <a href="../../index.html">Functor</a> &#x00BB; <a href="../index.html">Make</a> &#x00BB; Sapling_storage</nav><h1>Module <code>Make.Sapling_storage</code></h1></header><div class="spec module" id="module-Commitments"><a href="#module-Commitments" class="anchor"></a><code><span class="keyword">module</span> <a href="Commitments/index.html">Commitments</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Ciphertexts"><a href="#module-Ciphertexts" class="anchor"></a><code><span class="keyword">module</span> <a href="Ciphertexts/index.html">Ciphertexts</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Nullifiers"><a href="#module-Nullifiers" class="anchor"></a><code><span class="keyword">module</span> <a href="Nullifiers/index.html">Nullifiers</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec module" id="module-Roots"><a href="#module-Roots" class="anchor"></a><code><span class="keyword">module</span> <a href="Roots/index.html">Roots</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Bounded queue of roots. The full size is initialized with the default uncommitted root, that's why roots storage doesn't need to be carbonated. A maximum of one new root is added per protocol level. If multiple transactions for the same shielded pool are processed during the same contract call or several calls in the same block, only the last root will be stored. This property prevents transactions in the same block from depending on each other and guarantees that a transaction will be valid for a least two hours (hence the 120 size) after being forged.</p></dd></dl><dl><dt class="spec type" id="type-state"><a href="#type-state" class="anchor"></a><code><span class="keyword">type</span> state</code><code> = </code><code>{</code><table class="record"><tr id="type-state.id" class="anchored"><td class="def field"><a href="#type-state.id" class="anchor"></a><code>id : <span><a href="../Lazy_storage_kind/Sapling_state/Id/index.html#type-t">Lazy_storage_kind.Sapling_state.Id.t</a> option</span>;</code></td></tr><tr id="type-state.diff" class="anchored"><td class="def field"><a href="#type-state.diff" class="anchor"></a><code>diff : <a href="../Sapling_repr/index.html#type-diff">Sapling_repr.diff</a>;</code></td></tr><tr id="type-state.memo_size" class="anchored"><td class="def field"><a href="#type-state.memo_size" class="anchor"></a><code>memo_size : <a href="../Sapling_repr/Memo_size/index.html#type-t">Sapling_repr.Memo_size.t</a>;</code></td></tr></table><code>}</code></dt><dd><p>This type links the permanent state stored in the context at the specified id together with the ephemeral diff managed by the Michelson interpreter. After a successful execution the diff can be applied to update the state at id. The first time a state is created its id is None, one will be assigned after the first application.</p></dd></dl><dl><dt class="spec value" id="val-empty_diff"><a href="#val-empty_diff" class="anchor"></a><code><span class="keyword">val</span> empty_diff : <a href="../Sapling_repr/index.html#type-diff">Sapling_repr.diff</a></code></dt><dt class="spec value" id="val-empty_state"><a href="#val-empty_state" class="anchor"></a><code><span class="keyword">val</span> empty_state : <span>?&#8288;id:<a href="../Lazy_storage_kind/Sapling_state/Id/index.html#type-t">Lazy_storage_kind.Sapling_state.Id.t</a></span> <span>&#45;&gt;</span> <span>memo_size:<a href="../Sapling_repr/Memo_size/index.html#type-t">Sapling_repr.Memo_size.t</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-state_from_id"><a href="#val-state_from_id" class="anchor"></a><code><span class="keyword">val</span> state_from_id : <a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../Storage/Sapling/index.html#type-id">Storage.Sapling.id</a> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#type-state">state</a> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>, <span><a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-error">Tezos_protocol_environment.Error_monad.error</a> <a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-trace">Tezos_protocol_environment.Error_monad.trace</a></span>)</span> <a href="../argument-1-Tezos_protocol_environment/Pervasives/index.html#type-result">Tezos_protocol_environment.Pervasives.result</a></span> <a href="../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dd><p>Returns a state from an existing id.</p></dd></dl><dl><dt class="spec value" id="val-rpc_arg"><a href="#val-rpc_arg" class="anchor"></a><code><span class="keyword">val</span> rpc_arg : <span><a href="../Storage/Sapling/index.html#type-id">Storage.Sapling.id</a> <a href="../argument-1-Tezos_protocol_environment/RPC_arg/index.html#type-t">Tezos_protocol_environment.RPC_arg.t</a></span></code></dt><dt class="spec value" id="val-get_memo_size"><a href="#val-get_memo_size" class="anchor"></a><code><span class="keyword">val</span> get_memo_size : <a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../Storage/Sapling/index.html#type-id">Storage.Sapling.id</a> <span>&#45;&gt;</span> <span><span><a href="../Storage/Sapling/Memo_size/index.html#type-value">Storage.Sapling.Memo_size.value</a> <a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-tzresult">Tezos_protocol_environment.Error_monad.tzresult</a></span> <a href="../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : <a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../Storage/Sapling/index.html#type-id">Storage.Sapling.id</a> <span>&#45;&gt;</span> <span>memo_size:<a href="../Storage/Sapling/Memo_size/index.html#type-value">Storage.Sapling.Memo_size.value</a></span> <span>&#45;&gt;</span> <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a>, <span><a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-error">Tezos_protocol_environment.Error_monad.error</a> <a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-trace">Tezos_protocol_environment.Error_monad.trace</a></span>)</span> <a href="../argument-1-Tezos_protocol_environment/Pervasives/index.html#type-result">Tezos_protocol_environment.Pervasives.result</a></span> <a href="../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dt class="spec value" id="val-sapling_apply_diff_cost"><a href="#val-sapling_apply_diff_cost" class="anchor"></a><code><span class="keyword">val</span> sapling_apply_diff_cost : <span>inputs:int</span> <span>&#45;&gt;</span> <span>outputs:int</span> <span>&#45;&gt;</span> <a href="../argument-1-Tezos_protocol_environment/Z/index.html#type-t">Tezos_protocol_environment.Z.t</a></code></dt><dt class="spec value" id="val-apply_diff"><a href="#val-apply_diff" class="anchor"></a><code><span class="keyword">val</span> apply_diff : <a href="../Raw_context/index.html#type-context">Raw_context.context</a> <span>&#45;&gt;</span> <a href="../Storage/Sapling/index.html#type-id">Storage.Sapling.id</a> <span>&#45;&gt;</span> <a href="../Sapling_repr/index.html#type-diff">Sapling_repr.diff</a> <span>&#45;&gt;</span> <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../argument-1-Tezos_protocol_environment/Z/index.html#type-t">Tezos_protocol_environment.Z.t</a>, <span><a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-error">Tezos_protocol_environment.Error_monad.error</a> <a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-trace">Tezos_protocol_environment.Error_monad.trace</a></span>)</span> <a href="../argument-1-Tezos_protocol_environment/Pervasives/index.html#type-result">Tezos_protocol_environment.Pervasives.result</a></span> <a href="../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dd><p>Applies a diff to a state id stored in the context. Updates Commitments, Ciphertexts and Nullifiers using the diff and updates the Roots using the new Commitments tree.</p></dd></dl><dl><dt class="spec value" id="val-add"><a href="#val-add" class="anchor"></a><code><span class="keyword">val</span> add : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span><span>(<a href="../argument-1-Tezos_protocol_environment/Sapling/Commitment/index.html#type-t">Tezos_protocol_environment.Sapling.Commitment.t</a> * <a href="../argument-1-Tezos_protocol_environment/Sapling/Ciphertext/index.html#type-t">Tezos_protocol_environment.Sapling.Ciphertext.t</a>)</span> list</span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-root_mem"><a href="#val-root_mem" class="anchor"></a><code><span class="keyword">val</span> root_mem : <a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="../argument-1-Tezos_protocol_environment/Sapling/Hash/index.html#type-t">Tezos_protocol_environment.Sapling.Hash.t</a> <span>&#45;&gt;</span> <span><span><span>(bool, <span><a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-error">Tezos_protocol_environment.Error_monad.error</a> <a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-trace">Tezos_protocol_environment.Error_monad.trace</a></span>)</span> <a href="../argument-1-Tezos_protocol_environment/Pervasives/index.html#type-result">Tezos_protocol_environment.Pervasives.result</a></span> <a href="../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dt class="spec value" id="val-nullifiers_mem"><a href="#val-nullifiers_mem" class="anchor"></a><code><span class="keyword">val</span> nullifiers_mem : <a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="../Storage/Sapling/Nullifiers_hashed/index.html#type-elt">Storage.Sapling.Nullifiers_hashed.elt</a> <span>&#45;&gt;</span> <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * bool)</span> <a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-tzresult">Tezos_protocol_environment.Error_monad.tzresult</a></span> <a href="../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dt class="spec value" id="val-nullifiers_add"><a href="#val-nullifiers_add" class="anchor"></a><code><span class="keyword">val</span> nullifiers_add : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="../argument-1-Tezos_protocol_environment/Sapling/Nullifier/index.html#type-t">Tezos_protocol_environment.Sapling.Nullifier.t</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt></dl><dl><dt class="spec type" id="type-root"><a href="#type-root" class="anchor"></a><code><span class="keyword">type</span> root</code><code> = <a href="../argument-1-Tezos_protocol_environment/Sapling/Hash/index.html#type-t">Tezos_protocol_environment.Sapling.Hash.t</a></code></dt></dl><dl><dt class="spec value" id="val-root_encoding"><a href="#val-root_encoding" class="anchor"></a><code><span class="keyword">val</span> root_encoding : <span><a href="../argument-1-Tezos_protocol_environment/Sapling/Hash/index.html#type-t">Tezos_protocol_environment.Sapling.Hash.t</a> <a href="../argument-1-Tezos_protocol_environment/Data_encoding/index.html#type-t">Tezos_protocol_environment.Data_encoding.t</a></span></code></dt><dt class="spec value" id="val-get_diff"><a href="#val-get_diff" class="anchor"></a><code><span class="keyword">val</span> get_diff : <a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../Storage/Sapling/index.html#type-id">Storage.Sapling.id</a> <span>&#45;&gt;</span> <span>?&#8288;offset_commitment:<a href="../Storage/Sapling/Ciphertexts/index.html#type-key">Storage.Sapling.Ciphertexts.key</a></span> <span>&#45;&gt;</span> <span>?&#8288;offset_nullifier:<a href="../Storage/Sapling/Nullifiers_ordered/index.html#type-key">Storage.Sapling.Nullifiers_ordered.key</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span><span>(<a href="../Storage/Sapling/Roots/index.html#type-value">Storage.Sapling.Roots.value</a> * <a href="../Sapling_repr/index.html#type-diff">Sapling_repr.diff</a>, <span><a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-error">Tezos_protocol_environment.Error_monad.error</a> <a href="../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-trace">Tezos_protocol_environment.Error_monad.trace</a></span>)</span> <a href="../argument-1-Tezos_protocol_environment/Pervasives/index.html#type-result">Tezos_protocol_environment.Pervasives.result</a></span> <a href="../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt></dl></div></body></html>