<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chain (tezos-legacy-store.Tezos_legacy_store.Legacy_state.Chain)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">tezos-legacy-store</a> &#x00BB; <a href="../../index.html">Tezos_legacy_store</a> &#x00BB; <a href="../index.html">Legacy_state</a> &#x00BB; Chain</nav><header class="odoc-preamble"><h1>Module <code><span>Legacy_state.Chain</span></code></h1><p>Data specific to a given chain (e.g. the main chain or the current test chain).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-chain_state" class="anchored"><a href="#type-chain_state" class="anchor"></a><code><span><span class="keyword">type</span> chain_state</span><span> = <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><a href="../index.html#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> <span>?allow_forked_chain:bool <span class="arrow">&#45;&gt;</span></span> <span>commit_genesis:<span>(<span>chain_id:<a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span>
<span><span><span>(<a href="../../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Genesis/index.html#type-t">Tezos_base.Genesis.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-chain_state">chain_state</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Initialize a chain for a given <code>genesis</code>. By default, the chain does accept forking test chain. When <code>~allow_forked_chain:true</code> is provided, test chain are allowed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><a href="../index.html#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-chain_state">chain_state</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Look up for a chain by the hash of its genesis block.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_opt" class="anchored"><a href="#val-get_opt" class="anchor"></a><code><span><span class="keyword">val</span> get_opt : <span><a href="../index.html#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-chain_state">chain_state</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-get_exn" class="anchored"><a href="#val-get_exn" class="anchor"></a><code><span><span class="keyword">val</span> get_exn : <span><a href="../index.html#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-chain_state">chain_state</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-main" class="anchored"><a href="#val-main" class="anchor"></a><code><span><span class="keyword">val</span> main : <span><a href="../index.html#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-test" class="anchored"><a href="#val-test" class="anchor"></a><code><span><span class="keyword">val</span> test : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-all" class="anchored"><a href="#val-all" class="anchor"></a><code><span><span class="keyword">val</span> all : <span><a href="../index.html#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-chain_state">chain_state</a> <span class="xref-unresolved">Stdlib</span>.Seq.t</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns all the known chains.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-destroy" class="anchored"><a href="#val-destroy" class="anchor"></a><code><span><span class="keyword">val</span> destroy : <span><a href="../index.html#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Destroy a chain: this completely removes from the local storage all the data associated to the chain (this includes blocks and operations).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-id" class="anchored"><a href="#val-id" class="anchor"></a><code><span><span class="keyword">val</span> id : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></span></code></div><div class="spec-doc"><p>Various accessors.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-genesis" class="anchored"><a href="#val-genesis" class="anchor"></a><code><span><span class="keyword">val</span> genesis : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-base/Tezos_base/Genesis/index.html#type-t">Tezos_base.Genesis.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-global_state" class="anchored"><a href="#val-global_state" class="anchor"></a><code><span><span class="keyword">val</span> global_state : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <a href="../index.html#type-global_state">global_state</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-faked_genesis_hash" class="anchored"><a href="#val-faked_genesis_hash" class="anchor"></a><code><span><span class="keyword">val</span> faked_genesis_hash : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></span></code></div><div class="spec-doc"><p>Hash of the faked block header of the genesis block.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-expiration" class="anchored"><a href="#val-expiration" class="anchor"></a><code><span><span class="keyword">val</span> expiration : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a> option</span></span></code></div><div class="spec-doc"><p>Return the expiration timestamp of a test chain.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-allow_forked_chain" class="anchored"><a href="#val-allow_forked_chain" class="anchor"></a><code><span><span class="keyword">val</span> allow_forked_chain : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-checkpoint" class="anchored"><a href="#val-checkpoint" class="anchor"></a><code><span><span class="keyword">val</span> checkpoint : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-save_point" class="anchored"><a href="#val-save_point" class="anchor"></a><code><span><span class="keyword">val</span> save_point : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="xref-unresolved">Stdlib</span>.Int32.t * <a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a>)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-caboose" class="anchored"><a href="#val-caboose" class="anchor"></a><code><span><span class="keyword">val</span> caboose : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="xref-unresolved">Stdlib</span>.Int32.t * <a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a>)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-store" class="anchored"><a href="#val-store" class="anchor"></a><code><span><span class="keyword">val</span> store : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Legacy_store/index.html#type-t">Legacy_store.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-set_checkpoint" class="anchored"><a href="#val-set_checkpoint" class="anchor"></a><code><span><span class="keyword">val</span> set_checkpoint : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Update the current checkpoint. The current head should be consistent (i.e. it should either have a lower level or pass through the checkpoint). In the process all the blocks from invalid alternate heads are removed from the disk, either completely (when `level &lt;= checkpoint`) or still tagged as invalid (when `level &gt; checkpoint`).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_checkpoint_then_purge_full" class="anchored"><a href="#val-set_checkpoint_then_purge_full" class="anchor"></a><code><span><span class="keyword">val</span> set_checkpoint_then_purge_full : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Apply <code>set_checkpoint</code> then <code>purge_full</code> (see <code>History_mode</code>.Legacy.t).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_checkpoint_then_purge_rolling" class="anchored"><a href="#val-set_checkpoint_then_purge_rolling" class="anchor"></a><code><span><span class="keyword">val</span> set_checkpoint_then_purge_rolling : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Apply <code>set_checkpoint</code> then <code>purge_rolling</code> (see <code>History_mode</code>.Legacy.t).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-acceptable_block" class="anchored"><a href="#val-acceptable_block" class="anchor"></a><code><span><span class="keyword">val</span> acceptable_block : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Check that a block is compatible with the current checkpoint. This function assumes that the predecessor is known valid.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-all_indexed_protocols" class="anchored"><a href="#val-all_indexed_protocols" class="anchor"></a><code><span><span class="keyword">val</span> all_indexed_protocols : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(int * <span>(<a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> * int32)</span>)</span> list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>List all the indexed protocols in the chain. The resulting list contains elements of the form <code>&lt;proto_level&gt;, (&lt;proto_hash&gt;,
     &lt;activation_level&gt;)</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_level_indexed_protocol" class="anchored"><a href="#val-get_level_indexed_protocol" class="anchor"></a><code><span><span class="keyword">val</span> get_level_indexed_protocol : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Get the level indexed chain protocol store for the given header.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-update_level_indexed_protocol_store" class="anchored"><a href="#val-update_level_indexed_protocol_store" class="anchor"></a><code><span><span class="keyword">val</span> update_level_indexed_protocol_store : <span><a href="#type-chain_state">chain_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Update the level indexed chain protocol store so that the block can easily access its corresponding protocol hash from the protocol level in its header. Also stores the transition block level.</p></div></div></div></body></html>