<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chain (tezos-legacy-store.Tezos_legacy_store__Legacy_state.Chain)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-legacy-store</a> &#x00BB; <a href="../index.html">Tezos_legacy_store__Legacy_state</a> &#x00BB; Chain</nav><h1>Module <code>Tezos_legacy_store__Legacy_state.Chain</code></h1><p>Data specific to a given chain (e.g. the main chain or the current test chain).</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dt class="spec type" id="type-chain_state"><a href="#type-chain_state" class="anchor"></a><code><span class="keyword">type</span> chain_state</code><code> = <a href="index.html#type-t">t</a></code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <a href="../index.html#type-global_state">global_state</a> <span>&#45;&gt;</span> <span>?&#8288;allow_forked_chain:bool</span> <span>&#45;&gt;</span> <span>commit_genesis:<span>(<span>chain_id:<a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></span> <span>&#45;&gt;</span> <span><span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Genesis/index.html#type-t">Tezos_base__TzPervasives.Genesis.t</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-chain_state">chain_state</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p>Initialize a chain for a given <code>genesis</code>. By default, the chain does accept forking test chain. When <code>~allow_forked_chain:true</code> is provided, test chain are allowed.</p></dd></dl><dl><dt class="spec value" id="val-get"><a href="#val-get" class="anchor"></a><code><span class="keyword">val</span> get : <a href="../index.html#type-global_state">global_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-chain_state">chain_state</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p>Look up for a chain by the hash of its genesis block.</p></dd></dl><dl><dt class="spec value" id="val-get_opt"><a href="#val-get_opt" class="anchor"></a><code><span class="keyword">val</span> get_opt : <a href="../index.html#type-global_state">global_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-chain_state">chain_state</a> option</span> Lwt.t</span></code></dt><dt class="spec value" id="val-get_exn"><a href="#val-get_exn" class="anchor"></a><code><span class="keyword">val</span> get_exn : <a href="../index.html#type-global_state">global_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-chain_state">chain_state</a> Lwt.t</span></code></dt><dt class="spec value" id="val-main"><a href="#val-main" class="anchor"></a><code><span class="keyword">val</span> main : <a href="../index.html#type-global_state">global_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></code></dt><dt class="spec value" id="val-test"><a href="#val-test" class="anchor"></a><code><span class="keyword">val</span> test : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span><span><a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> option</span> Lwt.t</span></code></dt><dt class="spec value" id="val-all"><a href="#val-all" class="anchor"></a><code><span class="keyword">val</span> all : <a href="../index.html#type-global_state">global_state</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-chain_state">chain_state</a> <a href="../../../tezos-error-monad/Tezos_error_monad__TzLwtreslib/Seq/index.html#type-t">Tezos_base__TzPervasives.Seq.t</a></span> Lwt.t</span></code></dt><dd><p>Returns all the known chains.</p></dd></dl><dl><dt class="spec value" id="val-destroy"><a href="#val-destroy" class="anchor"></a><code><span class="keyword">val</span> destroy : <a href="../index.html#type-global_state">global_state</a> <span>&#45;&gt;</span> <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Destroy a chain: this completely removes from the local storage all the data associated to the chain (this includes blocks and operations).</p></dd></dl><dl><dt class="spec value" id="val-id"><a href="#val-id" class="anchor"></a><code><span class="keyword">val</span> id : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></code></dt><dd><p>Various accessors.</p></dd></dl><dl><dt class="spec value" id="val-genesis"><a href="#val-genesis" class="anchor"></a><code><span class="keyword">val</span> genesis : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Genesis/index.html#type-t">Tezos_base__TzPervasives.Genesis.t</a></code></dt><dt class="spec value" id="val-global_state"><a href="#val-global_state" class="anchor"></a><code><span class="keyword">val</span> global_state : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../index.html#type-global_state">global_state</a></code></dt><dt class="spec value" id="val-faked_genesis_hash"><a href="#val-faked_genesis_hash" class="anchor"></a><code><span class="keyword">val</span> faked_genesis_hash : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></code></dt><dd><p>Hash of the faked block header of the genesis block.</p></dd></dl><dl><dt class="spec value" id="val-expiration"><a href="#val-expiration" class="anchor"></a><code><span class="keyword">val</span> expiration : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span><a href="../../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a> option</span></code></dt><dd><p>Return the expiration timestamp of a test chain.</p></dd></dl><dl><dt class="spec value" id="val-allow_forked_chain"><a href="#val-allow_forked_chain" class="anchor"></a><code><span class="keyword">val</span> allow_forked_chain : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-checkpoint"><a href="#val-checkpoint" class="anchor"></a><code><span class="keyword">val</span> checkpoint : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> Lwt.t</span></code></dt><dt class="spec value" id="val-save_point"><a href="#val-save_point" class="anchor"></a><code><span class="keyword">val</span> save_point : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span><span>(Stdlib.Int32.t * <a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a>)</span> Lwt.t</span></code></dt><dt class="spec value" id="val-caboose"><a href="#val-caboose" class="anchor"></a><code><span class="keyword">val</span> caboose : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span><span>(Stdlib.Int32.t * <a href="../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a>)</span> Lwt.t</span></code></dt><dt class="spec value" id="val-store"><a href="#val-store" class="anchor"></a><code><span class="keyword">val</span> store : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span><a href="../../Tezos_legacy_store/Legacy_store/index.html#type-t">Tezos_legacy_store.Legacy_store.t</a> Lwt.t</span></code></dt><dt class="spec value" id="val-set_checkpoint"><a href="#val-set_checkpoint" class="anchor"></a><code><span class="keyword">val</span> set_checkpoint : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Update the current checkpoint. The current head should be consistent (i.e. it should either have a lower level or pass through the checkpoint). In the process all the blocks from invalid alternate heads are removed from the disk, either completely (when `level &lt;= checkpoint`) or still tagged as invalid (when `level &gt; checkpoint`).</p></dd></dl><dl><dt class="spec value" id="val-set_checkpoint_then_purge_full"><a href="#val-set_checkpoint_then_purge_full" class="anchor"></a><code><span class="keyword">val</span> set_checkpoint_then_purge_full : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p>Apply <code>set_checkpoint</code> then <code>purge_full</code> (see <span class="xref-unresolved" title="unresolved reference to &quot;History_mode.Legacy.t&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;History_mode.Legacy&quot;"><code>History_mode</code>.Legacy</span>.t</span>).</p></dd></dl><dl><dt class="spec value" id="val-set_checkpoint_then_purge_rolling"><a href="#val-set_checkpoint_then_purge_rolling" class="anchor"></a><code><span class="keyword">val</span> set_checkpoint_then_purge_rolling : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p>Apply <code>set_checkpoint</code> then <code>purge_rolling</code> (see <span class="xref-unresolved" title="unresolved reference to &quot;History_mode.Legacy.t&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;History_mode.Legacy&quot;"><code>History_mode</code>.Legacy</span>.t</span>).</p></dd></dl><dl><dt class="spec value" id="val-acceptable_block"><a href="#val-acceptable_block" class="anchor"></a><code><span class="keyword">val</span> acceptable_block : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p>Check that a block is compatible with the current checkpoint. This function assumes that the predecessor is known valid.</p></dd></dl><dl><dt class="spec value" id="val-all_indexed_protocols"><a href="#val-all_indexed_protocols" class="anchor"></a><code><span class="keyword">val</span> all_indexed_protocols : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <span><span><span>(int * <span>(<a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> * int32)</span>)</span> list</span> Lwt.t</span></code></dt><dd><p>List all the indexed protocols in the chain. The resulting list contains elements of the form <code>&lt;proto_level&gt;, (&lt;proto_hash&gt;,
     &lt;activation_level&gt;)</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_level_indexed_protocol"><a href="#val-get_level_indexed_protocol" class="anchor"></a><code><span class="keyword">val</span> get_level_indexed_protocol : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span><a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> Lwt.t</span></code></dt><dd><p>Get the level indexed chain protocol store for the given header.</p></dd></dl><dl><dt class="spec value" id="val-update_level_indexed_protocol_store"><a href="#val-update_level_indexed_protocol_store" class="anchor"></a><code><span class="keyword">val</span> update_level_indexed_protocol_store : <a href="index.html#type-chain_state">chain_state</a> <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Update the level indexed chain protocol store so that the block can easily access its corresponding protocol hash from the protocol level in its header. Also stores the transition block level.</p></dd></dl></div></body></html>