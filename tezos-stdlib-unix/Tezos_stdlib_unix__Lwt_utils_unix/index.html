<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tezos_stdlib_unix__Lwt_utils_unix (tezos-stdlib-unix.Tezos_stdlib_unix__Lwt_utils_unix)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">tezos-stdlib-unix</a> &#x00BB; Tezos_stdlib_unix__Lwt_utils_unix</nav><h1>Module <code>Tezos_stdlib_unix__Lwt_utils_unix</code></h1></header><dl><dt class="spec value" id="val-default_net_timeout"><a href="#val-default_net_timeout" class="anchor"></a><code><span class="keyword">val</span> default_net_timeout : <span>Ptime.Span.t Stdlib.ref</span></code></dt><dd><p><code>default_net_timeout</code> is the default timeout used by functions in this library which admit a timeout value, i.e. <code>read_bytes_with_timeout</code>, <code>Socket.connect</code>, <code>Socket.recv</code>.</p></dd></dl><dl><dt class="spec value" id="val-read_bytes_with_timeout"><a href="#val-read_bytes_with_timeout" class="anchor"></a><code><span class="keyword">val</span> read_bytes_with_timeout : <span>?&#8288;timeout:Ptime.Span.t</span> <span>&#45;&gt;</span> <span>?&#8288;file_offset:int</span> <span>&#45;&gt;</span> <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> Lwt_unix.file_descr <span>&#45;&gt;</span> bytes <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>read_bytes_with_timeout ?timeout ?file_offset ?pos ?len fd buf</code> reads <code>len-pos</code> bytes from <code>fd</code> into <code>bytes</code>. If <code>file_offset</code> is given, <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.pread&quot;"><code>Lwt_unix</code>.pread</span> will be used instead of <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.read&quot;"><code>Lwt_unix</code>.read</span>.</p><dl><dt>raises Lwt_unix.Timeout</dt><dd><p>if the operation failed to finish within a <code>timeout</code> time span.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-read_bytes"><a href="#val-read_bytes" class="anchor"></a><code><span class="keyword">val</span> read_bytes : <span>?&#8288;file_offset:int</span> <span>&#45;&gt;</span> <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> Lwt_unix.file_descr <span>&#45;&gt;</span> bytes <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>read_bytes ?file_offset ?pos ?len fd buf</code> reads <code>len-pos</code> bytes from <code>fd</code> into <code>bytes</code>. If <code>file_offset</code> is given, <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.pread&quot;"><code>Lwt_unix</code>.pread</span> will be used instead of <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.read&quot;"><code>Lwt_unix</code>.read</span>.</p></dd></dl><dl><dt class="spec value" id="val-write_string"><a href="#val-write_string" class="anchor"></a><code><span class="keyword">val</span> write_string : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> Lwt_unix.file_descr <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-write_bytes"><a href="#val-write_bytes" class="anchor"></a><code><span class="keyword">val</span> write_bytes : <span>?&#8288;file_offset:int</span> <span>&#45;&gt;</span> <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> Lwt_unix.file_descr <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>write_bytes ?file_offset ?pos ?len fd buf</code> writes <code>len-pos</code> bytes from <code>bytes</code> to <code>fd</code>. If <code>file_offset</code> is given, <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.pwrite&quot;"><code>Lwt_unix</code>.pwrite</span> will be used instead of <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.write&quot;"><code>Lwt_unix</code>.write</span>.</p><dl><dt>raises Lwt_unix.Timeout</dt><dd><p>if the operation failed to finish within a <code>timeout</code> time span.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-is_directory"><a href="#val-is_directory" class="anchor"></a><code><span class="keyword">val</span> is_directory : string <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>is_directory path</code> tests if the given <code>path</code> refers to a directory (file kind is <code>S_DIR</code>). Returns <code>false</code> if <code>path</code> refers to a symbolic link.</p></dd></dl><dl><dt class="spec value" id="val-remove_dir"><a href="#val-remove_dir" class="anchor"></a><code><span class="keyword">val</span> remove_dir : string <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-create_dir"><a href="#val-create_dir" class="anchor"></a><code><span class="keyword">val</span> create_dir : <span>?&#8288;perm:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-copy_dir"><a href="#val-copy_dir" class="anchor"></a><code><span class="keyword">val</span> copy_dir : <span>?&#8288;perm:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>copy_dir ?perm src dst</code> copies the content of directory <code>src</code> in a fresh directory <code>dst</code> created with <code>perm</code> (0o755 by default).</p><dl><dt>raises Unix_error(ENOTDIR,_,_)</dt><dd><p>if the given file is not a directory.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-read_file"><a href="#val-read_file" class="anchor"></a><code><span class="keyword">val</span> read_file : string <span>&#45;&gt;</span> <span>string Lwt.t</span></code></dt><dt class="spec value" id="val-copy_file"><a href="#val-copy_file" class="anchor"></a><code><span class="keyword">val</span> copy_file : <span>src:string</span> <span>&#45;&gt;</span> <span>dst:string</span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-create_file"><a href="#val-create_file" class="anchor"></a><code><span class="keyword">val</span> create_file : <span>?&#8288;close_on_exec:bool</span> <span>&#45;&gt;</span> <span>?&#8288;perm:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-with_tempdir"><a href="#val-with_tempdir" class="anchor"></a><code><span class="keyword">val</span> with_tempdir : string <span>&#45;&gt;</span> <span>(string <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt><dt class="spec value" id="val-safe_close"><a href="#val-safe_close" class="anchor"></a><code><span class="keyword">val</span> safe_close : Lwt_unix.file_descr <span>&#45;&gt;</span> <span><span>unit <a href="../../tezos-error-monad/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_error_monad.Error_monad.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-getaddrinfo"><a href="#val-getaddrinfo" class="anchor"></a><code><span class="keyword">val</span> getaddrinfo : <span>passive:bool</span> <span>&#45;&gt;</span> <span>node:string</span> <span>&#45;&gt;</span> <span>service:string</span> <span>&#45;&gt;</span> <span><span><span>(Ipaddr.V6.t * int)</span> list</span> Lwt.t</span></code></dt><dt class="spec value" id="val-getpass"><a href="#val-getpass" class="anchor"></a><code><span class="keyword">val</span> getpass : unit <span>&#45;&gt;</span> string</code></dt><dd><p><code>getpass ()</code> reads a password from stdio while setting-up the terminal to not display the password being typed.</p></dd></dl><div class="spec module" id="module-Json"><a href="#module-Json" class="anchor"></a><code><span class="keyword">module</span> <a href="Json/index.html">Json</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-retry"><a href="#val-retry" class="anchor"></a><code><span class="keyword">val</span> retry : <span>?&#8288;log:<span>(<span class="type-var">'error</span> <span>&#45;&gt;</span> <span>unit Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;n:int</span> <span>&#45;&gt;</span> <span>?&#8288;sleep:float</span> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> Stdlib.result</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> Stdlib.result</span> Lwt.t</span></code></dt></dl><dl><dt class="spec type" id="type-io_error"><a href="#type-io_error" class="anchor"></a><code><span class="keyword">type</span> <span>'action io_error</span></code><code> = </code><code>{</code><table class="record"><tr id="type-io_error.action" class="anchored"><td class="def field"><a href="#type-io_error.action" class="anchor"></a><code>action : <span class="type-var">'action</span>;</code></td><td class="doc"><p>action which triggerred the error.</p></td></tr><tr id="type-io_error.unix_code" class="anchored"><td class="def field"><a href="#type-io_error.unix_code" class="anchor"></a><code>unix_code : Unix.error;</code></td><td class="doc"><p>Unix code error.</p></td></tr><tr id="type-io_error.caller" class="anchored"><td class="def field"><a href="#type-io_error.caller" class="anchor"></a><code>caller : string;</code></td><td class="doc"><p>Unix function which triggerred the error.</p></td></tr><tr id="type-io_error.arg" class="anchored"><td class="def field"><a href="#type-io_error.arg" class="anchor"></a><code>arg : string;</code></td><td class="doc"><p>Argument given to the unix function: generally a path.</p></td></tr></table><code>}</code></dt><dd><p><code>with_io_error</code> aims to be used as the error type for the <code>with_*</code> functions below. The <code>action</code> type is the action which trigerred the error.</p></dd></dl><dl><dt class="spec value" id="val-with_open_file"><a href="#val-with_open_file" class="anchor"></a><code><span class="keyword">val</span> with_open_file : <span>flags:<span>Unix.open_flag list</span></span> <span>&#45;&gt;</span> <span>?&#8288;perm:Unix.file_perm</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>(Lwt_unix.file_descr <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'a</span>, <span><span>[ `Open <span>| `Close</span> ]</span> <a href="index.html#type-io_error">io_error</a></span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>with_open_file ~flags ~perm filename f</code> opens the given file using <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.open_file&quot;"><code>Lwt_unix</code>.open_file</span> and passes the resulting file-descriptor to <code>f</code>. <code>with_open_file</code> ensures that the file-descriptor is closed when the promise returned by <code>f</code> resolves, or if <code>f</code> raises an exception.</p><p>See <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_unix.openfile&quot;"><code>Lwt_unix</code>.openfile</span> for a description of the arguments, warnings, and other notes. Default values for <code>perm</code> is <code>0o640</code>.</p><p>Exceptions raised whilst opening or closing the file are wrapped in <code>Error</code>. When the error is <code>`Open</code>, the file could not be opened, and therefore the function <code>f</code> has not been run. When the error is <code>`Closed</code>, the function <code>f</code> was run but the file could not be closed.</p><p>Other exceptions are reraised.</p></dd></dl><dl><dt class="spec value" id="val-with_open_out"><a href="#val-with_open_out" class="anchor"></a><code><span class="keyword">val</span> with_open_out : <span>?&#8288;overwrite:bool</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>(Lwt_unix.file_descr <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'a</span>, <span><span>[ `Open <span>| `Close</span> ]</span> <a href="index.html#type-io_error">io_error</a></span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>with_open_out ?overwrite filename f</code> uses <code>with_open_file</code> with the flags <code>O_WRONLY; O_CREAT; O_CLOEXEC</code> and the default permissions. The flag <code>O_TRUNC</code> is added if <code>overwrite</code> is <code>true</code>, which is the case by default.</p></dd></dl><dl><dt class="spec value" id="val-with_atomic_open_out"><a href="#val-with_atomic_open_out" class="anchor"></a><code><span class="keyword">val</span> with_atomic_open_out : <span>?&#8288;overwrite:bool</span> <span>&#45;&gt;</span> <span>?&#8288;temp_dir:string</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>(Lwt_unix.file_descr <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'a</span>, <span><span>[ `Open <span>| `Close</span> <span>| `Rename</span> ]</span> <a href="index.html#type-io_error">io_error</a></span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>with_atomic_open_out ?overwrite ?temp_dir filename f</code> is a wrapper around <code>with_open_out</code> were it ensures that the data are written onto <code>filename</code> in an atomic way.</p><p>This function uses a temporary file stored in the <code>temp_dir</code> directory. Then, this temporary filed is renamed as <code>filename</code>.</p><p>The renaming may fail, for example if the temporary file is not on the same partition as <code>filename</code>.</p><p>If the renaming fails, an error <code>`Rename</code> is returned. See <a href="index.html#val-with_open_file"><code>with_open_file</code></a> for a description of the other errors. In that case, no write have been done on <code>filename</code>.</p><p>The default value of <code>temp_dir</code> is the same as <code>Filename.temp_file</code>.</p></dd></dl><dl><dt class="spec value" id="val-with_open_in"><a href="#val-with_open_in" class="anchor"></a><code><span class="keyword">val</span> with_open_in : string <span>&#45;&gt;</span> <span>(Lwt_unix.file_descr <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'a</span>, <span><span>[ `Open <span>| `Close</span> ]</span> <a href="index.html#type-io_error">io_error</a></span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>with_open_in filename f</code> uses <code>with_open_file</code> with the flags <code>O_RDONLY; O_CLOEXEC</code> and the default permissions.</p></dd></dl></div></body></html>