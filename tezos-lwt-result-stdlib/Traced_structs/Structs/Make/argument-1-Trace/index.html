<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>1-Trace (tezos-lwt-result-stdlib.Traced_structs.Structs.Make.1-Trace)</title><link rel="stylesheet" href="../../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">tezos-lwt-result-stdlib</a> &#x00BB; <a href="../../../index.html">Traced_structs</a> &#x00BB; <a href="../../index.html">Structs</a> &#x00BB; <a href="../index.html">Make</a> &#x00BB; 1-Trace</nav><h1>Parameter <code>Make.1-Trace</code></h1></header><dl><dt class="spec type" id="type-trace"><a href="#type-trace" class="anchor"></a><code><span class="keyword">type</span> <span>'error trace</span></code></dt><dd><p><code>trace</code> are the errors as received from the monad. In other words, <code>trace</code> is the type of values that are seen when matching on <code>Error _</code> to, say, recover.</p><p>The types <code>'error</code> and <code>'error trace</code> are kept separate (although they can be equal) to support cases such as the following:</p><ul><li><code>trace</code> are richer than <code>error</code>, such as by including a timestamp, a filename, or some other such metadata.</li><li><code>trace</code> is a <code>private</code> type or an <code>abstract</code> type and <code>error</code> is the type of argument to the functions that construct the private/abstract <code>trace</code>.</li><li><code>trace</code> is a collection of <code>error</code> and additional functions (not required by this library) allow additional manipulation. E.g., in the case of Tezos: errors are built into traces that can be grown.</li></ul><p>There is <em>some</em> leeway about what traces are, what information they carry, etc. Beyond this leeway, Lwtreslib is opinionated about traces. Specifically, Lwtreslib has a notion of <em>sequential</em> and <em>parallel</em> composition. A trace can be either of the following.</p><ul><li>A <em>single-error trace</em>, i.e., the simplest possible trace that corresponds to a simple failure/issue/unexpected behaviour in the program. See <code>make</code>.</li><li>A <em>sequential trace</em>, i.e., a trace of errors where one precedes another. This is used to contextualise failures. E.g., in a high-level network handshaking function, a low-level I/O error may be built into a trace that shows how the low-level error caused a high-level issue). See <code>cons</code>.</li><li>A <em>parallel trace</em>, i.e., a trace of errors that happened in concurrent (or non-causally related) parts of the program. See <code>conp</code>.</li></ul></dd></dl><dl><dt class="spec value" id="val-make"><a href="#val-make" class="anchor"></a><code><span class="keyword">val</span> make : <span class="type-var">'error</span> <span>&#45;&gt;</span> <span><span class="type-var">'error</span> <a href="index.html#type-trace">trace</a></span></code></dt><dd><p><code>make e</code> is a trace made of one single error.</p></dd></dl><dl><dt class="spec value" id="val-cons"><a href="#val-cons" class="anchor"></a><code><span class="keyword">val</span> cons : <span class="type-var">'error</span> <span>&#45;&gt;</span> <span><span class="type-var">'error</span> <a href="index.html#type-trace">trace</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'error</span> <a href="index.html#type-trace">trace</a></span></code></dt><dd><p><code>cons e t</code> is a trace made of the error <code>e</code> composed sequentially with the trace <code>t</code>.</p><p>Typically, this is used to give context to a low-level error.</p><pre><code class="ml">let query key =
  connect_to_server () &gt;&gt;=? fun c -&gt;
  send_query_over_connection c key &gt;&gt;=? fun r -&gt;
  check_response r &gt;&gt;=? fun () -&gt;
  return r

let query key =
  query_key &gt;|= function
  | Ok r -&gt; Ok r
  | Error trace -&gt; Error (cons `Query_failure trace)</code></pre></dd></dl><dl><dt class="spec value" id="val-cons_list"><a href="#val-cons_list" class="anchor"></a><code><span class="keyword">val</span> cons_list : <span class="type-var">'error</span> <span>&#45;&gt;</span> <span><span class="type-var">'error</span> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'error</span> <a href="index.html#type-trace">trace</a></span></code></dt><dd><p><code>cons_list error errors</code> is the sequential composition of all the errors passed as parameters. It is equivalent to folding <code>cons</code> over <code>List.rev (error :: errors)</code> but more efficient.</p><p>Note that <code>error</code> and <code>errors</code> are separated as parameters to enforce that empty traces cannot be constructed. The recommended use is:</p><pre><code class="ml">match a_bunch_of_errors with
| [] -&gt; Ok () (* or something else depending on the context *)
| error :: errors -&gt; Error (cons_list error errors)</code></pre></dd></dl><dl><dt class="spec value" id="val-conp"><a href="#val-conp" class="anchor"></a><code><span class="keyword">val</span> conp : <span><span class="type-var">'error</span> <a href="index.html#type-trace">trace</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'error</span> <a href="index.html#type-trace">trace</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'error</span> <a href="index.html#type-trace">trace</a></span></code></dt><dd><p><code>conp t1 t2</code> is a trace made of the traces <code>t1</code> and <code>t2</code> composed concurrently.</p></dd></dl><dl><dt class="spec value" id="val-conp_list"><a href="#val-conp_list" class="anchor"></a><code><span class="keyword">val</span> conp_list : <span><span class="type-var">'err</span> <a href="index.html#type-trace">trace</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'err</span> <a href="index.html#type-trace">trace</a></span> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'err</span> <a href="index.html#type-trace">trace</a></span></code></dt><dd><p><code>conp_list trace traces</code> is the parallel composition of all the traces passed as parameters. It is equivalent to <code>List.fold_left conp trace traces</code> but more efficient.</p><p>Note that <code>trace</code> and <code>traces</code> are separated as parameters to enforce that empty traces cannot be constructed. The recommended use is:</p><pre><code class="ml">match a_bunch_of_traces with
| [] -&gt; Ok () (* or something else depending on the context *)
| trace :: traces -&gt; Error (conp_list trace traces)</code></pre></dd></dl><aside><p>Note that the Lwtreslib's library does not require it, but it is recommended that you also make, for your own use, a pretty-printing function as well as some introspection functions.</p><p>One possible extension can be found in <code>examples/traces/traces.ml</code>.</p></aside></div></body></html>