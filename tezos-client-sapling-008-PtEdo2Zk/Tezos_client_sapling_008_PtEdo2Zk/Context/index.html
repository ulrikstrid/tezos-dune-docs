<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Context (tezos-client-sapling-008-PtEdo2Zk.Tezos_client_sapling_008_PtEdo2Zk.Context)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tezos-client-sapling-008-PtEdo2Zk</a> &#x00BB; <a href="../index.html">Tezos_client_sapling_008_PtEdo2Zk</a> &#x00BB; Context</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_client_sapling_008_PtEdo2Zk.Context</span></code></h1><p>This module allows the creation Sapling transactions: shield, unshield and transfer. Because Sapling uses an UTXO model, it is necessary for the client to maintain locally the set of unspent outputs for each viewing key, for each smart contract. This operation is called scanning. This local cache is updated downloading from the node only the difference from the last scanned state.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Tez" class="anchored"><a href="#module-Tez" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Tez/index.html">Tez</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../../../tezos-protocol-008-PtEdo2Zk/Tezos_raw_protocol_008_PtEdo2Zk/Alpha_context/Tez/index.html">Tezos_protocol_008_PtEdo2Zk.Protocol.Alpha_context.Tez</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Shielded_tez" class="anchored"><a href="#module-Shielded_tez" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Shielded_tez/index.html">Shielded_tez</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>This module is used to represent any shielded token to avoid confusing it with Tez.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Shielded_tez_contract_input" class="anchored"><a href="#module-Shielded_tez_contract_input" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Shielded_tez_contract_input/index.html">Shielded_tez_contract_input</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Actual input to a smart contract handling Sapling transactions</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Account" class="anchored"><a href="#module-Account" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Account/index.html">Account</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Account corresponding to a contract and a viewing key</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Contract_state" class="anchored"><a href="#module-Contract_state" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Contract_state/index.html">Contract_state</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>State of a contract, potentially involving several viewing keys</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Client_state" class="anchored"><a href="#module-Client_state" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Client_state/index.html">Client_state</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-shield" class="anchored"><a href="#val-shield" class="anchor"></a><code><span><span class="keyword">val</span> shield : <span><span class="xref-unresolved">Tezos_client_base</span>.Client_context.#full <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a> <span class="arrow">&#45;&gt;</span></span> <span>?message:bytes <span class="arrow">&#45;&gt;</span></span>
<span><a href="Tez/index.html#type-t">Tez.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Contract_state/index.html#type-t">Contract_state.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="Shielded_tez_contract_input/index.html#type-t">Shielded_tez_contract_input.t</a>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>shield ~message ~dst tez cstate anti-replay</code> returns a transaction shielding <code>tez</code> tez to a sapling address <code>dst</code> using a sapling storage <code>cstate</code> and the anti-replay string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unshield" class="anchored"><a href="#val-unshield" class="anchor"></a><code><span><span class="keyword">val</span> unshield : <span>src:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Spending_key/index.html#type-t">Tezos_sapling.Core.Client.Spending_key.t</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="../../../tezos-crypto/Tezos_crypto/Signature/index.html#type-public_key_hash">Tezos_crypto.Signature.public_key_hash</a> <span class="arrow">&#45;&gt;</span></span> <span>backdst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Shielded_tez/index.html#type-t">Shielded_tez.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Contract_state/index.html#type-t">Contract_state.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="Shielded_tez_contract_input/index.html#type-t">Shielded_tez_contract_input.t</a>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>unshield ~src_name ~src ~dst ~backdst stez cstate storage</code> returns a transaction unshielding <code>stez</code> shielded tokens from a sapling wallet <code>src</code> to a transparent tezos address <code>dst</code>, sending the change back to <code>backdst</code> and using a Sapling storage <code>cstate</code> and a anti-replay string. The transaction is refused if there is an insufficient amount of shielded tez in the wallet <code>src</code>, the error is raised with <code>src_name</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-transfer" class="anchored"><a href="#val-transfer" class="anchor"></a><code><span><span class="keyword">val</span> transfer : <span><span class="xref-unresolved">Tezos_client_base</span>.Client_context.#full <span class="arrow">&#45;&gt;</span></span> <span>src:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Spending_key/index.html#type-t">Tezos_sapling.Core.Client.Spending_key.t</a> <span class="arrow">&#45;&gt;</span></span> <span>dst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a> <span class="arrow">&#45;&gt;</span></span> <span>backdst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a> <span class="arrow">&#45;&gt;</span></span> <span>?message:bytes <span class="arrow">&#45;&gt;</span></span>
<span><a href="Shielded_tez/index.html#type-t">Shielded_tez.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Contract_state/index.html#type-t">Contract_state.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/UTXO/index.html#type-transaction">Tezos_sapling.Core.Client.UTXO.transaction</a>, <span><a href="../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>transfer ~message ~src ~dst ~backdst amount cstate anti-replay</code> creates a Sapling transaction of <code>amount</code> shielded tez from Sapling wallet <code>src</code> to Sapling address <code>dst</code>, sending the change to <code>backdst</code>, using a Sapling storage <code>cstate</code> and a anti-replay string. <code>~message</code> is a message that will be uploaded encrypted on chain.</p></div></div></div></body></html>