<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Protocol (tezt-tezos.Tezt_tezos.Protocol)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Protocol</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Protocol</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span></code><table><tr id="type-t.Edo" class="anchored"><td class="def variant constructor"><a href="#type-t.Edo" class="anchor"></a><code><span>| </span><span><span class="constructor">Edo</span></span></code></td></tr><tr id="type-t.Florence" class="anchored"><td class="def variant constructor"><a href="#type-t.Florence" class="anchor"></a><code><span>| </span><span><span class="constructor">Florence</span></span></code></td></tr><tr id="type-t.Alpha" class="anchored"><td class="def variant constructor"><a href="#type-t.Alpha" class="anchor"></a><code><span>| </span><span><span class="constructor">Alpha</span></span></code></td></tr></table></div><div class="spec-doc"><p>Protocols we may want to test with.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-constants" class="anchored"><a href="#type-constants" class="anchor"></a><code><span><span class="keyword">type</span> constants</span><span> = </span></code><table><tr id="type-constants.Constants_sandbox" class="anchored"><td class="def variant constructor"><a href="#type-constants.Constants_sandbox" class="anchor"></a><code><span>| </span><span><span class="constructor">Constants_sandbox</span></span></code></td></tr><tr id="type-constants.Constants_mainnet" class="anchored"><td class="def variant constructor"><a href="#type-constants.Constants_mainnet" class="anchor"></a><code><span>| </span><span><span class="constructor">Constants_mainnet</span></span></code></td></tr><tr id="type-constants.Constants_test" class="anchored"><td class="def variant constructor"><a href="#type-constants.Constants_test" class="anchor"></a><code><span>| </span><span><span class="constructor">Constants_test</span></span></code></td></tr></table></div><div class="spec-doc"><p>Protocol parameters.</p><p>These values denote which file to use from the <code>&quot;parameters&quot;</code> directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_constants" class="anchored"><a href="#val-default_constants" class="anchor"></a><code><span><span class="keyword">val</span> default_constants : <a href="#type-constants">constants</a></span></code></div><div class="spec-doc"><p>The default constants used by tests: <code>Constants_sandbox</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-name" class="anchored"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the name of a protocol, capitalized (e.g. <code>&quot;Edo&quot;</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tag" class="anchored"><a href="#val-tag" class="anchor"></a><code><span><span class="keyword">val</span> tag : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the name of a protocol as a tag, for use when registering tests (e.g. <code>&quot;edo&quot;</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-hash" class="anchored"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the full hash of a protocol.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parameter_file" class="anchored"><a href="#val-parameter_file" class="anchor"></a><code><span><span class="keyword">val</span> parameter_file : <span>?constants:<a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the location of the parameter file.</p><p>This returns the path to one of the parameter files of the <code>&quot;parameters&quot;</code> directory of the protocol, relative to the root of the repository.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-accuser" class="anchored"><a href="#val-accuser" class="anchor"></a><code><span><span class="keyword">val</span> accuser : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the path of the accuser of a protocol, such as <code>&quot;./tezos-accuser-alpha&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-daemon_name" class="anchored"><a href="#val-daemon_name" class="anchor"></a><code><span><span class="keyword">val</span> daemon_name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the part of the daemon name that is specific to a protocol (e.g. <code>&quot;008-PtEdo2Zk&quot;</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-encoding_prefix" class="anchored"><a href="#val-encoding_prefix" class="anchor"></a><code><span><span class="keyword">val</span> encoding_prefix : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the part which is added at the beginning of all encoding names.</p><p>It turns out this is equal to what the <code>daemon_name</code> function returns.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-parameter_overrides" class="anchored"><a href="#type-parameter_overrides" class="anchor"></a><code><span><span class="keyword">type</span> parameter_overrides</span><span> = <span><span>(<span>string list</span> * <span>string option</span>)</span> list</span></span></code></div><div class="spec-doc"><p>Values to override in protocol parameters.</p><p>The are pairs of JSON paths and optional values that can be used to override or remove (when the value is <code>None</code>) the default parameters when activating protocol.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_parameter_file" class="anchored"><a href="#val-write_parameter_file" class="anchor"></a><code><span><span class="keyword">val</span> write_parameter_file : <span>protocol:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-parameter_overrides">parameter_overrides</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Write a protocol parameter file.</p><p>Default values are used, except for values given as <code>parameter_overrides</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-next_protocol" class="anchored"><a href="#val-next_protocol" class="anchor"></a><code><span><span class="keyword">val</span> next_protocol : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p>Get the successor of a protocol.</p><p>WARNING: use of this function is discouraged, because:</p><ul><li>a protocol may have several possible successors;</li><li>it prevents the type-checker from telling you that your test can no longer run when removing a protocol.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-previous_protocol" class="anchored"><a href="#val-previous_protocol" class="anchor"></a><code><span><span class="keyword">val</span> previous_protocol : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p>Get the predecessor of a protocol.</p><p>WARNING: use of this function is discouraged, because it prevents the type-checker from telling you that your test can no longer run when removing a protocol.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-all" class="anchored"><a href="#val-all" class="anchor"></a><code><span><span class="keyword">val</span> all : <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Get the list of all protocols.</p><p>WARNING: use of this function is discouraged, because:</p><ul><li>if we add protocols such as demo-noop or demo-counter to type <code>t</code>, it would be awkward to add them to <code>all</code> if <code>all</code> only contained &quot;real&quot; protocols up to now, and it would also be awkward not to add them to <code>all</code>;</li><li>it is easier for maintainers if the list of protocols a test runs on is clearly defined where the test is registered.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-current_mainnet" class="anchored"><a href="#val-current_mainnet" class="anchor"></a><code><span><span class="keyword">val</span> current_mainnet : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>The protocol that is currently active on Mainnet.</p><p>Use this when registering tests that are not expected to break in future protocols.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-register_test" class="anchored"><a href="#val-register_test" class="anchor"></a><code><span><span class="keyword">val</span> register_test : <span>__FILE__:string <span class="arrow">&#45;&gt;</span></span> <span>title:string <span class="arrow">&#45;&gt;</span></span> <span>tags:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>protocols:<span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a test that uses the protocol.</p><p>This is the same as <code>Test.register</code> except that:</p><ul><li>the name of the protocol is automatically added at the beginning of <code>title</code>;</li><li>the name of the protocol is automatically added as a tag in <code>tags</code>;</li><li>the function that implements the test takes a protocol as parameter;</li><li>an additional parameter gives the list of protocols to run the test on.</li></ul><p>The list of protocol is the last parameter because this function is intended to be applied partially, without this list; the test function being the parameter of type <code>t -&gt; unit Lwt.t</code> before the list. The list of protocols is specified in <code>main.ml</code>, next to the registration of all other tests, so that it is easy to see at a glance which tests run on which protocols.</p><p>If your test involves several protocols (for instance to test migration), use <code>Test.register</code> directly.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-register_regression_test" class="anchored"><a href="#val-register_regression_test" class="anchor"></a><code><span><span class="keyword">val</span> register_regression_test : <span>__FILE__:string <span class="arrow">&#45;&gt;</span></span> <span>title:string <span class="arrow">&#45;&gt;</span></span>
<span>tags:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>output_file:string <span class="arrow">&#45;&gt;</span></span> <span>?regression_output_path:string <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>protocols:<span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a regression test that uses the protocol.</p><p>This is the same as <code>Regression.register</code>, with the same differences as <code>Protocol.register_test</code> compared to <code>Test.register</code>.</p></div></div></div></body></html>