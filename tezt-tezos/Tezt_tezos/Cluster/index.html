<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cluster (tezt-tezos.Tezt_tezos.Cluster)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Cluster</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Cluster</span></code></h1><p>Set up networks involving large amount of nodes.</p></header><nav class="odoc-toc"><ul><li><a href="#batch-node-creation">Batch Node Creation</a></li><li><a href="#topologies">Topologies</a></li><li><a href="#meta-topologies">Meta-Topologies</a></li><li><a href="#running">Running</a></li></ul></nav><div class="odoc-content"><p>The applications of this module range from running small cliques to complex network topologies involving as many nodes as your computer can handle.</p><p>The general approach is to create some nodes, then declare connections using functions such as <code>connect</code>, <code>clique</code>, <code>ring</code> or <code>star</code>, and finally start all nodes with <code>start</code>.</p><p>For instance, here is how to create a star topology, with a center node connected to 5 other nodes: <code>
      let center = Node.create [] in
      let other_star_nodes = Cluster.create 5 [] in
      Cluster.star center other_star_nodes;
    </code> Here is how to connect the center node of this star to a clique of 4 other nodes: <code>
      let clique_nodes = Cluster.create 4 [] in
      Cluster.clique clique_nodes;
      Cluster.connect [center] clique_nodes;
    </code> Finally, here is how to start the network: <code>
      Cluster.start (clique_nodes @ center :: other_star_nodes)
    </code></p><h3 id="batch-node-creation"><a href="#batch-node-creation" class="anchor"></a>Batch Node Creation</h3><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>?path:string <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Node/index.html#type-argument">Node.argument</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Node/index.html#type-t">Node.t</a> list</span></span></code></div><div class="spec-doc"><p>Create several nodes.</p><p>Usage: <code>create count arguments</code></p><p>Create <code>count</code> nodes (using <code>Node.create</code>) sharing the same <code>arguments</code>. Each node is named <code>name ^ &quot;.&quot; ^ i</code> where <code>i</code> is the index of the node in the resulting list, starting from 1.</p></div></div><h3 id="topologies"><a href="#topologies" class="anchor"></a>Topologies</h3><div class="odoc-spec"><div class="spec value" id="val-connect" class="anchored"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect all nodes of a cluster to all nodes of another cluster.</p><p>Usage: <code>connect a b</code></p><p>Add all nodes of <code>b</code> as <code>--peer</code> arguments to all nodes of <code>a</code>. This is a generalization of <code>Node.add_peer</code> for lists.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-clique" class="anchored"><a href="#val-clique" class="anchor"></a><code><span><span class="keyword">val</span> clique : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect all nodes of a cluster together.</p><p>For a cluster <code>node1; node2; ...; nodeN</code>, this adds:</p><ul><li><code>node2; ...; nodeN</code> as <code>--peer</code>s to <code>node1</code>;</li><li><code>node3; ...; nodeN</code> as <code>--peer</code>s to <code>node2</code>;</li><li>etc.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-ring" class="anchored"><a href="#val-ring" class="anchor"></a><code><span><span class="keyword">val</span> ring : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect nodes to form a ring.</p><p>For a cluster <code>node1; node2; ...; nodeN</code>, this adds:</p><ul><li><code>node2</code> as <code>--peer</code> to <code>node1</code>;</li><li><code>node3</code> as <code>--peer</code> to <code>node2</code>;</li><li>...</li><li>and finally <code>node1</code> as <code>--peer</code> to <code>nodeN</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-star" class="anchored"><a href="#val-star" class="anchor"></a><code><span><span class="keyword">val</span> star : <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect nodes to form a star.</p><p>Usage: <code>star center other_nodes</code></p><p>Add all <code>other_nodes</code> as <code>--peer</code>s to <code>center</code>.</p></div></div><h3 id="meta-topologies"><a href="#meta-topologies" class="anchor"></a>Meta-Topologies</h3><p>The following functions are similar to the above functions that create topologies, except that they connect clusters using <a href="#val-connect"><code>connect</code></a> instead of nodes using <code>Node.add_peer</code>.</p><p>For instance, a meta-clique <code>a; b; c</code> connects:</p><ul><li>all nodes of <code>a</code> with all nodes of <code>b</code> and <code>c</code>;</li><li>all nodes of <code>b</code> with all nodes of <code>c</code>. The result itself is not necessarily a clique since nodes of each sub-cluster are not necessarily connected between themselves.</li></ul><div class="odoc-spec"><div class="spec value" id="val-meta_clique" class="anchored"><a href="#val-meta_clique" class="anchor"></a><code><span><span class="keyword">val</span> meta_clique : <span><span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Meta-version of <a href="#val-clique"><code>clique</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-meta_ring" class="anchored"><a href="#val-meta_ring" class="anchor"></a><code><span><span class="keyword">val</span> meta_ring : <span><span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Meta-version of <a href="#val-ring"><code>ring</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-meta_star" class="anchored"><a href="#val-meta_star" class="anchor"></a><code><span><span class="keyword">val</span> meta_star : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Meta-version of <a href="#val-star"><code>star</code></a>.</p></div></div><h3 id="running"><a href="#running" class="anchor"></a>Running</h3><div class="odoc-spec"><div class="spec value" id="val-start" class="anchored"><a href="#val-start" class="anchor"></a><code><span><span class="keyword">val</span> start : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Start a cluster of nodes.</p><p>This runs <code>Node.identity_generate</code>, <code>Node.config_init</code> and <code>Node.run</code> for all nodes. This is similar to iterating <code>Node.init</code> except that the node are already created.</p></div></div></div></body></html>