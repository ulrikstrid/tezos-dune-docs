<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Block_validator_process (tezos-shell.Tezos_shell.Block_validator_process)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-shell</a> &#x00BB; <a href="../index.html">Tezos_shell</a> &#x00BB; Block_validator_process</nav><h1>Module <code>Tezos_shell.Block_validator_process</code></h1></header><aside><p>Block_validator_process is used to validate new blocks. This validation can be</p><ul><li>internal: the same processus is used to run the node and to validate blocks</li><li>external: another processus is used to validate blocks This module also ensures the liveness of the operations (see <code>Block_validation:check_liveness</code>).</li></ul></aside><dl><dt class="spec type" id="type-validator_environment"><a href="#type-validator_environment" class="anchor"></a><code><span class="keyword">type</span> validator_environment</code><code> = </code><code>{</code><table class="record"><tr id="type-validator_environment.user_activated_upgrades" class="anchored"><td class="def field"><a href="#type-validator_environment.user_activated_upgrades" class="anchor"></a><code>user_activated_upgrades : <a href="../../../tezos-base/Tezos_base/User_activated/index.html#type-upgrades">Tezos_base.User_activated.upgrades</a>;</code></td><td class="doc"><p>user activated upgrades</p></td></tr><tr id="type-validator_environment.user_activated_protocol_overrides" class="anchored"><td class="def field"><a href="#type-validator_environment.user_activated_protocol_overrides" class="anchor"></a><code>user_activated_protocol_overrides : <a href="../../../tezos-base/Tezos_base/User_activated/index.html#type-protocol_overrides">Tezos_base.User_activated.protocol_overrides</a>;</code></td><td class="doc"><p>user activated protocol overrides</p></td></tr></table><code>}</code></dt><dt class="spec type" id="type-validator_kind"><a href="#type-validator_kind" class="anchor"></a><code><span class="keyword">type</span> validator_kind</code><code> = </code><table class="variant"><tr id="type-validator_kind.Internal" class="anchored"><td class="def constructor"><a href="#type-validator_kind.Internal" class="anchor"></a><code>| </code><code><span class="constructor">Internal</span> : <a href="../../../tezos-store/Tezos_store/Store/Chain/index.html#type-chain_store">Tezos_store.Store.Chain.chain_store</a> <span>&#45;&gt;</span> <a href="index.html#type-validator_kind">validator_kind</a></code></td></tr><tr id="type-validator_kind.External" class="anchored"><td class="def constructor"><a href="#type-validator_kind.External" class="anchor"></a><code>| </code><code><span class="constructor">External</span> : </code><code>{</code><table class="record"><tr id="type-validator_kind.genesis" class="anchored"><td class="def field"><a href="#type-validator_kind.genesis" class="anchor"></a><code>genesis : <a href="../../../tezos-base/Tezos_base/Genesis/index.html#type-t">Tezos_base.Genesis.t</a>;</code></td></tr><tr id="type-validator_kind.data_dir" class="anchored"><td class="def field"><a href="#type-validator_kind.data_dir" class="anchor"></a><code>data_dir : string;</code></td></tr><tr id="type-validator_kind.context_root" class="anchored"><td class="def field"><a href="#type-validator_kind.context_root" class="anchor"></a><code>context_root : string;</code></td></tr><tr id="type-validator_kind.protocol_root" class="anchored"><td class="def field"><a href="#type-validator_kind.protocol_root" class="anchor"></a><code>protocol_root : string;</code></td></tr><tr id="type-validator_kind.process_path" class="anchored"><td class="def field"><a href="#type-validator_kind.process_path" class="anchor"></a><code>process_path : string;</code></td></tr><tr id="type-validator_kind.sandbox_parameters" class="anchored"><td class="def field"><a href="#type-validator_kind.sandbox_parameters" class="anchor"></a><code>sandbox_parameters : <span><a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#module-Data_encoding">Tezos_base__TzPervasives.Data_encoding</a>.json option</span>;</code></td></tr></table><code>}</code><code> <span>&#45;&gt;</span> <a href="index.html#type-validator_kind">validator_kind</a></code></td></tr></table></dt><dd><p>For performances reasons, it may be interesting to use another processus (from the OS) to validate blocks (External). However, in that case, only one processus has a write access to the context. Currently informations are exchanged via the file system.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>Internal representation of the block validator process</p></dd></dl><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : <a href="index.html#type-validator_environment">validator_environment</a> <span>&#45;&gt;</span> <a href="index.html#type-validator_kind">validator_kind</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-t">t</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>close vp</code> closes the given <code>vp</code>. In the case of an <code>External</code> validator process, we first ask the validator to shutdown. If it is still running after 5 seconds, we notice that the block validation process is unresponsive and we force its termination (using a registered Lwt_exit.clean_up_callback).</p></dd></dl><dl><dt class="spec value" id="val-restore_context_integrity"><a href="#val-restore_context_integrity" class="anchor"></a><code><span class="keyword">val</span> restore_context_integrity : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span><span>int option</span> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-apply_block"><a href="#val-apply_block" class="anchor"></a><code><span class="keyword">val</span> apply_block : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../tezos-store/Tezos_store/Store/index.html#type-chain_store">Tezos_store.Store.chain_store</a> <span>&#45;&gt;</span> <span>predecessor:<a href="../../../tezos-store/Tezos_store/Store/Block/index.html#type-t">Tezos_store.Store.Block.t</a></span> <span>&#45;&gt;</span> <a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span>&#45;&gt;</span> <span><span><a href="../../../tezos-base/Tezos_base/Operation/index.html#type-t">Tezos_base.Operation.t</a> list</span> list</span> <span>&#45;&gt;</span> <span><span><a href="../../../tezos-validation/Tezos_validation/Block_validation/index.html#type-result">Tezos_validation.Block_validation.result</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>apply_block bvp predecessor header os</code> checks the liveness of the operations and then call <code>Block_validation.apply</code></p></dd></dl><dl><dt class="spec value" id="val-commit_genesis"><a href="#val-commit_genesis" class="anchor"></a><code><span class="keyword">val</span> commit_genesis : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>chain_id:<a href="../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></span> <span>&#45;&gt;</span> <span><span><a href="../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dt class="spec value" id="val-init_test_chain"><a href="#val-init_test_chain" class="anchor"></a><code><span class="keyword">val</span> init_test_chain : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../tezos-store/Tezos_store/Store/Block/index.html#type-t">Tezos_store.Store.Block.t</a> <span>&#45;&gt;</span> <span><span><a href="../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>init_test_chain</code> must only be called on a forking block.</p></dd></dl></div></body></html>