<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Crypto_box (tezos-base.Tezos_base.TzPervasives.Crypto_box)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezos-base</a> &#x00BB; <a href="../../index.html">Tezos_base</a> &#x00BB; <a href="../index.html">TzPervasives</a> &#x00BB; Crypto_box</nav><header class="odoc-preamble"><h1>Module <code><span>TzPervasives.Crypto_box</span></code></h1><p>Tezos - X25519/XSalsa20-Poly1305 cryptography</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-nonce" class="anchored"><a href="#type-nonce" class="anchor"></a><code><span><span class="keyword">type</span> nonce</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-nonce_size" class="anchored"><a href="#val-nonce_size" class="anchor"></a><code><span><span class="keyword">val</span> nonce_size : int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-zero_nonce" class="anchored"><a href="#val-zero_nonce" class="anchor"></a><code><span><span class="keyword">val</span> zero_nonce : <a href="#type-nonce">nonce</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-random_nonce" class="anchored"><a href="#val-random_nonce" class="anchor"></a><code><span><span class="keyword">val</span> random_nonce : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-nonce">nonce</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-increment_nonce" class="anchored"><a href="#val-increment_nonce" class="anchor"></a><code><span><span class="keyword">val</span> increment_nonce : <span>?step:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-nonce">nonce</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-generate_nonces" class="anchored"><a href="#val-generate_nonces" class="anchor"></a><code><span><span class="keyword">val</span> generate_nonces : <span>incoming:bool <span class="arrow">&#45;&gt;</span></span> <span>sent_msg:<span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span>recv_msg:<span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span>
<a href="#type-nonce">nonce</a> * <a href="#type-nonce">nonce</a></span></code></div><div class="spec-doc"><p><code>generate_nonces ~incoming ~sent_msg ~recv_msg</code> generates two nonces by hashing (Blake2B) the arguments. The nonces should be used to initialize the encryption on the communication channels. Because an attacker cannot control both messages, it cannot determine the nonces that will be used to encrypt the messages. The sent message should contains a random nonce, and we should never send the exact same message twice.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tag_length" class="anchored"><a href="#val-tag_length" class="anchor"></a><code><span><span class="keyword">val</span> tag_length : int</span></code></div><div class="spec-doc"><p>Size of the message authentication tag.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Secretbox" class="anchored"><a href="#module-Secretbox" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Secretbox/index.html">Secretbox</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-pow_target" class="anchored"><a href="#type-pow_target" class="anchor"></a><code><span><span class="keyword">type</span> pow_target</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-default_pow_target" class="anchored"><a href="#val-default_pow_target" class="anchor"></a><code><span><span class="keyword">val</span> default_pow_target : <a href="#type-pow_target">pow_target</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-make_pow_target" class="anchored"><a href="#val-make_pow_target" class="anchor"></a><code><span><span class="keyword">val</span> make_pow_target : <span>float <span class="arrow">&#45;&gt;</span></span> <a href="#type-pow_target">pow_target</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-secret_key" class="anchored"><a href="#type-secret_key" class="anchor"></a><code><span><span class="keyword">type</span> secret_key</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-public_key" class="anchored"><a href="#type-public_key" class="anchor"></a><code><span><span class="keyword">type</span> public_key</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Public_key_hash" class="anchored"><a href="#module-Public_key_hash" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Public_key_hash/index.html">Public_key_hash</a></span><span> : <a href="../../../../tezos-crypto/Tezos_crypto/S/module-type-HASH/index.html">Tezos_crypto.S.HASH</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-channel_key" class="anchored"><a href="#type-channel_key" class="anchor"></a><code><span><span class="keyword">type</span> channel_key</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-hash" class="anchored"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> <a href="Public_key_hash/index.html#type-t">Public_key_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-random_keypair" class="anchored"><a href="#val-random_keypair" class="anchor"></a><code><span><span class="keyword">val</span> random_keypair : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-secret_key">secret_key</a> * <a href="#type-public_key">public_key</a> * <a href="Public_key_hash/index.html#type-t">Public_key_hash.t</a></span></code></div><div class="spec-doc"><p>Generates both a secret key and its corresponding public key, along with a hash of the public key.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-precompute" class="anchored"><a href="#val-precompute" class="anchor"></a><code><span><span class="keyword">val</span> precompute : <span><a href="#type-secret_key">secret_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-channel_key">channel_key</a></span></code></div><div class="spec-doc"><p><code>precompute pk sk</code> computes a channel key from the sender's <code>sk</code> and the recipient's <code>pk</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fast_box" class="anchored"><a href="#val-fast_box" class="anchor"></a><code><span><span class="keyword">val</span> fast_box : <span><a href="#type-channel_key">channel_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Bytes.t</span></code></div><div class="spec-doc"><p><code>fast_box k nonce msg</code> authenticates and encrypts <code>msg</code> and returns both the message authentication tag and the ciphertext. For this reason, the returned buffer will be <code>tagbytes</code> longer than <code>msg</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fast_box_open" class="anchored"><a href="#val-fast_box_open" class="anchor"></a><code><span><span class="keyword">val</span> fast_box_open : <span><a href="#type-channel_key">channel_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t option</span></span></code></div><div class="spec-doc"><p><code>fast_box_open k nonce cmsg</code> attempts to verify and decrypt <code>cmsg</code> and if successful returns the plaintext. As above, the returned buffer will be <code>tagbytes</code> shorter than <code>cmsg</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fast_box_noalloc" class="anchored"><a href="#val-fast_box_noalloc" class="anchor"></a><code><span><span class="keyword">val</span> fast_box_noalloc : <span><a href="#type-channel_key">channel_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>fast_box_noalloc k nonce tag buf</code> authenticates and encrypts in-place the contents of <code>buf</code> using <code>k</code> and <code>nonce</code> and writes the message authentication tag in <code>tag</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fast_box_open_noalloc" class="anchored"><a href="#val-fast_box_open_noalloc" class="anchor"></a><code><span><span class="keyword">val</span> fast_box_open_noalloc : <span><a href="#type-channel_key">channel_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>fast_box_open_noalloc k nonce tag buf</code> attempts to verify and decrypt the contents of <code>buf</code> in-place using <code>k</code>, <code>nonce</code>, and <code>tag</code> and returns true if successful.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_proof_of_work" class="anchored"><a href="#val-check_proof_of_work" class="anchor"></a><code><span><span class="keyword">val</span> check_proof_of_work : <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-pow_target">pow_target</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>check_proof_of_work pk pow target</code> returns true if <code>pow</code> is proof of work following <code>target</code> for the public key <code>pk</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-generate_proof_of_work" class="anchored"><a href="#val-generate_proof_of_work" class="anchor"></a><code><span><span class="keyword">val</span> generate_proof_of_work : <span>?yield_every:int <span class="arrow">&#45;&gt;</span></span> <span>?max:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-pow_target">pow_target</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-nonce">nonce</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>generate_proof_of_work pk pow_target</code> generates a proof of work for the public key <code>pk</code> following the <code>pow_target</code>.</p><p>The parameter <code>yield_every</code> (defaults to <code>500</code>) inserts a cooperation point (<code>Lwt.pause ()</code>) every so many attempts. This allows other promises to make progress towards resolution. It also allows Unix signals to be processed so that, say, Ctrl+C can be effective.</p><p>The parameter <code>max</code> (not set by default) sets a maximum number of attempts to be made before giving up. When <code>max</code> number of attempts have been made and no pow has been found, the exception <code>Not_found</code> is raised.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-generate_proof_of_work_with_target_0" class="anchored"><a href="#val-generate_proof_of_work_with_target_0" class="anchor"></a><code><span><span class="keyword">val</span> generate_proof_of_work_with_target_0 : <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-nonce">nonce</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-public_key_to_bytes" class="anchored"><a href="#val-public_key_to_bytes" class="anchor"></a><code><span><span class="keyword">val</span> public_key_to_bytes : <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Bytes.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-public_key_of_bytes" class="anchored"><a href="#val-public_key_of_bytes" class="anchor"></a><code><span><span class="keyword">val</span> public_key_of_bytes : <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-public_key">public_key</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-public_key_size" class="anchored"><a href="#val-public_key_size" class="anchor"></a><code><span><span class="keyword">val</span> public_key_size : int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-secret_key_size" class="anchored"><a href="#val-secret_key_size" class="anchor"></a><code><span><span class="keyword">val</span> secret_key_size : int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-public_key_encoding" class="anchored"><a href="#val-public_key_encoding" class="anchor"></a><code><span><span class="keyword">val</span> public_key_encoding : <span><a href="#type-public_key">public_key</a> <span class="xref-unresolved">Data_encoding</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-secret_key_encoding" class="anchored"><a href="#val-secret_key_encoding" class="anchor"></a><code><span><span class="keyword">val</span> secret_key_encoding : <span><a href="#type-secret_key">secret_key</a> <span class="xref-unresolved">Data_encoding</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-nonce_encoding" class="anchored"><a href="#val-nonce_encoding" class="anchor"></a><code><span><span class="keyword">val</span> nonce_encoding : <span><a href="#type-nonce">nonce</a> <span class="xref-unresolved">Data_encoding</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-neuterize" class="anchored"><a href="#val-neuterize" class="anchor"></a><code><span><span class="keyword">val</span> neuterize : <span><a href="#type-secret_key">secret_key</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-public_key">public_key</a></span></code></div><div class="spec-doc"><p><code>neuterize sk</code> generates the corresponding public key of <code>sk</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-equal" class="anchored"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>equal a b</code> tests keys for equality</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_pk" class="anchored"><a href="#val-pp_pk" class="anchor"></a><code><span><span class="keyword">val</span> pp_pk : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-public_key">public_key</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>