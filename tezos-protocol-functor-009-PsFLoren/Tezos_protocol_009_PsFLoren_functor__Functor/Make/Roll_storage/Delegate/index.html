<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Delegate (tezos-protocol-functor-009-PsFLoren.Tezos_protocol_009_PsFLoren_functor__Functor.Make.Roll_storage.Delegate)</title><link rel="stylesheet" href="../../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">tezos-protocol-functor-009-PsFLoren</a> &#x00BB; <a href="../../../index.html">Tezos_protocol_009_PsFLoren_functor__Functor</a> &#x00BB; <a href="../../index.html">Make</a> &#x00BB; <a href="../index.html">Roll_storage</a> &#x00BB; Delegate</nav><h1>Module <code>Roll_storage.Delegate</code></h1></header><dl><dt class="spec value" id="val-is_inactive"><a href="#val-is_inactive" class="anchor"></a><code><span class="keyword">val</span> is_inactive : <a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../../argument-1-Tezos_protocol_environment/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment.Signature.Public_key_hash.t</a> <span>&#45;&gt;</span> <span><span>bool <a href="../../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-tzresult">Tezos_protocol_environment.Error_monad.tzresult</a></span> <a href="../../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dt class="spec value" id="val-add_amount"><a href="#val-add_amount" class="anchor"></a><code><span class="keyword">val</span> add_amount : <a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../../argument-1-Tezos_protocol_environment/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment.Signature.Public_key_hash.t</a> <span>&#45;&gt;</span> <a href="../../Tez_repr/index.html#type-t">Tez_repr.t</a> <span>&#45;&gt;</span> <span><span><a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-tzresult">Tezos_protocol_environment.Error_monad.tzresult</a></span> <a href="../../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dd><p><code>add_amount ctxt dlg am</code> performs the following actions:</p><p>1. if the delegate <code>dlg</code> is inactive, increase its change <code>chg</code> by <code>am</code>, 2. if the <code>dlg</code> is active, update <code>dlg</code>'s number of rolls <code>nr</code>, and change <code>chg</code> so that <code>dlg</code>'s number of tokens is increased by <code>am</code>, and equal to <code>nr * tokens_per_roll + chg</code>, where <code>chg &lt; tokens_per_roll</code>.</p></dd></dl><dl><dt class="spec value" id="val-remove_amount"><a href="#val-remove_amount" class="anchor"></a><code><span class="keyword">val</span> remove_amount : <a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../../argument-1-Tezos_protocol_environment/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment.Signature.Public_key_hash.t</a> <span>&#45;&gt;</span> <a href="../../Tez_repr/index.html#type-t">Tez_repr.t</a> <span>&#45;&gt;</span> <span><span><a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-tzresult">Tezos_protocol_environment.Error_monad.tzresult</a></span> <a href="../../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dd><p><code>remove_amount ctxt dlg am</code> performs the following actions:</p><p>1. if the delegate <code>dlg</code> is inactive, decrease its change <code>chg</code> by <code>am</code>, 2. if the <code>dlg</code> is active, update <code>dlg</code>'s number of rolls <code>nr</code>, and change <code>chg</code> so that <code>dlg</code>'s number of tokens is decreased by <code>am</code>, and equal to <code>nr * tokens_per_roll + chg</code>, where <code>chg &lt; tokens_per_roll</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_inactive"><a href="#val-set_inactive" class="anchor"></a><code><span class="keyword">val</span> set_inactive : <a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../../argument-1-Tezos_protocol_environment/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment.Signature.Public_key_hash.t</a> <span>&#45;&gt;</span> <span><span><a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-tzresult">Tezos_protocol_environment.Error_monad.tzresult</a></span> <a href="../../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dd><p><code>set_inactive ctxt dlg</code> renders delegate <code>dlg</code> inactive and performs the following actions:</p><p>1. empty the list of rolls of <code>dlg</code>, 2. increase the change of <code>dlg</code> by <code>nr * tokens_per_roll</code>, where <code>nr</code> is <code>dlg</code>'s number of rolls prior to inactivation.</p></dd></dl><dl><dt class="spec value" id="val-set_active"><a href="#val-set_active" class="anchor"></a><code><span class="keyword">val</span> set_active : <a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <span>&#45;&gt;</span> <a href="../../argument-1-Tezos_protocol_environment/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment.Signature.Public_key_hash.t</a> <span>&#45;&gt;</span> <span><span><a href="../../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../argument-1-Tezos_protocol_environment/Error_monad/index.html#type-tzresult">Tezos_protocol_environment.Error_monad.tzresult</a></span> <a href="../../argument-1-Tezos_protocol_environment/Lwt/index.html#type-t">Tezos_protocol_environment.Lwt.t</a></span></code></dt><dd><p>If the delegate <code>dlg</code> is already active then <code>set_active ctxt dlg</code> performs the following sequence of actions:</p><p>1. if the delegate is not scheduled to become inactive, then schedule the delegate to become inactive after <code>(preserved_cycles * 2) + 1</code> cycles, 2. if the delegate is already scheduled to become inactive at cycle <code>ic</code>, then re-schedule it to become inactive at cycle <code>max ic (cc + preserved_cycles + 1)</code>, where <code>cc</code> is the current cycle.</p><p>If <code>dlg</code> is inactive then this function puts <code>dlg</code> in active state and performs the following actions:</p><p>1. if <code>dlg</code> is not scheduled to become inactive, schedule <code>dlg</code> to become inactive after <code>(preserved_cycles * 2) + 1</code> cycles, 2. if the <code>dlg</code> is already scheduled to become inactive at cycle <code>ic</code>, then re-schedule it to become inactive at cycle <code>max ic (cc + (preserved_cycles * 2) + 1)</code>, where <code>cc</code> is the current cycle, 3. dispatch <code>dlg</code>'s change <code>chg</code> into <code>nr</code> rolls of size <code>tokens_per_roll</code> so that the total amount managed by <code>dlg</code> is unchanged and equal to <code>(nr * tokens_per_roll) + chg</code>, where <code>chg &lt; tokens_per_roll</code>.</p></dd></dl></div></body></html>