<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Block (tezos-store.Tezos_store.Store.Block)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">tezos-store</a> &#x00BB; <a href="../../index.html">Tezos_store</a> &#x00BB; <a href="../index.html">Store</a> &#x00BB; Block</nav><header class="odoc-preamble"><h1>Module <code><span>Store.Block</span></code></h1><p>The module for handling block-related operations such as storing and reading data associated to a single block.</p></header><nav class="odoc-toc"><ul><li><a href="#block-field-accessors">Block field accessors</a></li><li><a href="#block-metadata-field-accessors">Block metadata field accessors</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The abstract type for a block.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-block" class="anchored"><a href="#type-block" class="anchor"></a><code><span><span class="keyword">type</span> block</span><span> = <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>The type alias for a block.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-metadata" class="anchored"><a href="#type-metadata" class="anchor"></a><code><span><span class="keyword">type</span> metadata</span><span> = <a href="../../Block_repr/index.html#type-metadata">Block_repr.metadata</a></span><span> = </span><span>{</span></code><table><tr id="type-metadata.message" class="anchored"><td class="def record field"><a href="#type-metadata.message" class="anchor"></a><code><span>message : <span>string option</span>;</span></code></td></tr><tr id="type-metadata.max_operations_ttl" class="anchored"><td class="def record field"><a href="#type-metadata.max_operations_ttl" class="anchor"></a><code><span>max_operations_ttl : int;</span></code></td></tr><tr id="type-metadata.last_allowed_fork_level" class="anchored"><td class="def record field"><a href="#type-metadata.last_allowed_fork_level" class="anchor"></a><code><span>last_allowed_fork_level : <span class="xref-unresolved">Stdlib</span>.Int32.t;</span></code></td></tr><tr id="type-metadata.block_metadata" class="anchored"><td class="def record field"><a href="#type-metadata.block_metadata" class="anchor"></a><code><span>block_metadata : <span class="xref-unresolved">Stdlib</span>.Bytes.t;</span></code></td></tr><tr id="type-metadata.operations_metadata" class="anchored"><td class="def record field"><a href="#type-metadata.operations_metadata" class="anchor"></a><code><span>operations_metadata : <span><span><span class="xref-unresolved">Stdlib</span>.Bytes.t list</span> list</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The type for block's metadata.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-equal" class="anchored"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>equal b1 b2</code> tests the equality between <code>b1</code> and <code>b2</code>. <b>Warning</b> only block hashes are compared.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_known_valid" class="anchored"><a href="#val-is_known_valid" class="anchor"></a><code><span><span class="keyword">val</span> is_known_valid : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>is_known_valid chain_store bh</code> tests that the block <code>bh</code> is known and valid in <code>chain_store</code> (i.e. the block is present in the block store).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_known_invalid" class="anchored"><a href="#val-is_known_invalid" class="anchor"></a><code><span><span class="keyword">val</span> is_known_invalid : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>is_known_invalid chain_store bh</code> tests that the block <code>bh</code> is invalid in <code>chain_store</code> (i.e. the block is present in the invalid blocks file).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_known" class="anchored"><a href="#val-is_known" class="anchor"></a><code><span><span class="keyword">val</span> is_known : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>is_known chain_store bh</code> tests that the block <code>bh</code> is either known valid or known invalid in <code>chain_store</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_genesis" class="anchored"><a href="#val-is_genesis" class="anchor"></a><code><span><span class="keyword">val</span> is_genesis : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_genesis chain_store bh</code> tests that the block <code>bh</code> is the genesis initialized in <code>chain_store</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-validity" class="anchored"><a href="#val-validity" class="anchor"></a><code><span><span class="keyword">val</span> validity : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Block_locator/index.html#type-validity">Tezos_base.Block_locator.validity</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>validity chain_store bh</code> computes the <code>Block_locator</code>.validity (<code>Unknown</code>, <code>Known_valid</code> or <code>Known_invalid</code>) for the block <code>bh</code> in <code>chain_store</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_block" class="anchored"><a href="#val-read_block" class="anchor"></a><code><span><span class="keyword">val</span> read_block : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span>?distance:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-block">block</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block chain_store ?distance bh</code> tries to read in the <code>chain_store</code> the block <code>bh</code> or the predecessing block at the offset <code>distance</code> of <code>bh</code>. By default, <code>distance</code> is 0.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_block_opt" class="anchored"><a href="#val-read_block_opt" class="anchor"></a><code><span><span class="keyword">val</span> read_block_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span>?distance:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-block">block</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block_opt chain_store ?distance bh</code> optional version of <code>read_block</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_block_by_level" class="anchored"><a href="#val-read_block_by_level" class="anchor"></a><code><span><span class="keyword">val</span> read_block_by_level : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-block">block</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block_by_level chain_store level</code> reads in the <code>chain_store</code> the block at <code>level</code>. The block retrieved will be the (level(current_head) - level)-th predecessor of the <code>chain_store</code>'s current head.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_block_by_level_opt" class="anchored"><a href="#val-read_block_by_level_opt" class="anchor"></a><code><span><span class="keyword">val</span> read_block_by_level_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-block">block</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block_by_level_opt chain_store level</code> optional version of <code>read_block_by_level</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_block_metadata" class="anchored"><a href="#val-read_block_metadata" class="anchor"></a><code><span><span class="keyword">val</span> read_block_metadata : <span>?distance:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span><a href="#type-metadata">metadata</a> option</span>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block_metadata ?distance chain_store bh</code> reads in the <code>chain_store</code> the metadata associated to the block <code>bh</code> or its <code>distance</code>-th predecessor if given. Returns <code>None</code> otherwise. By default, <code>distance</code> is 0.</p><p><b>Warning</b> If the block is already read, prefer the usage of <code>get_block_metadata</code> which will memoize the result.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_block_metadata_opt" class="anchored"><a href="#val-read_block_metadata_opt" class="anchor"></a><code><span><span class="keyword">val</span> read_block_metadata_opt : <span>?distance:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-metadata">metadata</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block_metadata_opt ?distance chain_store bh</code> same as <code>read_block_metadata</code> but returns <code>None</code> in case of errors.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_block_metadata" class="anchored"><a href="#val-get_block_metadata" class="anchor"></a><code><span><span class="keyword">val</span> get_block_metadata : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-metadata">metadata</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_block_metadata chain_store block</code> reads in the <code>chain_store</code> the metadata associated to the <code>block</code>. Returns <code>None</code> if the metadata cannot be retrieved. This function also memoize the result in the <code>block</code> structure so subsequent calls will be disk I/O free.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_block_metadata_opt" class="anchored"><a href="#val-get_block_metadata_opt" class="anchor"></a><code><span><span class="keyword">val</span> get_block_metadata_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-metadata">metadata</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_block_metadata_opt chain_store block</code> optional version of <code>get_block_metadata</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_predecessor" class="anchored"><a href="#val-read_predecessor" class="anchor"></a><code><span><span class="keyword">val</span> read_predecessor : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-block">block</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_predecessor chain_store block</code> reads in the <code>chain_store</code> the direct predecessor of <code>block</code>. Returns <code>None</code> if it cannot be found.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_predecessor_opt" class="anchored"><a href="#val-read_predecessor_opt" class="anchor"></a><code><span><span class="keyword">val</span> read_predecessor_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-block">block</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_predecessor_opt chain_store block</code> optional version of <code>read_predecessor</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_predecessor_of_hash" class="anchored"><a href="#val-read_predecessor_of_hash" class="anchor"></a><code><span><span class="keyword">val</span> read_predecessor_of_hash : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-block">block</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_predecessor_of_hash chain_store bh</code> reads in <code>chain_store</code> the predecessor's block of <code>bh</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_ancestor_hash" class="anchored"><a href="#val-read_ancestor_hash" class="anchor"></a><code><span><span class="keyword">val</span> read_ancestor_hash : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span>distance:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> option</span>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_ancestor_hash chain_store ~distance bh</code> retrieves in the <code>chain_store</code> the hash of the ancestor of the block <code>bh</code> at <code>distance</code> if it exists. Returns <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_ancestor_hash_opt" class="anchored"><a href="#val-read_ancestor_hash_opt" class="anchor"></a><code><span><span class="keyword">val</span> read_ancestor_hash_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span>distance:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_ancestor_hash_opt chain_store ~distance bh</code> same as <code>read_ancestor_hash</code> but returns <code>None</code> on errors.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_predecessor_of_hash_opt" class="anchored"><a href="#val-read_predecessor_of_hash_opt" class="anchor"></a><code><span><span class="keyword">val</span> read_predecessor_of_hash_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-block">block</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_ancestor_opt chain_store block</code> optional version of <code>read_ancestor</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-store_block" class="anchored"><a href="#val-store_block" class="anchor"></a><code><span><span class="keyword">val</span> store_block : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span>block_header:<a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span> <span>operations:<span><span><a href="../../../../tezos-base/Tezos_base/Operation/index.html#type-t">Tezos_base.Operation.t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
<span><a href="../../../../tezos-validation/Tezos_validation/Block_validation/index.html#type-result">Tezos_validation.Block_validation.result</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span><a href="#type-block">block</a> option</span>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>store_block chain_store ~block_header ~operations
      validation_result</code> stores in <code>chain_store</code> the block with its <code>block_header</code>, <code>operations</code> and validation result. Inconsistent blocks and validation will result in failures. Returns <code>None</code> if the block was already stored. If the block is correctly stored, the newly created block is returned.</p><p><b>Warning</b> The store will refuse to store blocks with no associated context's commit.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-context_exn" class="anchored"><a href="#val-context_exn" class="anchor"></a><code><span><span class="keyword">val</span> context_exn : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-context/Tezos_context/Context/index.html#type-t">Tezos_context.Context.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>context_exn chain_store block</code> checkouts the context of the <code>block</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-context_opt" class="anchored"><a href="#val-context_opt" class="anchor"></a><code><span><span class="keyword">val</span> context_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../../tezos-context/Tezos_context/Context/index.html#type-t">Tezos_context.Context.t</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>context_opt chain_store block</code> optional version of <code>context_exn</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-context" class="anchored"><a href="#val-context" class="anchor"></a><code><span><span class="keyword">val</span> context : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../../../tezos-context/Tezos_context/Context/index.html#type-t">Tezos_context.Context.t</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>context chain_store block</code> error monad version of <code>context_exn</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-context_exists" class="anchored"><a href="#val-context_exists" class="anchor"></a><code><span><span class="keyword">val</span> context_exists : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>context_exists chain_store block</code> tests the existence of the <code>block</code>'s commit in the context.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-testchain_status" class="anchored"><a href="#val-testchain_status" class="anchor"></a><code><span><span class="keyword">val</span> testchain_status : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../../../tezos-base/Tezos_base/Test_chain_status/index.html#type-t">Tezos_base.Test_chain_status.t</a> * <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> option</span>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>testchain_status chain_store block</code> returns the test chain status stored in context of <code>block</code> along with testchain's genesis if the testchain is found <code>Forking</code> or <code>Running</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-protocol_hash_exn" class="anchored"><a href="#val-protocol_hash_exn" class="anchor"></a><code><span><span class="keyword">val</span> protocol_hash_exn : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>protocol_hash_exn chain_store block</code> reads the protocol associated to <code>block</code> in its associated context. Fails when the context is unknown.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-protocol_hash" class="anchored"><a href="#val-protocol_hash" class="anchor"></a><code><span><span class="keyword">val</span> protocol_hash : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a>, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>protocol_hash chain_store block</code> error monad version of <code>protocol_hash_exn</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_invalid_block_opt" class="anchored"><a href="#val-read_invalid_block_opt" class="anchor"></a><code><span><span class="keyword">val</span> read_invalid_block_opt : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../Store_types/index.html#type-invalid_block">Store_types.invalid_block</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_invalid_block_opt chain_store bh</code> reads in the <code>chain_store</code> the invalid block <code>bh</code> if it exists.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_invalid_blocks" class="anchored"><a href="#val-read_invalid_blocks" class="anchor"></a><code><span><span class="keyword">val</span> read_invalid_blocks : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../Store_types/index.html#type-invalid_block">Store_types.invalid_block</a> <a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/Map/index.html#type-t">Tezos_crypto.Block_hash.Map.t</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_invalid_blocks chain_store</code> returns the map of all invalid blocks of <code>chain_store</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mark_invalid" class="anchored"><a href="#val-mark_invalid" class="anchor"></a><code><span><span class="keyword">val</span> mark_invalid : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>level:int32 <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mark_invalid chain_store bh ~level errors</code> stores the block <code>bh</code> at <code>level</code> with the given <code>errors</code>. Fails when trying to mark the genesis block as invalid.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unmark_invalid" class="anchored"><a href="#val-unmark_invalid" class="anchor"></a><code><span><span class="keyword">val</span> unmark_invalid : <span><a href="../index.html#type-chain_store">chain_store</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span><a href="../../../../tezos-error-monad/Tezos_error_monad/TzCore/index.html#type-error">Tezos_error_monad.TzCore.error</a> list</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>unmark_invalid chain_store bh</code> unmarks invalid the block <code>bh</code> in the <code>chain_store</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-descriptor" class="anchored"><a href="#val-descriptor" class="anchor"></a><code><span><span class="keyword">val</span> descriptor : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a></span></code></div><div class="spec-doc"><p><code>descriptor block</code> returns the pair (hash x level) of <code>block</code>.</p></div></div><h4 id="block-field-accessors"><a href="#block-field-accessors" class="anchor"></a>Block field accessors</h4><div class="odoc-spec"><div class="spec value" id="val-hash" class="anchored"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-header" class="anchored"><a href="#val-header" class="anchor"></a><code><span><span class="keyword">val</span> header : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base.Block_header.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-operations" class="anchored"><a href="#val-operations" class="anchor"></a><code><span><span class="keyword">val</span> operations : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../../tezos-base/Tezos_base/Operation/index.html#type-t">Tezos_base.Operation.t</a> list</span> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-shell_header" class="anchored"><a href="#val-shell_header" class="anchor"></a><code><span><span class="keyword">val</span> shell_header : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-shell_header">Tezos_base.Block_header.shell_header</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-level" class="anchored"><a href="#val-level" class="anchor"></a><code><span><span class="keyword">val</span> level : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-proto_level" class="anchored"><a href="#val-proto_level" class="anchor"></a><code><span><span class="keyword">val</span> proto_level : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-predecessor" class="anchored"><a href="#val-predecessor" class="anchor"></a><code><span><span class="keyword">val</span> predecessor : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-timestamp" class="anchored"><a href="#val-timestamp" class="anchor"></a><code><span><span class="keyword">val</span> timestamp : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-base/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-validation_passes" class="anchored"><a href="#val-validation_passes" class="anchor"></a><code><span><span class="keyword">val</span> validation_passes : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-operations_hash" class="anchored"><a href="#val-operations_hash" class="anchor"></a><code><span><span class="keyword">val</span> operations_hash : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-crypto/Tezos_crypto/Operation_list_list_hash/index.html#type-t">Tezos_crypto.Operation_list_list_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fitness" class="anchored"><a href="#val-fitness" class="anchor"></a><code><span><span class="keyword">val</span> fitness : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-base/Tezos_base/Fitness/index.html#type-t">Tezos_base.Fitness.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-context_hash" class="anchored"><a href="#val-context_hash" class="anchor"></a><code><span><span class="keyword">val</span> context_hash : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../tezos-crypto/Tezos_crypto/Context_hash/index.html#type-t">Tezos_crypto.Context_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-protocol_data" class="anchored"><a href="#val-protocol_data" class="anchor"></a><code><span><span class="keyword">val</span> protocol_data : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> bytes</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-block_metadata_hash" class="anchored"><a href="#val-block_metadata_hash" class="anchor"></a><code><span><span class="keyword">val</span> block_metadata_hash : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Block_metadata_hash/index.html#type-t">Tezos_crypto.Block_metadata_hash.t</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-operations_metadata_hashes" class="anchored"><a href="#val-operations_metadata_hashes" class="anchor"></a><code><span><span class="keyword">val</span> operations_metadata_hashes : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span><a href="../../../../tezos-crypto/Tezos_crypto/Operation_metadata_hash/index.html#type-t">Tezos_crypto.Operation_metadata_hash.t</a> list</span> list</span> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-operations_metadata_hashes_path" class="anchored"><a href="#val-operations_metadata_hashes_path" class="anchor"></a><code><span><span class="keyword">val</span> operations_metadata_hashes_path : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../../tezos-crypto/Tezos_crypto/Operation_metadata_hash/index.html#type-t">Tezos_crypto.Operation_metadata_hash.t</a> list</span> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-all_operations_metadata_hash" class="anchored"><a href="#val-all_operations_metadata_hash" class="anchor"></a><code><span><span class="keyword">val</span> all_operations_metadata_hash : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Operation_metadata_list_list_hash/index.html#type-t">Tezos_crypto.Operation_metadata_list_list_hash.t</a> option</span></span></code></div></div><h4 id="block-metadata-field-accessors"><a href="#block-metadata-field-accessors" class="anchor"></a>Block metadata field accessors</h4><div class="odoc-spec"><div class="spec value" id="val-message" class="anchored"><a href="#val-message" class="anchor"></a><code><span><span class="keyword">val</span> message : <span><a href="#type-metadata">metadata</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-max_operations_ttl" class="anchored"><a href="#val-max_operations_ttl" class="anchor"></a><code><span><span class="keyword">val</span> max_operations_ttl : <span><a href="#type-metadata">metadata</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-last_allowed_fork_level" class="anchored"><a href="#val-last_allowed_fork_level" class="anchor"></a><code><span><span class="keyword">val</span> last_allowed_fork_level : <span><a href="#type-metadata">metadata</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-block_metadata" class="anchored"><a href="#val-block_metadata" class="anchor"></a><code><span><span class="keyword">val</span> block_metadata : <span><a href="#type-metadata">metadata</a> <span class="arrow">&#45;&gt;</span></span> bytes</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-operations_metadata" class="anchored"><a href="#val-operations_metadata" class="anchor"></a><code><span><span class="keyword">val</span> operations_metadata : <span><a href="#type-metadata">metadata</a> <span class="arrow">&#45;&gt;</span></span> <span><span>bytes list</span> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-operations_path" class="anchored"><a href="#val-operations_path" class="anchor"></a><code><span><span class="keyword">val</span> operations_path : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-base/Tezos_base/Operation/index.html#type-t">Tezos_base.Operation.t</a> list</span> * <a href="../../../../tezos-crypto/Tezos_crypto/Operation_list_list_hash/index.html#type-path">Tezos_crypto.Operation_list_list_hash.path</a></span></code></div><div class="spec-doc"><p><code>operations_path block nth</code> computes the <code>nth</code> operations list of <code>block</code> along with the hash of all operations.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-operations_hashes_path" class="anchored"><a href="#val-operations_hashes_path" class="anchor"></a><code><span><span class="keyword">val</span> operations_hashes_path : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../tezos-crypto/Tezos_crypto/Operation_hash/index.html#type-t">Tezos_crypto.Operation_hash.t</a> list</span> * <a href="../../../../tezos-crypto/Tezos_crypto/Operation_list_list_hash/index.html#type-path">Tezos_crypto.Operation_list_list_hash.path</a></span></code></div><div class="spec-doc"><p><code>operations_hashes_path block nth</code> computes the <code>nth</code> operations hash list of <code>block</code> along with the hash of all operations.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-all_operation_hashes" class="anchored"><a href="#val-all_operation_hashes" class="anchor"></a><code><span><span class="keyword">val</span> all_operation_hashes : <span><a href="#type-block">block</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../../../tezos-crypto/Tezos_crypto/Operation_hash/index.html#type-t">Tezos_crypto.Operation_hash.t</a> list</span> list</span></span></code></div><div class="spec-doc"><p><code>all_operation_hashes block</code> computes the hash of all operations in <code>block</code>.</p></div></div></div></body></html>