<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chain (tezos-store.Tezos_store.Store.Chain)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezos-store</a> &#x00BB; <a href="../../index.html">Tezos_store</a> &#x00BB; <a href="../index.html">Store</a> &#x00BB; Chain</nav><h1>Module <code>Store.Chain</code></h1><p>The module for handling chain-related operations such as setting the head of the chain, updating the chain state, forking testchains, ...</p><nav class="toc"><ul><li><a href="#chain's-protocols">Chain's protocols</a></li></ul></nav></header><dl><dt class="spec type" id="type-chain_store"><a href="#type-chain_store" class="anchor"></a><code><span class="keyword">type</span> <span class="keyword">nonrec</span> chain_store</code><code> = <a href="../index.html#type-chain_store">chain_store</a></code></dt><dd><p>The abstract type alias of a chain store.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code><code> = <a href="index.html#type-chain_store">chain_store</a></code></dt><dd><p>The type alias of <code>chain_store</code>.</p></dd></dl><dl><dt class="spec type" id="type-testchain"><a href="#type-testchain" class="anchor"></a><code><span class="keyword">type</span> testchain</code></dt><dd><p>The abstract type for testchain.</p></dd></dl><dl><dt class="spec value" id="val-global_store"><a href="#val-global_store" class="anchor"></a><code><span class="keyword">val</span> global_store : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../index.html#type-store">store</a></code></dt><dd><p><code>global_store chain_store</code> returns the global store of <code>chain_store</code> allowing to retrieve global infos.</p></dd></dl><dl><dt class="spec value" id="val-chain_id"><a href="#val-chain_id" class="anchor"></a><code><span class="keyword">val</span> chain_id : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></code></dt><dd><p><code>chain_id chain_store</code> returns chain id of <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-chain_dir"><a href="#val-chain_dir" class="anchor"></a><code><span class="keyword">val</span> chain_dir : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><span>[ `Chain_dir ]</span> <a href="../../Naming/index.html#type-directory">Naming.directory</a></span></code></dt><dd><p><code>chain_dir chain_store</code> returns the path of directory of <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-history_mode"><a href="#val-history_mode" class="anchor"></a><code><span class="keyword">val</span> history_mode : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../../../../tezos-shell-services/Tezos_shell_services/History_mode/index.html#type-t">Tezos_shell_services.History_mode.t</a></code></dt><dd><p><code>history_mode chain_store</code> returns the history mode of the <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-genesis"><a href="#val-genesis" class="anchor"></a><code><span class="keyword">val</span> genesis : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../../../../tezos-base/Tezos_base/Genesis/index.html#type-t">Tezos_base__TzPervasives.Genesis.t</a></code></dt><dd><p><code>genesis chain_store</code> returns the <span class="xref-unresolved" title="unresolved reference to &quot;Genesis.t&quot;"><code>Genesis</code>.t</span> of the <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-genesis_block"><a href="#val-genesis_block" class="anchor"></a><code><span class="keyword">val</span> genesis_block : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../Block/index.html#type-t">Block.t</a> Lwt.t</span></code></dt><dd><p><code>genesis chain_store</code> returns the genesis block of the <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-current_head"><a href="#val-current_head" class="anchor"></a><code><span class="keyword">val</span> current_head : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../Block/index.html#type-t">Block.t</a> Lwt.t</span></code></dt><dd><p><code>current_head chain_store</code> returns the current head of the <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-expiration"><a href="#val-expiration" class="anchor"></a><code><span class="keyword">val</span> expiration : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../../../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a> option</span></code></dt><dd><p><code>expiration chain_store</code> returns the expiration date of the testchain's <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-checkpoint"><a href="#val-checkpoint" class="anchor"></a><code><span class="keyword">val</span> checkpoint : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> Lwt.t</span></code></dt><dd><p><code>checkpoint chain_store</code> returns the checkpoint associated to the <code>chain_store</code>.</p><p>The checkpoint is a block descriptor (<a href="../../Store_types/index.html#type-block_descriptor"><code>Store_types.block_descriptor</code></a>) pointing to a block that must be part of the chain. The checkpoint maintains the set of following invariants:</p><ul><li>The store will only accept blocks that are above its checkpoint's level.</li></ul><ul><li>The checkpoint is updated periodically such that the following invariant holds: <code>checkpoint.level &gt;= all_head.last_allowed_fork_level</code></li></ul><p>The checkpoint will tend to designate the highest block among all chain head's <code>last_allowed_fork_level</code> in a normal mode. This is not always true. i.e. after a snapshot import where the checkpoint will be set as the imported block and when the <code>target</code> block is reached, the checkpoint will be set at this point.</p></dd></dl><dl><dt class="spec value" id="val-target"><a href="#val-target" class="anchor"></a><code><span class="keyword">val</span> target : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><span><a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> option</span> Lwt.t</span></code></dt><dd><p><code>target chain_store</code> returns the target block associated to the <code>chain_store</code> if there is one or <code>None</code> if it has already been reached.</p><p>The target is a (<a href="../../Store_types/index.html#type-block_descriptor"><code>Store_types.block_descriptor</code></a>) pointing to a future block that must be reached by the chain. When a block is received, if its level is equal to the target's block level then its hash must be also be the same. Otherwise, the block is considered as invalid and will be discarded.</p><p>The target should only be set manually. Whenever the target block is reached, the checkpoint will be updated to this block and the target will be set to <code>None</code>.</p></dd></dl><dl><dt class="spec value" id="val-savepoint"><a href="#val-savepoint" class="anchor"></a><code><span class="keyword">val</span> savepoint : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> Lwt.t</span></code></dt><dd><p><code>savepoint chain_store</code> returns the savepoint associated to the <code>chain_store</code>.</p><p>The savepoint is a block descriptor (<a href="../../Store_types/index.html#type-block_descriptor"><code>Store_types.block_descriptor</code></a>) pointing to the lowest level block that has its metadata and/or context pruned with the following invariant:</p><p><code>is_stored(block) \and has_metadata(block) =&gt; block.level &gt;=
      savepoint.level</code></p><p>For Full and Rolling history modes, the savepoint will be periodically updated at each store merge which happens when:</p><p><code>pred(head).last_allowed_fork_level &lt; head.last_allowed_fork_level</code></p><p>On Archive history mode: <code>savepoint = genesis</code>.</p></dd></dl><dl><dt class="spec value" id="val-caboose"><a href="#val-caboose" class="anchor"></a><code><span class="keyword">val</span> caboose : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> Lwt.t</span></code></dt><dd><p><code>caboose chain_store</code> returns the caboose associated to the <code>chain_store</code>.</p><p>The caboose is a block descriptor (<a href="../../Store_types/index.html#type-block_descriptor"><code>Store_types.block_descriptor</code></a>) pointing to the lowest level block that we know present in the chain store, if the history mode is <b>not</b> Archive, it might not contain its metadata depending on the current savepoint:</p><p><code>is_stored(block) =&gt; block.level &gt;= caboose.level</code></p><p>On Archive and Full history mode: <code>caboose = genesis</code></p></dd></dl><dl><dt class="spec value" id="val-mempool"><a href="#val-mempool" class="anchor"></a><code><span class="keyword">val</span> mempool : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../../../../tezos-base/Tezos_base/Mempool/index.html#type-t">Tezos_base__TzPervasives.Mempool.t</a> Lwt.t</span></code></dt><dd><p><code>mempool chain_store</code> returns the mempool associated to the <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_mempool"><a href="#val-set_mempool" class="anchor"></a><code><span class="keyword">val</span> set_mempool : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>head:<a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></span> <span>&#45;&gt;</span> <a href="../../../../tezos-base/Tezos_base/Mempool/index.html#type-t">Tezos_base__TzPervasives.Mempool.t</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>set_mempool chain_store ~head mempool</code> sets the <code>mempool</code> of the <code>chain_store</code>. Does nothing if <code>head</code> is not current_head which might happen when a new head concurrently arrives just before this operation being called.</p></dd></dl><dl><dt class="spec value" id="val-live_blocks"><a href="#val-live_blocks" class="anchor"></a><code><span class="keyword">val</span> live_blocks : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><span>(<a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/Set/index.html#type-t">Tezos_crypto.Block_hash.Set.t</a> * <a href="../../../../tezos-crypto/Tezos_crypto/Operation_hash/Set/index.html#type-t">Tezos_crypto.Operation_hash.Set.t</a>)</span> Lwt.t</span></code></dt><dd><p><code>live_blocks chain_store</code> returns the set of previously computed live blocks for the current_head's <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-compute_live_blocks"><a href="#val-compute_live_blocks" class="anchor"></a><code><span class="keyword">val</span> compute_live_blocks : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>block:<a href="../Block/index.html#type-t">Block.t</a></span> <span>&#45;&gt;</span> <span><span><span>(<a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/Set/index.html#type-t">Tezos_crypto.Block_hash.Set.t</a> * <a href="../../../../tezos-crypto/Tezos_crypto/Operation_hash/Set/index.html#type-t">Tezos_crypto.Operation_hash.Set.t</a>)</span> <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>compute_live_blocks ~block chain_store</code> computes the set of live blocks and live operations relative to <code>block</code>. Does nothing if <code>block</code> is the <code>chain_store</code>'s current head as it was previously updated in <a href="index.html#val-set_head"><code>set_head</code></a>.</p><p>Note: this operation should not be costly in most cases as recent blocks and operations are expected to be in a cache.</p></dd></dl><dl><dt class="spec value" id="val-set_head"><a href="#val-set_head" class="anchor"></a><code><span class="keyword">val</span> set_head : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../Block/index.html#type-t">Block.t</a> <span>&#45;&gt;</span> <span><span><span><a href="../Block/index.html#type-t">Block.t</a> option</span> <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>set_head chain_store block</code> promotes the <code>block</code> as head of the <code>chain_store</code> and triggers an asynchronous store merge if a cycle is ready to be cemented. Triggering a merge will update the savepoint, checkpoint and caboose consistently with the <code>chain_store</code>'s history mode. This function returns the previous head or <code>None</code> if the given <code>block</code> is below one of the current known heads. If <code>block</code> belongs to a new branch, the previous head will also be stored as an alternate head. Setting a new head will fail when the block is not fit to be promoted as head: too old or no metadata.</p><p>After a merge:</p><ul><li>The checkpoint is updated to <code>lafl(new_head)</code> if it was below this level or unchanged otherwise;</li></ul><ul><li>The savepoint will be updated to : min(max_op_ttl(lafl(new_head)), lafl(new_head) - &lt;cycle_length&gt; * &lt;history_mode_offset&gt;) or will remain 0 in Archive mode;</li></ul><ul><li>The caboose will be updated to the same value as the savepoint in Rolling mode.</li></ul><p>Note: lafl(new_head) is the last allowed fork level of the new head.</p><p><b>Warnings:</b></p><ul><li>We expect blocks to be sequentially promoted as head using this function;</li></ul><ul><li>If a merge is triggered while another is happening, this function will block until the first merge is resolved.</li></ul></dd></dl><dl><dt class="spec value" id="val-known_heads"><a href="#val-known_heads" class="anchor"></a><code><span class="keyword">val</span> known_heads : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><span><a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> list</span> Lwt.t</span></code></dt><dd><p><code>known_heads chain_store</code> returns the list of alternate heads for <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-is_ancestor"><a href="#val-is_ancestor" class="anchor"></a><code><span class="keyword">val</span> is_ancestor : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>head:<a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a></span> <span>&#45;&gt;</span> <span>ancestor:<a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a></span> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>is_ancestor chain_store ~head ~ancestor</code> checks whether the <code>ancestor</code> is a predecessor or <code>head</code> in <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-is_in_chain"><a href="#val-is_in_chain" class="anchor"></a><code><span class="keyword">val</span> is_in_chain : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>is_in_chain chain_store block_descr</code> checks that <code>block_descr</code> is an ancestor of <code>chain_store</code>'s current head.</p></dd></dl><dl><dt class="spec value" id="val-is_acceptable_block"><a href="#val-is_acceptable_block" class="anchor"></a><code><span class="keyword">val</span> is_acceptable_block : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>is_acceptable_block chain_store block_descr</code> checks if <code>block_descr</code> would be a valid block to be stored in <code>chain_store</code>. Its predecessor is supposed to be already stored.</p></dd></dl><dl><dt class="spec value" id="val-best_known_head_for_checkpoint"><a href="#val-best_known_head_for_checkpoint" class="anchor"></a><code><span class="keyword">val</span> best_known_head_for_checkpoint : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>checkpoint:<a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a></span> <span>&#45;&gt;</span> <span><span><a href="../Block/index.html#type-t">Block.t</a> <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>best_known_head_for_checkpoint chain_store checkpoint</code> returns the fittest block among known heads in <code>chain_store</code> to be promoted as checkpoint if there is one.</p></dd></dl><dl><dt class="spec value" id="val-compute_locator"><a href="#val-compute_locator" class="anchor"></a><code><span class="keyword">val</span> compute_locator : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>?&#8288;max_size:int</span> <span>&#45;&gt;</span> <a href="../Block/index.html#type-t">Block.t</a> <span>&#45;&gt;</span> <a href="../../../../tezos-base/Tezos_base/Block_locator/index.html#type-seed">Tezos_base__TzPervasives.Block_locator.seed</a> <span>&#45;&gt;</span> <span><a href="../../../../tezos-base/Tezos_base/Block_locator/index.html#type-t">Tezos_base__TzPervasives.Block_locator.t</a> Lwt.t</span></code></dt><dd><p><code>compute_locator chain ?max_size head seed</code> computes a locator of the <code>chain</code> from <code>head</code> to the chain's caboose or until the locator contains <code>max_size</code> steps. <code>max_size</code> defaults to 200.</p></dd></dl><dl><dt class="spec value" id="val-compute_protocol_locator"><a href="#val-compute_protocol_locator" class="anchor"></a><code><span class="keyword">val</span> compute_protocol_locator : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>?&#8288;max_size:int</span> <span>&#45;&gt;</span> <span>proto_level:int</span> <span>&#45;&gt;</span> <a href="../../../../tezos-base/Tezos_base/Block_locator/index.html#type-seed">Tezos_base__TzPervasives.Block_locator.seed</a> <span>&#45;&gt;</span> <span><span><a href="../../../../tezos-base/Tezos_base/Block_locator/index.html#type-t">Tezos_base__TzPervasives.Block_locator.t</a> option</span> Lwt.t</span></code></dt><dd><p><code>compute_protocol_locator chain ?max_size ~proto_level seed</code> computes a locator for a specific protocol of level <code>proto_level</code> in the <code>chain</code> from the latest block with this protocol to its activation block or until the locator contains <code>max_size</code> steps. <code>max_size</code> defaults to 200.</p></dd></dl><dl><dt class="spec value" id="val-set_target"><a href="#val-set_target" class="anchor"></a><code><span class="keyword">val</span> set_target : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../../Store_types/index.html#type-block_descriptor">Store_types.block_descriptor</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>set_target chain_store target_descr</code> sets the target for <code>chain_store</code>. If <code>target_descr</code> is already known, <code>set_checkpoint</code> will be internally called. Fails if the target is below the current checkpoint.</p></dd></dl><dl><dt class="spec value" id="val-testchain"><a href="#val-testchain" class="anchor"></a><code><span class="keyword">val</span> testchain : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-testchain">testchain</a> option</span> Lwt.t</span></code></dt><dd><p><code>testchain chain_store</code> returns the active testchain to the given <code>chain_store</code> if it has been instantiated.</p></dd></dl><dl><dt class="spec value" id="val-testchain_forked_block"><a href="#val-testchain_forked_block" class="anchor"></a><code><span class="keyword">val</span> testchain_forked_block : <a href="index.html#type-testchain">testchain</a> <span>&#45;&gt;</span> <a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></code></dt><dd><p><code>testchain_forked_block testchain</code> returns the hash of the forked block of its parent chain.</p></dd></dl><dl><dt class="spec value" id="val-testchain_store"><a href="#val-testchain_store" class="anchor"></a><code><span class="keyword">val</span> testchain_store : <a href="index.html#type-testchain">testchain</a> <span>&#45;&gt;</span> <a href="index.html#type-chain_store">chain_store</a></code></dt><dd><p><code>testchain_store testchain</code> returns the chain store associated to this <code>testchain</code>.</p></dd></dl><dl><dt class="spec value" id="val-fork_testchain"><a href="#val-fork_testchain" class="anchor"></a><code><span class="keyword">val</span> fork_testchain : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>testchain_id:<a href="../../../../tezos-crypto/Tezos_crypto/Chain_id/index.html#type-t">Tezos_crypto.Chain_id.t</a></span> <span>&#45;&gt;</span> <span>forked_block:<a href="../Block/index.html#type-t">Block.t</a></span> <span>&#45;&gt;</span> <span>genesis_hash:<a href="../../../../tezos-crypto/Tezos_crypto/Block_hash/index.html#type-t">Tezos_crypto.Block_hash.t</a></span> <span>&#45;&gt;</span> <span>genesis_header:<a href="../../../../tezos-base/Tezos_base/Block_header/index.html#type-t">Tezos_base__TzPervasives.Block_header.t</a></span> <span>&#45;&gt;</span> <span>test_protocol:<a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a></span> <span>&#45;&gt;</span> <span>expiration:<a href="../../../../tezos-base/Tezos_base__Time/Protocol/index.html#type-t">Tezos_base__TzPervasives.Time.Protocol.t</a></span> <span>&#45;&gt;</span> <span><span><a href="index.html#type-testchain">testchain</a> <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>fork testchain chain_store ~testchain_id ~forked_block
      ~genesis_hash ~genesis_header ~test_protocol ~expiration</code> forks a testchain and activates it for <code>chain_store</code>. If a testchain with <code>testchain_id</code> already existed, it is then loaded from the store. If it was already activated, does nothing. It also registers this chain in the set of activated testchains.</p></dd></dl><dl><dt class="spec value" id="val-shutdown_testchain"><a href="#val-shutdown_testchain" class="anchor"></a><code><span class="keyword">val</span> shutdown_testchain : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><span>unit <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>shutdown_testchain chain_store</code> closes and deactivates the testchain running for <code>chain_store</code>. Does nothing if no testchain is found running for <code>chain_store</code>.</p></dd></dl><section><header><h3 id="chain's-protocols"><a href="#chain's-protocols" class="anchor"></a>Chain's protocols</h3></header><dl><dt class="spec value" id="val-find_activation_block"><a href="#val-find_activation_block" class="anchor"></a><code><span class="keyword">val</span> find_activation_block : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>protocol_level:int</span> <span>&#45;&gt;</span> <span><span><a href="../../Store_types/Protocol_levels/index.html#type-activation_block">Store_types.Protocol_levels.activation_block</a> option</span> Lwt.t</span></code></dt><dd><p><code>find_activation_block chain_store ~protocol_level</code> returns the block that activated the protocol of level <code>protocol_level</code>.</p></dd></dl><dl><dt class="spec value" id="val-find_protocol"><a href="#val-find_protocol" class="anchor"></a><code><span class="keyword">val</span> find_protocol : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>protocol_level:int</span> <span>&#45;&gt;</span> <span><span><a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> option</span> Lwt.t</span></code></dt><dd><p><code>find_protocol chain_store ~protocol_level</code> returns the protocol with the level <code>protocol_level</code>.</p></dd></dl><dl><dt class="spec value" id="val-all_protocol_levels"><a href="#val-all_protocol_levels" class="anchor"></a><code><span class="keyword">val</span> all_protocol_levels : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><span><a href="../../Store_types/Protocol_levels/index.html#type-activation_block">Store_types.Protocol_levels.activation_block</a> <a href="../../Store_types/Protocol_levels/index.html#type-t">Store_types.Protocol_levels.t</a></span> Lwt.t</span></code></dt><dd><p><code>all_protocol_levels chain_store</code> returns all the protocols registered in <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-may_update_protocol_level"><a href="#val-may_update_protocol_level" class="anchor"></a><code><span class="keyword">val</span> may_update_protocol_level : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span>protocol_level:int</span> <span>&#45;&gt;</span> <span>(<a href="../Block/index.html#type-block">Block.block</a> * <a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a>)</span> <span>&#45;&gt;</span> <span><span>unit <a href="../../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>may_update_protocol_level chain_store ~protocol_level (block,
      ph)</code> updates the protocol level for the protocol <code>ph</code> in <code>chain_store</code> with the activation <code>block</code>. If a previous entry is found, does nothing.</p></dd></dl><dl><dt class="spec value" id="val-watcher"><a href="#val-watcher" class="anchor"></a><code><span class="keyword">val</span> watcher : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <span><a href="../Block/index.html#type-t">Block.t</a> Lwt_stream.t</span> * Lwt_watcher.stopper</code></dt><dd><p><code>watcher chain_store</code> instantiates a new block watcher for <code>chain_store</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_rpc_directory"><a href="#val-get_rpc_directory" class="anchor"></a><code><span class="keyword">val</span> get_rpc_directory : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../Block/index.html#type-t">Block.t</a> <span>&#45;&gt;</span> <span><span><span><span>(<a href="index.html#type-chain_store">chain_store</a> * <a href="../Block/index.html#type-t">Block.t</a>)</span> <a href="../../../../tezos-rpc/Tezos_rpc/RPC_directory/index.html#type-t">Tezos_rpc.RPC_directory.t</a></span> option</span> Lwt.t</span></code></dt><dd><p><code>get_rpc_directory chain_store block</code> returns the RPC directory associated to the <code>block</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_rpc_directory"><a href="#val-set_rpc_directory" class="anchor"></a><code><span class="keyword">val</span> set_rpc_directory : <a href="index.html#type-chain_store">chain_store</a> <span>&#45;&gt;</span> <a href="../../../../tezos-crypto/Tezos_crypto/Protocol_hash/index.html#type-t">Tezos_crypto.Protocol_hash.t</a> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-chain_store">chain_store</a> * <a href="../Block/index.html#type-t">Block.t</a>)</span> <a href="../../../../tezos-rpc/Tezos_rpc/RPC_directory/index.html#type-t">Tezos_rpc.RPC_directory.t</a></span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>set_rpc_directory chain_store ph rpc_directory</code> sets a <code>rpc_directory</code> for the protocol <code>ph</code> in <code>chain_store</code>.</p></dd></dl></section></div></body></html>