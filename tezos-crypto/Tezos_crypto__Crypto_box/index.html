<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tezos_crypto__Crypto_box (tezos-crypto.Tezos_crypto__Crypto_box)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">tezos-crypto</a> &#x00BB; Tezos_crypto__Crypto_box</nav><h1>Module <code>Tezos_crypto__Crypto_box</code></h1><p>Tezos - X25519/XSalsa20-Poly1305 cryptography</p></header><dl><dt class="spec type" id="type-nonce"><a href="#type-nonce" class="anchor"></a><code><span class="keyword">type</span> nonce</code></dt></dl><dl><dt class="spec value" id="val-nonce_size"><a href="#val-nonce_size" class="anchor"></a><code><span class="keyword">val</span> nonce_size : int</code></dt><dt class="spec value" id="val-zero_nonce"><a href="#val-zero_nonce" class="anchor"></a><code><span class="keyword">val</span> zero_nonce : <a href="index.html#type-nonce">nonce</a></code></dt><dt class="spec value" id="val-random_nonce"><a href="#val-random_nonce" class="anchor"></a><code><span class="keyword">val</span> random_nonce : unit <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a></code></dt><dt class="spec value" id="val-increment_nonce"><a href="#val-increment_nonce" class="anchor"></a><code><span class="keyword">val</span> increment_nonce : <span>?&#8288;step:int</span> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a></code></dt><dt class="spec value" id="val-generate_nonces"><a href="#val-generate_nonces" class="anchor"></a><code><span class="keyword">val</span> generate_nonces : <span>incoming:bool</span> <span>&#45;&gt;</span> <span>sent_msg:Stdlib.Bytes.t</span> <span>&#45;&gt;</span> <span>recv_msg:Stdlib.Bytes.t</span> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a> * <a href="index.html#type-nonce">nonce</a></code></dt><dd><p><code>generate_nonces ~incoming ~sent_msg ~recv_msg</code> generates two nonces by hashing (Blake2B) the arguments. The nonces should be used to initialize the encryption on the communication channels. Because an attacker cannot control both messages, it cannot determine the nonces that will be used to encrypt the messages. The sent message should contains a random nonce, and we should never send the exact same message twice.</p></dd></dl><dl><dt class="spec value" id="val-tag_length"><a href="#val-tag_length" class="anchor"></a><code><span class="keyword">val</span> tag_length : int</code></dt><dd><p>Size of the message authentication tag.</p></dd></dl><div class="spec module" id="module-Secretbox"><a href="#module-Secretbox" class="anchor"></a><code><span class="keyword">module</span> <a href="Secretbox/index.html">Secretbox</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-pow_target"><a href="#type-pow_target" class="anchor"></a><code><span class="keyword">type</span> pow_target</code></dt></dl><dl><dt class="spec value" id="val-default_pow_target"><a href="#val-default_pow_target" class="anchor"></a><code><span class="keyword">val</span> default_pow_target : <a href="index.html#type-pow_target">pow_target</a></code></dt><dt class="spec value" id="val-make_pow_target"><a href="#val-make_pow_target" class="anchor"></a><code><span class="keyword">val</span> make_pow_target : float <span>&#45;&gt;</span> <a href="index.html#type-pow_target">pow_target</a></code></dt></dl><dl><dt class="spec type" id="type-secret_key"><a href="#type-secret_key" class="anchor"></a><code><span class="keyword">type</span> secret_key</code></dt><dt class="spec type" id="type-public_key"><a href="#type-public_key" class="anchor"></a><code><span class="keyword">type</span> public_key</code></dt></dl><div class="spec module" id="module-Public_key_hash"><a href="#module-Public_key_hash" class="anchor"></a><code><span class="keyword">module</span> <a href="Public_key_hash/index.html">Public_key_hash</a> : <a href="../Tezos_crypto/S/index.html#module-type-HASH">Tezos_crypto.S.HASH</a></code></div><dl><dt class="spec type" id="type-channel_key"><a href="#type-channel_key" class="anchor"></a><code><span class="keyword">type</span> channel_key</code></dt></dl><dl><dt class="spec value" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span class="keyword">val</span> hash : <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> <a href="Public_key_hash/index.html#type-t">Public_key_hash.t</a></code></dt><dt class="spec value" id="val-random_keypair"><a href="#val-random_keypair" class="anchor"></a><code><span class="keyword">val</span> random_keypair : unit <span>&#45;&gt;</span> <a href="index.html#type-secret_key">secret_key</a> * <a href="index.html#type-public_key">public_key</a> * <a href="Public_key_hash/index.html#type-t">Public_key_hash.t</a></code></dt><dd><p>Generates both a secret key and its corresponding public key, along with a hash of the public key.</p></dd></dl><dl><dt class="spec value" id="val-precompute"><a href="#val-precompute" class="anchor"></a><code><span class="keyword">val</span> precompute : <a href="index.html#type-secret_key">secret_key</a> <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> <a href="index.html#type-channel_key">channel_key</a></code></dt><dd><p><code>precompute pk sk</code> computes a channel key from the sender's <code>sk</code> and the recipient's <code>pk</code>.</p></dd></dl><dl><dt class="spec value" id="val-fast_box"><a href="#val-fast_box" class="anchor"></a><code><span class="keyword">val</span> fast_box : <a href="index.html#type-channel_key">channel_key</a> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a> <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> Stdlib.Bytes.t</code></dt><dd><p><code>fast_box k nonce msg</code> authenticates and encrypts <code>msg</code> and returns both the message authentication tag and the ciphertext. For this reason, the returned buffer will be <code>tagbytes</code> longer than <code>msg</code>.</p></dd></dl><dl><dt class="spec value" id="val-fast_box_open"><a href="#val-fast_box_open" class="anchor"></a><code><span class="keyword">val</span> fast_box_open : <a href="index.html#type-channel_key">channel_key</a> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a> <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> <span>Stdlib.Bytes.t option</span></code></dt><dd><p><code>fast_box_open k nonce cmsg</code> attempts to verify and decrypt <code>cmsg</code> and if successful returns the plaintext. As above, the returned buffer will be <code>tagbytes</code> shorter than <code>cmsg</code>.</p></dd></dl><dl><dt class="spec value" id="val-fast_box_noalloc"><a href="#val-fast_box_noalloc" class="anchor"></a><code><span class="keyword">val</span> fast_box_noalloc : <a href="index.html#type-channel_key">channel_key</a> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a> <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> unit</code></dt><dd><p><code>fast_box_noalloc k nonce tag buf</code> authenticates and encrypts in-place the contents of <code>buf</code> using <code>k</code> and <code>nonce</code> and writes the message authentication tag in <code>tag</code>.</p></dd></dl><dl><dt class="spec value" id="val-fast_box_open_noalloc"><a href="#val-fast_box_open_noalloc" class="anchor"></a><code><span class="keyword">val</span> fast_box_open_noalloc : <a href="index.html#type-channel_key">channel_key</a> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a> <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> bool</code></dt><dd><p><code>fast_box_open_noalloc k nonce tag buf</code> attempts to verify and decrypt the contents of <code>buf</code> in-place using <code>k</code>, <code>nonce</code>, and <code>tag</code> and returns true if successful.</p></dd></dl><dl><dt class="spec value" id="val-check_proof_of_work"><a href="#val-check_proof_of_work" class="anchor"></a><code><span class="keyword">val</span> check_proof_of_work : <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a> <span>&#45;&gt;</span> <a href="index.html#type-pow_target">pow_target</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>check_proof_of_work pk pow target</code> returns true if <code>pow</code> is proof of work following <code>target</code> for the public key <code>pk</code>.</p></dd></dl><dl><dt class="spec value" id="val-generate_proof_of_work"><a href="#val-generate_proof_of_work" class="anchor"></a><code><span class="keyword">val</span> generate_proof_of_work : <span>?&#8288;yield_every:int</span> <span>&#45;&gt;</span> <span>?&#8288;max:int</span> <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> <a href="index.html#type-pow_target">pow_target</a> <span>&#45;&gt;</span> <span><a href="index.html#type-nonce">nonce</a> Lwt.t</span></code></dt><dd><p><code>generate_proof_of_work pk pow_target</code> generates a proof of work for the public key <code>pk</code> following the <code>pow_target</code>.</p><p>The parameter <code>yield_every</code> (defaults to <code>500</code>) inserts a cooperation point (<code>Lwt.pause ()</code>) every so many attempts. This allows other promises to make progress towards resolution. It also allows Unix signals to be processed so that, say, Ctrl+C can be effective.</p><p>The parameter <code>max</code> (not set by default) sets a maximum number of attempts to be made before giving up. When <code>max</code> number of attempts have been made and no pow has been found, the exception <code>Not_found</code> is raised.</p></dd></dl><dl><dt class="spec value" id="val-generate_proof_of_work_with_target_0"><a href="#val-generate_proof_of_work_with_target_0" class="anchor"></a><code><span class="keyword">val</span> generate_proof_of_work_with_target_0 : <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> <a href="index.html#type-nonce">nonce</a></code></dt><dt class="spec value" id="val-public_key_to_bytes"><a href="#val-public_key_to_bytes" class="anchor"></a><code><span class="keyword">val</span> public_key_to_bytes : <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> Stdlib.Bytes.t</code></dt><dt class="spec value" id="val-public_key_of_bytes"><a href="#val-public_key_of_bytes" class="anchor"></a><code><span class="keyword">val</span> public_key_of_bytes : Stdlib.Bytes.t <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a></code></dt><dt class="spec value" id="val-public_key_size"><a href="#val-public_key_size" class="anchor"></a><code><span class="keyword">val</span> public_key_size : int</code></dt><dt class="spec value" id="val-secret_key_size"><a href="#val-secret_key_size" class="anchor"></a><code><span class="keyword">val</span> secret_key_size : int</code></dt><dt class="spec value" id="val-public_key_encoding"><a href="#val-public_key_encoding" class="anchor"></a><code><span class="keyword">val</span> public_key_encoding : <span><a href="index.html#type-public_key">public_key</a> Data_encoding.t</span></code></dt><dt class="spec value" id="val-secret_key_encoding"><a href="#val-secret_key_encoding" class="anchor"></a><code><span class="keyword">val</span> secret_key_encoding : <span><a href="index.html#type-secret_key">secret_key</a> Data_encoding.t</span></code></dt><dt class="spec value" id="val-nonce_encoding"><a href="#val-nonce_encoding" class="anchor"></a><code><span class="keyword">val</span> nonce_encoding : <span><a href="index.html#type-nonce">nonce</a> Data_encoding.t</span></code></dt><dt class="spec value" id="val-neuterize"><a href="#val-neuterize" class="anchor"></a><code><span class="keyword">val</span> neuterize : <a href="index.html#type-secret_key">secret_key</a> <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a></code></dt><dd><p><code>neuterize sk</code> generates the corresponding public key of <code>sk</code></p></dd></dl><dl><dt class="spec value" id="val-equal"><a href="#val-equal" class="anchor"></a><code><span class="keyword">val</span> equal : <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>equal a b</code> tests keys for equality</p></dd></dl><dl><dt class="spec value" id="val-pp_pk"><a href="#val-pp_pk" class="anchor"></a><code><span class="keyword">val</span> pp_pk : Stdlib.Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> unit</code></dt></dl></div></body></html>