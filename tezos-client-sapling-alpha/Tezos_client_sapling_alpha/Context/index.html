<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Context (tezos-client-sapling-alpha.Tezos_client_sapling_alpha.Context)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-client-sapling-alpha</a> &#x00BB; <a href="../index.html">Tezos_client_sapling_alpha</a> &#x00BB; Context</nav><h1>Module <code>Tezos_client_sapling_alpha.Context</code></h1></header><aside><p>This module allows the creation Sapling transactions: shield, unshield and transfer. Because Sapling uses an UTXO model, it is necessary for the client to maintain locally the set of unspent outputs for each viewing key, for each smart contract. This operation is called scanning. This local cache is updated downloading from the node only the difference from the last scanned state.</p></aside><div class="spec module" id="module-Tez"><a href="#module-Tez" class="anchor"></a><code><span class="keyword">module</span> <a href="Tez/index.html">Tez</a> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#module-Tez">Tezos_raw_protocol_alpha.Alpha_context.Tez</a></code></div><dl><dt class="spec module" id="module-Shielded_tez"><a href="#module-Shielded_tez" class="anchor"></a><code><span class="keyword">module</span> <a href="Shielded_tez/index.html">Shielded_tez</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>This module is used to represent any shielded token to avoid confusing it with Tez.</p></dd></dl><dl><dt class="spec module" id="module-Shielded_tez_contract_input"><a href="#module-Shielded_tez_contract_input" class="anchor"></a><code><span class="keyword">module</span> <a href="Shielded_tez_contract_input/index.html">Shielded_tez_contract_input</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Actual input to a smart contract handling Sapling transactions</p></dd></dl><dl><dt class="spec module" id="module-Account"><a href="#module-Account" class="anchor"></a><code><span class="keyword">module</span> <a href="Account/index.html">Account</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Account corresponding to a contract and a viewing key</p></dd></dl><dl><dt class="spec module" id="module-Contract_state"><a href="#module-Contract_state" class="anchor"></a><code><span class="keyword">module</span> <a href="Contract_state/index.html">Contract_state</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>State of a contract, potentially involving several viewing keys</p></dd></dl><div class="spec module" id="module-Client_state"><a href="#module-Client_state" class="anchor"></a><code><span class="keyword">module</span> <a href="Client_state/index.html">Client_state</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-shield"><a href="#val-shield" class="anchor"></a><code><span class="keyword">val</span> shield : <a href="../../../tezos-client-base/Tezos_client_base/index.html#module-Client_context">Tezos_client_base.Client_context</a>.#full <span>&#45;&gt;</span> <span>dst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a></span> <span>&#45;&gt;</span> <span>?&#8288;message:bytes</span> <span>&#45;&gt;</span> <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha__Alpha_context/Tez/index.html#type-t">Tez.t</a> <span>&#45;&gt;</span> <a href="Contract_state/index.html#type-t">Contract_state.t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><a href="Shielded_tez_contract_input/index.html#type-t">Shielded_tez_contract_input.t</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>shield ~message ~dst tez cstate anti-replay</code> returns a transaction shielding <code>tez</code> tez to a sapling address <code>dst</code> using a sapling storage <code>cstate</code> and the anti-replay string.</p></dd></dl><dl><dt class="spec value" id="val-unshield"><a href="#val-unshield" class="anchor"></a><code><span class="keyword">val</span> unshield : <span>src:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Spending_key/index.html#type-t">Tezos_sapling.Core.Client.Spending_key.t</a></span> <span>&#45;&gt;</span> <span>dst:<a href="../../../tezos-crypto/Tezos_crypto/Signature/index.html#type-public_key_hash">Tezos_crypto.Signature.public_key_hash</a></span> <span>&#45;&gt;</span> <span>backdst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a></span> <span>&#45;&gt;</span> <a href="Shielded_tez/index.html#type-t">Shielded_tez.t</a> <span>&#45;&gt;</span> <a href="Contract_state/index.html#type-t">Contract_state.t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="Shielded_tez_contract_input/index.html#type-t">Shielded_tez_contract_input.t</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span></code></dt><dd><p><code>unshield ~src_name ~src ~dst ~backdst stez cstate storage</code> returns a transaction unshielding <code>stez</code> shielded tokens from a sapling wallet <code>src</code> to a transparent tezos address <code>dst</code>, sending the change back to <code>backdst</code> and using a Sapling storage <code>cstate</code> and a anti-replay string. The transaction is refused if there is an insufficient amount of shielded tez in the wallet <code>src</code>, the error is raised with <code>src_name</code>.</p></dd></dl><dl><dt class="spec value" id="val-transfer"><a href="#val-transfer" class="anchor"></a><code><span class="keyword">val</span> transfer : <a href="../../../tezos-client-base/Tezos_client_base/index.html#module-Client_context">Tezos_client_base.Client_context</a>.#full <span>&#45;&gt;</span> <span>src:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Spending_key/index.html#type-t">Tezos_sapling.Core.Client.Spending_key.t</a></span> <span>&#45;&gt;</span> <span>dst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a></span> <span>&#45;&gt;</span> <span>backdst:<a href="../../../tezos-sapling/Tezos_sapling/Core/Client/Viewing_key/index.html#type-address">Tezos_sapling.Core.Client.Viewing_key.address</a></span> <span>&#45;&gt;</span> <span>?&#8288;message:bytes</span> <span>&#45;&gt;</span> <a href="Shielded_tez/index.html#type-t">Shielded_tez.t</a> <span>&#45;&gt;</span> <a href="Contract_state/index.html#type-t">Contract_state.t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><a href="../../../tezos-sapling/Tezos_sapling/Core/Client/UTXO/index.html#type-transaction">Tezos_sapling.Core.Client.UTXO.transaction</a> <a href="../../../tezos-base/Tezos_base__TzPervasives/index.html#type-tzresult">Tezos_base__TzPervasives.tzresult</a></span> Lwt.t</span></code></dt><dd><p><code>transfer ~message ~src ~dst ~backdst amount cstate anti-replay</code> creates a Sapling transaction of <code>amount</code> shielded tez from Sapling wallet <code>src</code> to Sapling address <code>dst</code>, sending the change to <code>backdst</code>, using a Sapling storage <code>cstate</code> and a anti-replay string. <code>~message</code> is a message that will be uploaded encrypted on chain.</p></dd></dl></div></body></html>