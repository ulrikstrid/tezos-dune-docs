<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>PROTOCOL (tezos-protocol-functor-alpha.Tezos_protocol_alpha_functor.Functor.Make.1-Tezos_protocol_environment.Updater.PROTOCOL)</title><link rel="stylesheet" href="../../../../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../../index.html">tezos-protocol-functor-alpha</a> &#x00BB; <a href="../../../../../index.html">Tezos_protocol_alpha_functor</a> &#x00BB; <a href="../../../../index.html">Functor</a> &#x00BB; <a href="../../../index.html">Make</a> &#x00BB; <a href="../../index.html">1-Tezos_protocol_environment</a> &#x00BB; <a href="../index.html">Updater</a> &#x00BB; PROTOCOL</nav><header class="odoc-preamble"><h1>Module type <code><span>Updater.PROTOCOL</span></code></h1><p>This is the signature of a Tezos protocol implementation. It has access to the standard library and the Environment module.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-max_block_length" class="anchored"><a href="#val-max_block_length" class="anchor"></a><code><span><span class="keyword">val</span> max_block_length : int</span></code></div><div class="spec-doc"><p>The maximum size of a block header in bytes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-max_operation_data_length" class="anchored"><a href="#val-max_operation_data_length" class="anchor"></a><code><span><span class="keyword">val</span> max_operation_data_length : int</span></code></div><div class="spec-doc"><p>The maximum size of an operation in bytes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-validation_passes" class="anchored"><a href="#val-validation_passes" class="anchor"></a><code><span><span class="keyword">val</span> validation_passes : <span><a href="../index.html#type-quota">quota</a> list</span></span></code></div><div class="spec-doc"><p>The number of validation passes (length of the list) and the operation's quota for each pass.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-block_header_data" class="anchored"><a href="#type-block_header_data" class="anchor"></a><code><span><span class="keyword">type</span> block_header_data</span></code></div><div class="spec-doc"><p>The version specific type of blocks.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-block_header_data_encoding" class="anchored"><a href="#val-block_header_data_encoding" class="anchor"></a><code><span><span class="keyword">val</span> block_header_data_encoding : <span><a href="#type-block_header_data">block_header_data</a> <a href="../../Data_encoding/index.html#type-t">Data_encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encoding for version specific part of block headers.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-block_header" class="anchored"><a href="#type-block_header" class="anchor"></a><code><span><span class="keyword">type</span> block_header</span><span> = </span><span>{</span></code><table><tr id="type-block_header.shell" class="anchored"><td class="def record field"><a href="#type-block_header.shell" class="anchor"></a><code><span>shell : <a href="../../Block_header/index.html#type-shell_header">Block_header.shell_header</a>;</span></code></td></tr><tr id="type-block_header.protocol_data" class="anchored"><td class="def record field"><a href="#type-block_header.protocol_data" class="anchor"></a><code><span>protocol_data : <a href="#type-block_header_data">block_header_data</a>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>A fully parsed block header.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-block_header_metadata" class="anchored"><a href="#type-block_header_metadata" class="anchor"></a><code><span><span class="keyword">type</span> block_header_metadata</span></code></div><div class="spec-doc"><p>Version-specific side information computed by the protocol during the validation of a block. Should not include information about the evaluation of operations which is handled separately by <code>operation_metadata</code>. To be used as an execution trace by tools (client, indexer). Not necessary for validation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-block_header_metadata_encoding" class="anchored"><a href="#val-block_header_metadata_encoding" class="anchor"></a><code><span><span class="keyword">val</span> block_header_metadata_encoding : <span><a href="#type-block_header_metadata">block_header_metadata</a> <a href="../../Data_encoding/index.html#type-t">Data_encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encoding for version-specific block metadata.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-operation_data" class="anchored"><a href="#type-operation_data" class="anchor"></a><code><span><span class="keyword">type</span> operation_data</span></code></div><div class="spec-doc"><p>The version specific type of operations.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-operation_receipt" class="anchored"><a href="#type-operation_receipt" class="anchor"></a><code><span><span class="keyword">type</span> operation_receipt</span></code></div><div class="spec-doc"><p>Version-specific side information computed by the protocol during the validation of each operation, to be used conjointly with <a href="#type-block_header_metadata"><code>block_header_metadata</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-operation" class="anchored"><a href="#type-operation" class="anchor"></a><code><span><span class="keyword">type</span> operation</span><span> = </span><span>{</span></code><table><tr id="type-operation.shell" class="anchored"><td class="def record field"><a href="#type-operation.shell" class="anchor"></a><code><span>shell : <a href="../../Operation/index.html#type-shell_header">Operation.shell_header</a>;</span></code></td></tr><tr id="type-operation.protocol_data" class="anchored"><td class="def record field"><a href="#type-operation.protocol_data" class="anchor"></a><code><span>protocol_data : <a href="#type-operation_data">operation_data</a>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>A fully parsed operation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-operation_data_encoding" class="anchored"><a href="#val-operation_data_encoding" class="anchor"></a><code><span><span class="keyword">val</span> operation_data_encoding : <span><a href="#type-operation_data">operation_data</a> <a href="../../Data_encoding/index.html#type-t">Data_encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encoding for version-specific operation data.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-operation_receipt_encoding" class="anchored"><a href="#val-operation_receipt_encoding" class="anchor"></a><code><span><span class="keyword">val</span> operation_receipt_encoding : <span><a href="#type-operation_receipt">operation_receipt</a> <a href="../../Data_encoding/index.html#type-t">Data_encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encoding for version-specific operation receipts.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-operation_data_and_receipt_encoding" class="anchored"><a href="#val-operation_data_and_receipt_encoding" class="anchor"></a><code><span><span class="keyword">val</span> operation_data_and_receipt_encoding : <span><span>(<a href="#type-operation_data">operation_data</a> * <a href="#type-operation_receipt">operation_receipt</a>)</span> <a href="../../Data_encoding/index.html#type-t">Data_encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encoding that mixes an operation data and its receipt.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-acceptable_passes" class="anchored"><a href="#val-acceptable_passes" class="anchor"></a><code><span><span class="keyword">val</span> acceptable_passes : <span><a href="#type-operation">operation</a> <span class="arrow">&#45;&gt;</span></span> <span>int list</span></span></code></div><div class="spec-doc"><p>The Validation passes in which an operation can appear. For instance <code>[0]</code> if it only belongs to the first pass. An answer of <code>[]</code> means that the operation is ill-formed and cannot be included at all.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-compare_operations" class="anchored"><a href="#val-compare_operations" class="anchor"></a><code><span><span class="keyword">val</span> compare_operations : <span><a href="#type-operation">operation</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-operation">operation</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Basic ordering of operations. <code>compare_operations op1 op2</code> means that <code>op1</code> should appear before <code>op2</code> in a block.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-validation_state" class="anchored"><a href="#type-validation_state" class="anchor"></a><code><span><span class="keyword">type</span> validation_state</span></code></div><div class="spec-doc"><p>A functional state that is transmitted through the steps of a block validation sequence. It must retain the current state of the store (that can be extracted from the outside using <a href="#val-current_context"><code>current_context</code></a>, and whose final value is produced by <a href="#val-finalize_block"><code>finalize_block</code></a>). It can also contain the information that must be remembered during the validation, which must be immutable (as validator or baker implementations are allowed to pause, replay or backtrack during the validation process).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-current_context" class="anchored"><a href="#val-current_context" class="anchor"></a><code><span><span class="keyword">val</span> current_context : <span><a href="#type-validation_state">validation_state</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../Context/index.html#type-t">Context.t</a> <a href="../../Error_monad/index.html#type-tzresult">Error_monad.tzresult</a></span> <a href="../../Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Access the context at a given validation step.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-begin_partial_application" class="anchored"><a href="#val-begin_partial_application" class="anchor"></a><code><span><span class="keyword">val</span> begin_partial_application : <span>chain_id:<a href="../../Chain_id/index.html#type-t">Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>ancestor_context:<a href="../../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>predecessor_timestamp:<a href="../../Time/index.html#type-t">Time.t</a> <span class="arrow">&#45;&gt;</span></span> <span>predecessor_fitness:<a href="../../Fitness/index.html#type-t">Fitness.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block_header">block_header</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-validation_state">validation_state</a> <a href="../../Error_monad/index.html#type-tzresult">Error_monad.tzresult</a></span> <a href="../../Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Checks that a block is well formed in a given context. This function should run quickly, as its main use is to reject bad blocks from the chain as early as possible. The input context is the one resulting of an ancestor block of same protocol version. This ancestor of the current head is guaranteed to be more recent than `last_allowed_fork_level`.</p><p>The resulting `validation_state` will be used for multi-pass validation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-begin_application" class="anchored"><a href="#val-begin_application" class="anchor"></a><code><span><span class="keyword">val</span> begin_application : <span>chain_id:<a href="../../Chain_id/index.html#type-t">Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>predecessor_context:<a href="../../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>predecessor_timestamp:<a href="../../Time/index.html#type-t">Time.t</a> <span class="arrow">&#45;&gt;</span></span> <span>predecessor_fitness:<a href="../../Fitness/index.html#type-t">Fitness.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block_header">block_header</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-validation_state">validation_state</a> <a href="../../Error_monad/index.html#type-tzresult">Error_monad.tzresult</a></span> <a href="../../Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>The first step in a block validation sequence. Initializes a validation context for validating a block. Takes as argument the <a href="../../Block_header/index.html#type-t"><code>Block_header.t</code></a> to initialize the context for this block. The function <code>precheck_block</code> may not have been called before <code>begin_application</code>, so all the check performed by the former must be repeated in the latter.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-begin_construction" class="anchored"><a href="#val-begin_construction" class="anchor"></a><code><span><span class="keyword">val</span> begin_construction : <span>chain_id:<a href="../../Chain_id/index.html#type-t">Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span> <span>predecessor_context:<a href="../../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>predecessor_timestamp:<a href="../../Time/index.html#type-t">Time.t</a> <span class="arrow">&#45;&gt;</span></span> <span>predecessor_level:<a href="../../Int32/index.html#type-t">Int32.t</a> <span class="arrow">&#45;&gt;</span></span> <span>predecessor_fitness:<a href="../../Fitness/index.html#type-t">Fitness.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>predecessor:<a href="../../Block_hash/index.html#type-t">Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>timestamp:<a href="../../Time/index.html#type-t">Time.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?protocol_data:<a href="#type-block_header_data">block_header_data</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-validation_state">validation_state</a> <a href="../../Error_monad/index.html#type-tzresult">Error_monad.tzresult</a></span> <a href="../../Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Initializes a validation context for constructing a new block (as opposed to validating an existing block). When the <code>protocol_data</code> argument is specified, it should contains a 'prototype' of a the protocol specific part of a block header, and the function should produce the exact same effect on the context than would produce the validation of a block containing an &quot;equivalent&quot; (but complete) header. For instance, if the block header usually includes a signature, the header provided to <a href="#val-begin_construction"><code>begin_construction</code></a> should includes a faked signature.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-apply_operation" class="anchored"><a href="#val-apply_operation" class="anchor"></a><code><span><span class="keyword">val</span> apply_operation : <span><a href="#type-validation_state">validation_state</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-operation">operation</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-validation_state">validation_state</a> * <a href="#type-operation_receipt">operation_receipt</a>)</span> <a href="../../Error_monad/index.html#type-tzresult">Error_monad.tzresult</a></span> <a href="../../Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Called after <a href="#val-begin_application"><code>begin_application</code></a> (or <a href="#val-begin_construction"><code>begin_construction</code></a>) and before <a href="#val-finalize_block"><code>finalize_block</code></a>, with each operation in the block.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-finalize_block" class="anchored"><a href="#val-finalize_block" class="anchor"></a><code><span><span class="keyword">val</span> finalize_block : <span><a href="#type-validation_state">validation_state</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../index.html#type-validation_result">validation_result</a> * <a href="#type-block_header_metadata">block_header_metadata</a>)</span> <a href="../../Error_monad/index.html#type-tzresult">Error_monad.tzresult</a></span> <a href="../../Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>The last step in a block validation sequence. It produces the context that will be used as input for the validation of its successor block candidates.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rpc_services" class="anchored"><a href="#val-rpc_services" class="anchor"></a><code><span><span class="keyword">val</span> rpc_services : <span><a href="../index.html#type-rpc_context">rpc_context</a> <a href="../../RPC_directory/index.html#type-t">RPC_directory.t</a></span></span></code></div><div class="spec-doc"><p>The list of remote procedures exported by this implementation</p></div></div><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span><a href="../../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Block_header/index.html#type-shell_header">Block_header.shell_header</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../index.html#type-validation_result">validation_result</a> <a href="../../Error_monad/index.html#type-tzresult">Error_monad.tzresult</a></span> <a href="../../Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Initialize the context (or upgrade the context after a protocol amendment). This function receives the context resulting of the application of a block that triggered the amendment. It also receives the header of the block that triggered the amendment.</p></div></div></div></body></html>