<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Process (tezt.Tezt.Process)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt</a> &#x00BB; <a href="../index.html">Tezt</a> &#x00BB; Process</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt.Process</span></code></h1><p>External processes launched by tests.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A process which was <a href="#val-spawn"><code>spawn</code></a>ed.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-hooks" class="anchored"><a href="#type-hooks" class="anchor"></a><code><span><span class="keyword">type</span> hooks</span><span> = </span><span>{</span></code><table><tr id="type-hooks.on_log" class="anchored"><td class="def record field"><a href="#type-hooks.on_log" class="anchor"></a><code><span>on_log : <span>string <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>A hook that is called with every line that is being logged.</p><span class="comment-delim">*)</span></td></tr><tr id="type-hooks.on_spawn" class="anchored"><td class="def record field"><a href="#type-hooks.on_spawn" class="anchor"></a><code><span>on_spawn : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>A hook that is called whenever a process is being spawned. The first parameter is the command and the second are its arguments.</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Process can have some hooks attached when <a href="#val-spawn"><code>spawn</code></a>ed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-spawn" class="anchored"><a href="#val-spawn" class="anchor"></a><code><span><span class="keyword">val</span> spawn : <span>?runner:<a href="../Runner/index.html#type-t">Runner.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?log_status_on_exit:bool <span class="arrow">&#45;&gt;</span></span> <span>?log_output:bool <span class="arrow">&#45;&gt;</span></span>
<span>?name:string <span class="arrow">&#45;&gt;</span></span> <span>?color:<a href="../Log/Color/index.html#type-t">Log.Color.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string <span class="xref-unresolved">Tezt</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span> <span>?hooks:<a href="#type-hooks">hooks</a> <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Create a process which starts running in the background.</p><p>Usage: <code>spawn command arguments</code></p><p>If <code>log_status_on_exit</code> is <code>true</code> (which is the default), log the exit code when the process terminates.</p><p>If <code>log_output</code> is <code>true</code> (which is the default), log the <code>stdout</code> and <code>stderr</code> output.</p><p>Parameter <code>name</code> specifies the prefix (in brackets) that is added to each logged output line. Parameter <code>color</code> specifies the color of those output lines.</p><p>Parameter <code>hooks</code> allows to attach some hooks to the process.</p><p>Note that this function can only be called if <code>Background.register</code> is allowed (which is the case inside functions given to <code>Test.register</code>).</p><p>Parameter <code>runner</code> specifies the runner on which to run the process. If unspecified, the process runs locally. Otherwise, it runs on the given runner using SSH.</p><p>Example: <code>spawn &quot;git&quot; [ &quot;log&quot;; &quot;-p&quot; ]</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-spawn_with_stdin" class="anchored"><a href="#val-spawn_with_stdin" class="anchor"></a><code><span><span class="keyword">val</span> spawn_with_stdin : <span>?runner:<a href="../Runner/index.html#type-t">Runner.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?log_status_on_exit:bool <span class="arrow">&#45;&gt;</span></span> <span>?log_output:bool <span class="arrow">&#45;&gt;</span></span>
<span>?name:string <span class="arrow">&#45;&gt;</span></span> <span>?color:<a href="../Log/Color/index.html#type-t">Log.Color.t</a> <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string <span class="xref-unresolved">Tezt</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span> <span>?hooks:<a href="#type-hooks">hooks</a> <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <span class="xref-unresolved">Lwt_io</span>.output_channel</span></code></div><div class="spec-doc"><p>Same as <a href="#val-spawn"><code>spawn</code></a>, but with a channel to send data to the process <code>stdin</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-terminate" class="anchored"><a href="#val-terminate" class="anchor"></a><code><span><span class="keyword">val</span> terminate : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Send SIGTERM to a process.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kill" class="anchored"><a href="#val-kill" class="anchor"></a><code><span><span class="keyword">val</span> kill : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Send SIGKILL to a process.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wait" class="anchored"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.process_status <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a process terminates and return its status.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check" class="anchored"><a href="#val-check" class="anchor"></a><code><span><span class="keyword">val</span> check : <span>?expect_failure:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a process terminates and check its status.</p><p>If <code>not expect_failure</code> and exit code is not 0, or if <code>expect_failure</code> and exit code is 0, or if the process was killed, fail the test.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_error" class="anchored"><a href="#val-check_error" class="anchor"></a><code><span><span class="keyword">val</span> check_error : <span>?exit_code:int <span class="arrow">&#45;&gt;</span></span> <span>?msg:<a href="../Base/index.html#type-rex">Base.rex</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a process terminates and check its status.</p><p>If <code>exit_code</code> is different than <code>t</code> exit code, or if <code>msg</code> does not match the stderr output, fail the test.</p><p>If <code>exit_code</code> is not specified, any non-zero code is accepted. If no <code>msg</code> is given, the stderr is ignored.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_and_read_stdout" class="anchored"><a href="#val-check_and_read_stdout" class="anchor"></a><code><span><span class="keyword">val</span> check_and_read_stdout : <span>?expect_failure:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a process terminates and read its standard output.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_and_read_stderr" class="anchored"><a href="#val-check_and_read_stderr" class="anchor"></a><code><span><span class="keyword">val</span> check_and_read_stderr : <span>?expect_failure:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a process terminates and read its standard error.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_and_read_both" class="anchored"><a href="#val-check_and_read_both" class="anchor"></a><code><span><span class="keyword">val</span> check_and_read_both : <span>?expect_failure:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(string * string)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a process terminates and read both its standard output and its standard error.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span>?log_status_on_exit:bool <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span> <span>?color:<a href="../Log/Color/index.html#type-t">Log.Color.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>?env:<span>string <span class="xref-unresolved">Tezt</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span> <span>?expect_failure:bool <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Spawn a process, wait for it to terminate, and check its status.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-clean_up" class="anchored"><a href="#val-clean_up" class="anchor"></a><code><span><span class="keyword">val</span> clean_up : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Terminate all live processes created using <a href="#val-spawn"><code>spawn</code></a> and wait for them to terminate.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stdout" class="anchored"><a href="#val-stdout" class="anchor"></a><code><span><span class="keyword">val</span> stdout : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Lwt_io</span>.input_channel</span></code></div><div class="spec-doc"><p>Channel from which you can read the standard output of a process.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stderr" class="anchored"><a href="#val-stderr" class="anchor"></a><code><span><span class="keyword">val</span> stderr : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Lwt_io</span>.input_channel</span></code></div><div class="spec-doc"><p>Channel from which you can read the standard error output of a process.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-name" class="anchored"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the name which was given to <a href="#val-spawn"><code>spawn</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-run_and_read_stdout" class="anchored"><a href="#val-run_and_read_stdout" class="anchor"></a><code><span><span class="keyword">val</span> run_and_read_stdout : <span>?log_status_on_exit:bool <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span> <span>?color:<a href="../Log/Color/index.html#type-t">Log.Color.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>?env:<span>string <span class="xref-unresolved">Tezt</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span> <span>?expect_failure:bool <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Spawn a process such as <code>run</code> and return its standard output.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-run_and_read_stderr" class="anchored"><a href="#val-run_and_read_stderr" class="anchor"></a><code><span><span class="keyword">val</span> run_and_read_stderr : <span>?log_status_on_exit:bool <span class="arrow">&#45;&gt;</span></span> <span>?name:string <span class="arrow">&#45;&gt;</span></span> <span>?color:<a href="../Log/Color/index.html#type-t">Log.Color.t</a> <span class="arrow">&#45;&gt;</span></span>
<span>?env:<span>string <span class="xref-unresolved">Tezt</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span> <span>?expect_failure:bool <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Spawn a process such as <code>run</code> and return its standard error.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></div></div></div></body></html>