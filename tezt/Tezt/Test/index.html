<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Test (tezt.Tezt.Test)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">tezt</a> &#x00BB; <a href="../index.html">Tezt</a> &#x00BB; Test</nav><h1>Module <code>Tezt.Test</code></h1></header><aside><p>Base test functions.</p></aside><dl><dt class="spec value" id="val-declare_reset_function"><a href="#val-declare_reset_function" class="anchor"></a><code><span class="keyword">val</span> declare_reset_function : <span>(unit <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Add a function to be called before each test start.</p><p>Used to reset counters such as the ones which are used to choose default process names.</p></dd></dl><dl><dt class="spec value" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span class="keyword">val</span> fail : <span><span>(<span class="type-var">'a</span>, unit, string, <span class="type-var">'b</span>)</span> Stdlib.format4</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Log an error and stop the test right here.</p></dd></dl><dl><dt class="spec value" id="val-register"><a href="#val-register" class="anchor"></a><code><span class="keyword">val</span> register : <span>__FILE__:string</span> <span>&#45;&gt;</span> <span>title:string</span> <span>&#45;&gt;</span> <span>tags:<span>string list</span></span> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span>unit Lwt.t</span>)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Register a test.</p><p>The <code>__FILE__</code> argument, which should be equal to <code>__FILE__</code> (i.e. just write <code>Test.run ~__FILE__</code>), is used to let the user select which files to run from the command-line.</p><p>One should be able to infer, from <code>title</code>, what the test will do. It is typically a short sentence like <code>&quot;addition is commutative&quot;</code> or <code>&quot;server runs until client tells it to stop&quot;</code>.</p><p>The list of <code>tags</code> must be composed of short strings which are easy to type on the command line (lowercase letters, digits and underscores). Run the test executable with <code>--list</code> to get the list of tags which are already used by existing tests. Try to reuse them if possible.</p><p>The last argument is a function <code>f</code> which implements the test. If <code>f</code> needs to spawn external processes, it should use the <code>Process</code> module to do so, so that those processes are automatically killed at the end of the test. Similarly, if this function needs to create temporary files, it should declare them with <code>Temp</code>, and if it needs to have promises that run in the background, it should use <code>Background.register</code> (and not <code>Lwt.async</code> in particular).</p><p>If <code>f</code> raises an exception, act as if <code>fail</code> was called (without the error location unfortunately).</p><p>You can call <code>register</code> several times in the same executable if you want it to run several tests. Each of those tests should be standalone, as the user is able to specify the list of tests to run on the command-line.</p><p>The test is not actually run until you call <a href="index.html#val-run"><code>run</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Run registered tests that should be run.</p><p>Call this once you have registered all tests. This will check command-line options and run the tests that have been selected, or display the list of tests.</p></dd></dl></div></body></html>