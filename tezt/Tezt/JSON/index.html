<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>JSON (tezt.Tezt.JSON)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt</a> &#x00BB; <a href="../index.html">Tezt</a> &#x00BB; JSON</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt.JSON</span></code></h1><p>JSON decoding.</p></header><nav class="odoc-toc"><ul><li><a href="#encoding">Encoding</a></li><li><a href="#decoding">Decoding</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-error" class="anchored"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span></code></div><div class="spec-doc"><p>Errors that can happen when parsing or reading JSON.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-show_error" class="anchored"><a href="#val-show_error" class="anchor"></a><code><span><span class="keyword">val</span> show_error : <span><a href="#type-error">error</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Convert a JSON parse error to a string.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Error" class="anchored"><a href="#exception-Error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Error</span> <span class="keyword">of</span> <a href="#type-error">error</a></span></code></div><div class="spec-doc"><p>Exception that can happen when parsing or reading JSON.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-u" class="anchored"><a href="#type-u" class="anchor"></a><code><span><span class="keyword">type</span> u</span><span> = <span class="xref-unresolved">Ezjsonm</span>.value</span></code></div><div class="spec-doc"><p>JSON unannotated ASTs.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>JSON ASTs annotated with their origin.</p><p>The origin is a string you give to <a href="#val-annotate"><code>annotate</code></a> or <a href="#val-parse"><code>parse</code></a>, such as <code>&quot;RPC response&quot;</code>. It denotes where the value comes from. It is used in error messages (see the comment in the Decoding section).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-annotate" class="anchored"><a href="#val-annotate" class="anchor"></a><code><span><span class="keyword">val</span> annotate : <span>origin:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-u">u</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Annotate a JSON AST with its origin.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unannotate" class="anchored"><a href="#val-unannotate" class="anchor"></a><code><span><span class="keyword">val</span> unannotate : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-u">u</a></span></code></div><div class="spec-doc"><p>Remove annotation from an annotated JSON AST.</p></div></div><h3 id="encoding"><a href="#encoding" class="anchor"></a>Encoding</h3><div class="odoc-spec"><div class="spec value" id="val-encode" class="anchored"><a href="#val-encode" class="anchor"></a><code><span><span class="keyword">val</span> encode : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Encode a JSON annotated AST into a string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-encode_u" class="anchored"><a href="#val-encode_u" class="anchor"></a><code><span><span class="keyword">val</span> encode_u : <span><a href="#type-u">u</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Encode a JSON unannotated AST into a string.</p></div></div><h3 id="decoding"><a href="#decoding" class="anchor"></a>Decoding</h3><div class="odoc-spec"><div class="spec value" id="val-parse_file" class="anchored"><a href="#val-parse_file" class="anchor"></a><code><span><span class="keyword">val</span> parse_file : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Parse a JSON file.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if the input is invalid JSON.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-parse" class="anchored"><a href="#val-parse" class="anchor"></a><code><span><span class="keyword">val</span> parse : <span>origin:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Parse a JSON string.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if the input is invalid JSON.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-parse_opt" class="anchored"><a href="#val-parse_opt" class="anchor"></a><code><span><span class="keyword">val</span> parse_opt : <span>origin:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p>Same as <code>parse</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><p>The general pattern for the accessors below is that only <code>as_x</code> functions can fail. Getters <code>get</code> and <code>geti</code> return <code>`Null</code> instead of failing. This allows to chain them and only test for errors at the end with <code>as_x</code>, either by raising <code>Error</code> or by returning <code>None</code> (with the <code>as_x_opt</code> variant).</p><p>Internally, the actual error which is printed is the correct one. For instance, with <code>json |-&gt; &quot;x&quot; |&gt; as_int</code>, if <code>json</code> is not an object, the call to <code>as_int</code> causes the test to fail with <code>&quot;&lt;origin&gt;: not an object&quot;</code> where <code>&lt;origin&gt;</code> is the <code>~origin</code> you gave to <a href="#val-parse"><code>parse</code></a>. If <code>json</code> is an object but <code>&quot;x&quot;</code> does not exist, <code>as_int</code> causes the test to fail with <code>&quot;&lt;origin&gt;: missing field: x&quot;</code>. If <code>&quot;x&quot;</code> exists but is not an integer, <code>as_int</code> causes the test to fail with <code>&quot;&lt;origin&gt; at .x: expected an integer&quot;</code>.</p><div class="odoc-spec"><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Get the value for a field of a JSON object.</p><p>If the JSON value is not an object, or if the field does not exist, return <code>`Null</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(|-&gt;)" class="anchored"><a href="#val-(|-&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (|-&gt;) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get"><code>get</code></a>, with the arguments reversed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-geti" class="anchored"><a href="#val-geti" class="anchor"></a><code><span><span class="keyword">val</span> geti : <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Get the value for a field of a JSON array.</p><p>If the JSON value is not an array, or if the field does not exist, return <code>`Null</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(|=&gt;)" class="anchored"><a href="#val-(|=&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (|=&gt;) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-geti"><code>geti</code></a>, with the arguments reversed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-put" class="anchored"><a href="#val-put" class="anchor"></a><code><span><span class="keyword">val</span> put : <span><span>(string * <a href="#type-t">t</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Updates an object with a <code>(key, value)</code> pair.</p><p><code>put (key, value) obj</code> puts <code>value</code> under <code>key</code> in <code>obj</code>. If the <code>key</code> already exists, it is overwritten. Otherwise a new key is added at the end of the object.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if <code>obj</code> is not a JSON object.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-update" class="anchored"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Alters the value of a specific key in a JSON object by applying its value to a function. Returns updated object.</p><p><code>update key f obj</code> is equivalent to <code>put (key, f (get key obj)) obj</code>.</p><p>Note: if <code>key</code> is not present in <code>obj</code>, <code>`Null</code> is passed to <code>f</code> instead.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if <code>obj</code> is not an object.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-is_null" class="anchored"><a href="#val-is_null" class="anchor"></a><code><span><span class="keyword">val</span> is_null : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether a JSON value is <code>`Null</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-as_bool" class="anchored"><a href="#val-as_bool" class="anchor"></a><code><span><span class="keyword">val</span> as_bool : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Get the value from a <code>`Bool</code> node.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if the input is not a <code>`Bool</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-as_bool_opt" class="anchored"><a href="#val-as_bool_opt" class="anchor"></a><code><span><span class="keyword">val</span> as_bool_opt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool option</span></span></code></div><div class="spec-doc"><p>Same as <code>as_bool</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_bool" class="anchored"><a href="#val-is_bool" class="anchor"></a><code><span><span class="keyword">val</span> is_bool : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether <code>as_bool</code> would succeed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-as_int" class="anchored"><a href="#val-as_int" class="anchor"></a><code><span><span class="keyword">val</span> as_int : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the integer value from a <code>`Float</code> or <code>`String</code> node.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if:</p><ul><li>the input is not a <code>`Float</code> nor a <code>`String</code>;</li><li>the input is a <code>`Float</code> but is not an integer;</li><li>the input is a <code>`String</code> but does not denote a valid decimal integer.</li></ul></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-as_int_opt" class="anchored"><a href="#val-as_int_opt" class="anchor"></a><code><span><span class="keyword">val</span> as_int_opt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int option</span></span></code></div><div class="spec-doc"><p>Same as <code>as_int</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_int" class="anchored"><a href="#val-is_int" class="anchor"></a><code><span><span class="keyword">val</span> is_int : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether <code>as_int</code> would succeed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-as_int64" class="anchored"><a href="#val-as_int64" class="anchor"></a><code><span><span class="keyword">val</span> as_int64 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int64</span></code></div><div class="spec-doc"><p>Get the integer value from a <code>`Float</code> or <code>`String</code> node (64-bit version).</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if:</p><ul><li>the input is not a <code>`Float</code> nor a <code>`String</code>;</li><li>the input is a <code>`Float</code> but is not an integer;</li><li>the input is a <code>`String</code> but does not denote a valid decimal integer.</li></ul></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-as_int64_opt" class="anchored"><a href="#val-as_int64_opt" class="anchor"></a><code><span><span class="keyword">val</span> as_int64_opt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int64 option</span></span></code></div><div class="spec-doc"><p>Same as <code>as_int64</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_int64" class="anchored"><a href="#val-is_int64" class="anchor"></a><code><span><span class="keyword">val</span> is_int64 : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether <code>as_int64</code> would succeed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-as_float" class="anchored"><a href="#val-as_float" class="anchor"></a><code><span><span class="keyword">val</span> as_float : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p>Get the float value from a <code>`Float</code> or <code>`String</code> node.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if:</p><ul><li>the input is not a <code>`Float</code> nor a <code>`String</code>;</li><li>the input is a <code>`String</code> but does not denote a valid decimal float.</li></ul></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-as_float_opt" class="anchored"><a href="#val-as_float_opt" class="anchor"></a><code><span><span class="keyword">val</span> as_float_opt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>float option</span></span></code></div><div class="spec-doc"><p>Same as <code>as_float</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_float" class="anchored"><a href="#val-is_float" class="anchor"></a><code><span><span class="keyword">val</span> is_float : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether <code>as_float</code> would succeed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-as_string" class="anchored"><a href="#val-as_string" class="anchor"></a><code><span><span class="keyword">val</span> as_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the value from a <code>`String</code> node.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if the input is not a <code>`String</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-as_string_opt" class="anchored"><a href="#val-as_string_opt" class="anchor"></a><code><span><span class="keyword">val</span> as_string_opt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>Same as <code>as_string</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_string" class="anchored"><a href="#val-is_string" class="anchor"></a><code><span><span class="keyword">val</span> is_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether <code>as_string</code> would succeed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-as_list" class="anchored"><a href="#val-as_list" class="anchor"></a><code><span><span class="keyword">val</span> as_list : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Get the list of items from an <code>`Array</code> node.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if the input is not an <code>`Array</code> nor <code>`Null</code>. Return the empty list if the input is <code>`Null</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-as_list_opt" class="anchored"><a href="#val-as_list_opt" class="anchor"></a><code><span><span class="keyword">val</span> as_list_opt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-t">t</a> list</span> option</span></span></code></div><div class="spec-doc"><p>Same as <code>as_list</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_list" class="anchored"><a href="#val-is_list" class="anchor"></a><code><span><span class="keyword">val</span> is_list : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether <code>as_list</code> would succeed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-as_object" class="anchored"><a href="#val-as_object" class="anchor"></a><code><span><span class="keyword">val</span> as_object : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(string * <a href="#type-t">t</a>)</span> list</span></span></code></div><div class="spec-doc"><p>Get the list of fields from an <code>`Object</code> node.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">[Error]</span> <p>if the input is not an <code>`Object</code> nor <code>`Null</code>. Return the empty list if the input is <code>`Null</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-as_object_opt" class="anchored"><a href="#val-as_object_opt" class="anchor"></a><code><span><span class="keyword">val</span> as_object_opt : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(string * <a href="#type-t">t</a>)</span> list</span> option</span></span></code></div><div class="spec-doc"><p>Same as <code>as_object</code>, but return <code>None</code> instead of raising <code>Error</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_object" class="anchored"><a href="#val-is_object" class="anchor"></a><code><span><span class="keyword">val</span> is_object : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Test whether <code>as_object</code> would succeed.</p></div></div></div></body></html>