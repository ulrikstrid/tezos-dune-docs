<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tezt__Process (tezt.Tezt__Process)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">tezt</a> &#x00BB; Tezt__Process</nav><h1>Module <code>Tezt__Process</code></h1><p>External processes launched by tests.</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>A process which was <a href="index.html#val-spawn"><code>spawn</code></a>ed.</p></dd></dl><dl><dt class="spec type" id="type-hooks"><a href="#type-hooks" class="anchor"></a><code><span class="keyword">type</span> hooks</code><code> = </code><code>{</code><table class="record"><tr id="type-hooks.on_log" class="anchored"><td class="def field"><a href="#type-hooks.on_log" class="anchor"></a><code>on_log : string <span>&#45;&gt;</span> unit;</code></td><td class="doc"><p>A hook that is called with every line that is being logged.</p></td></tr><tr id="type-hooks.on_spawn" class="anchored"><td class="def field"><a href="#type-hooks.on_spawn" class="anchor"></a><code>on_spawn : string <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> unit;</code></td><td class="doc"><p>A hook that is called whenever a process is being spawned. The first parameter is the command and the second are its arguments.</p></td></tr></table><code>}</code></dt><dd><p>Process can have some hooks attached when <a href="index.html#val-spawn"><code>spawn</code></a>ed.</p></dd></dl><dl><dt class="spec value" id="val-spawn"><a href="#val-spawn" class="anchor"></a><code><span class="keyword">val</span> spawn : <span>?&#8288;runner:<a href="../Tezt/Runner/index.html#type-t">Tezt.Runner.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;log_status_on_exit:bool</span> <span>&#45;&gt;</span> <span>?&#8288;log_output:bool</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;color:<a href="../Tezt/Log/Color/index.html#type-t">Tezt.Log.Color.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;env:<span>string <a href="../Tezt__Base/index.html#module-String_map">Tezt.Base.String_map</a>.t</span></span> <span>&#45;&gt;</span> <span>?&#8288;hooks:<a href="index.html#type-hooks">hooks</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Create a process which starts running in the background.</p><p>Usage: <code>spawn command arguments</code></p><p>If <code>log_status_on_exit</code> is <code>true</code> (which is the default), log the exit code when the process terminates.</p><p>If <code>log_output</code> is <code>true</code> (which is the default), log the <code>stdout</code> and <code>stderr</code> output.</p><p>Parameter <code>name</code> specifies the prefix (in brackets) that is added to each logged output line. Parameter <code>color</code> specifies the color of those output lines.</p><p>Parameter <code>hooks</code> allows to attach some hooks to the process.</p><p>Note that this function can only be called if <code>Background.register</code> is allowed (which is the case inside functions given to <code>Test.register</code>).</p><p>Parameter <code>runner</code> specifies the runner on which to run the process. If unspecified, the process runs locally. Otherwise, it runs on the given runner using SSH.</p><p>Example: <code>spawn &quot;git&quot; [ &quot;log&quot;; &quot;-p&quot; ]</code></p></dd></dl><dl><dt class="spec value" id="val-spawn_with_stdin"><a href="#val-spawn_with_stdin" class="anchor"></a><code><span class="keyword">val</span> spawn_with_stdin : <span>?&#8288;runner:<a href="../Tezt/Runner/index.html#type-t">Tezt.Runner.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;log_status_on_exit:bool</span> <span>&#45;&gt;</span> <span>?&#8288;log_output:bool</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;color:<a href="../Tezt/Log/Color/index.html#type-t">Tezt.Log.Color.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;env:<span>string <a href="../Tezt__Base/index.html#module-String_map">Tezt.Base.String_map</a>.t</span></span> <span>&#45;&gt;</span> <span>?&#8288;hooks:<a href="index.html#type-hooks">hooks</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> * Lwt_io.output_channel</code></dt><dd><p>Same as <a href="index.html#val-spawn"><code>spawn</code></a>, but with a channel to send data to the process <code>stdin</code>.</p></dd></dl><dl><dt class="spec value" id="val-terminate"><a href="#val-terminate" class="anchor"></a><code><span class="keyword">val</span> terminate : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Send SIGTERM to a process.</p></dd></dl><dl><dt class="spec value" id="val-kill"><a href="#val-kill" class="anchor"></a><code><span class="keyword">val</span> kill : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Send SIGKILL to a process.</p></dd></dl><dl><dt class="spec value" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span class="keyword">val</span> wait : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>Unix.process_status Lwt.t</span></code></dt><dd><p>Wait until a process terminates and return its status.</p></dd></dl><dl><dt class="spec value" id="val-check"><a href="#val-check" class="anchor"></a><code><span class="keyword">val</span> check : <span>?&#8288;expect_failure:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Wait until a process terminates and check its status.</p><p>If <code>not expect_failure</code> and exit code is not 0, or if <code>expect_failure</code> and exit code is 0, or if the process was killed, fail the test.</p></dd></dl><dl><dt class="spec value" id="val-check_error"><a href="#val-check_error" class="anchor"></a><code><span class="keyword">val</span> check_error : <span>?&#8288;exit_code:int</span> <span>&#45;&gt;</span> <span>?&#8288;msg:<a href="../Tezt/Base/index.html#type-rex">Tezt.Base.rex</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Wait until a process terminates and check its status.</p><p>If <code>exit_code</code> is different than <code>t</code> exit code, or if <code>msg</code> does not match the stderr output, fail the test.</p><p>If <code>exit_code</code> is not specified, any non-zero code is accepted. If no <code>msg</code> is given, the stderr is ignored.</p></dd></dl><dl><dt class="spec value" id="val-check_and_read_stdout"><a href="#val-check_and_read_stdout" class="anchor"></a><code><span class="keyword">val</span> check_and_read_stdout : <span>?&#8288;expect_failure:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>string Lwt.t</span></code></dt><dd><p>Wait until a process terminates and read its standard output.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></dd></dl><dl><dt class="spec value" id="val-check_and_read_stderr"><a href="#val-check_and_read_stderr" class="anchor"></a><code><span class="keyword">val</span> check_and_read_stderr : <span>?&#8288;expect_failure:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>string Lwt.t</span></code></dt><dd><p>Wait until a process terminates and read its standard error.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></dd></dl><dl><dt class="spec value" id="val-check_and_read_both"><a href="#val-check_and_read_both" class="anchor"></a><code><span class="keyword">val</span> check_and_read_both : <span>?&#8288;expect_failure:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(string * string)</span> Lwt.t</span></code></dt><dd><p>Wait until a process terminates and read both its standard output and its standard error.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : <span>?&#8288;log_status_on_exit:bool</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;color:<a href="../Tezt/Log/Color/index.html#type-t">Tezt.Log.Color.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;env:<span>string <a href="../Tezt__Base/index.html#module-String_map">Tezt.Base.String_map</a>.t</span></span> <span>&#45;&gt;</span> <span>?&#8288;expect_failure:bool</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Spawn a process, wait for it to terminate, and check its status.</p></dd></dl><dl><dt class="spec value" id="val-clean_up"><a href="#val-clean_up" class="anchor"></a><code><span class="keyword">val</span> clean_up : unit <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Terminate all live processes created using <a href="index.html#val-spawn"><code>spawn</code></a> and wait for them to terminate.</p></dd></dl><dl><dt class="spec value" id="val-stdout"><a href="#val-stdout" class="anchor"></a><code><span class="keyword">val</span> stdout : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Lwt_io.input_channel</code></dt><dd><p>Channel from which you can read the standard output of a process.</p></dd></dl><dl><dt class="spec value" id="val-stderr"><a href="#val-stderr" class="anchor"></a><code><span class="keyword">val</span> stderr : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Lwt_io.input_channel</code></dt><dd><p>Channel from which you can read the standard error output of a process.</p></dd></dl><dl><dt class="spec value" id="val-name"><a href="#val-name" class="anchor"></a><code><span class="keyword">val</span> name : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Get the name which was given to <a href="index.html#val-spawn"><code>spawn</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-run_and_read_stdout"><a href="#val-run_and_read_stdout" class="anchor"></a><code><span class="keyword">val</span> run_and_read_stdout : <span>?&#8288;log_status_on_exit:bool</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;color:<a href="../Tezt/Log/Color/index.html#type-t">Tezt.Log.Color.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;env:<span>string <a href="../Tezt__Base/index.html#module-String_map">Tezt.Base.String_map</a>.t</span></span> <span>&#45;&gt;</span> <span>?&#8288;expect_failure:bool</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <span>string Lwt.t</span></code></dt><dd><p>Spawn a process such as <code>run</code> and return its standard output.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></dd></dl><dl><dt class="spec value" id="val-run_and_read_stderr"><a href="#val-run_and_read_stderr" class="anchor"></a><code><span class="keyword">val</span> run_and_read_stderr : <span>?&#8288;log_status_on_exit:bool</span> <span>&#45;&gt;</span> <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;color:<a href="../Tezt/Log/Color/index.html#type-t">Tezt.Log.Color.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;env:<span>string <a href="../Tezt__Base/index.html#module-String_map">Tezt.Base.String_map</a>.t</span></span> <span>&#45;&gt;</span> <span>?&#8288;expect_failure:bool</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <span>string Lwt.t</span></code></dt><dd><p>Spawn a process such as <code>run</code> and return its standard error.</p><p>Fail the test if the process failed, unless <code>expect_failure</code>, in which case fail if the process succeeds.</p></dd></dl></div></body></html>